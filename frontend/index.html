<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=1400,maximum-scale=2.0,user-scalable=yes">
  <title>NEUROBUDDYY.ai</title>
  <!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

<script>
  // Firebase Configuration (REPLACE with YOUR config from Step 1.3)
  const firebaseConfig = {
    apiKey: "AIzaSyDnsuheauVnhqUcIhCyEXCNSNBdS1PQkII",
    authDomain: "neurobuddyy-ai-7f500.firebaseapp.com",
    projectId: "neurobuddyy-ai-7f500",
    storageBucket: "neurobuddyy-ai-7f500.firebasestorage.app",
    messagingSenderId: "965241116528",
    appId: "1:965241116528:web:ce58e789433a5a5d3b61b5"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const storage = firebase.storage();
  
  console.log("‚úÖ Firebase initialized successfully!");
</script>

  <style>
    /* ========== MEDICAL IMAGE GALLERY STYLES ========== */
.gallery-modal {
  max-width: 900px;
  width: 95%;
}

.gallery-tabs {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
  border-bottom: 2px solid #e5e7eb;
  padding-bottom: 10px;
}

.gallery-tab {
  padding: 10px 20px;
  background: #f3f4f6;
  border: none;
  border-radius: 8px 8px 0 0;
  cursor: pointer;
  font-weight: 600;
  transition: 0.2s;
  color: #6b7280;
}

.gallery-tab.active {
  background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
  color: white;
}

.gallery-tab:hover {
  background: #e5e7eb;
}

.gallery-tab.active:hover {
  background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
}

.gallery-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.gallery-item {
  border: 2px solid #e5e7eb;
  border-radius: 10px;
  overflow: hidden;
  transition: 0.3s;
  cursor: pointer;
  background: white;
}

.gallery-item:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 25px rgba(0,0,0,0.15);
  border-color: #2563eb;
}

.gallery-image {
  width: 100%;
  height: 200px;
  object-fit: cover;
  background: #f3f4f6;
}

.gallery-info {
  padding: 15px;
}

.gallery-title {
  font-weight: bold;
  color: #111827;
  margin-bottom: 5px;
  font-size: 1rem;
}

.gallery-description {
  font-size: 0.85rem;
  color: #6b7280;
  line-height: 1.4;
}

.upload-section {
  background: #f0f4f8;
  padding: 25px;
  border-radius: 10px;
  border: 2px dashed #cbd5e1;
  text-align: center;
  margin-top: 30px;
}

.upload-section h3 {
  color: #2563eb;
  margin-bottom: 15px;
}

.upload-area {
  display: flex;
  flex-direction: column;
  gap: 15px;
  align-items: center;
}

.upload-input {
  display: none;
}

.upload-button {
  padding: 12px 30px;
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  color: white;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
  font-size: 1rem;
}

.upload-button:hover {
  transform: scale(1.05);
  box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
}

.image-preview {
  max-width: 300px;
  margin: 15px auto;
  border-radius: 8px;
  border: 2px solid #cbd5e1;
}

.image-preview img {
  width: 100%;
  border-radius: 8px;
}

/* Image Lightbox */
.lightbox-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.9);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 11000;
}

.lightbox-overlay.active {
  display: flex;
}

.lightbox-content {
  max-width: 90%;
  max-height: 90%;
  position: relative;
}

.lightbox-content img {
  max-width: 100%;
  max-height: 90vh;
  border-radius: 10px;
}

.lightbox-close {
  position: absolute;
  top: -40px;
  right: 0;
  background: white;
  border: none;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  font-size: 1.5rem;
  cursor: pointer;
  color: #333;
}

.lightbox-info {
  background: white;
  padding: 15px;
  border-radius: 0 0 10px 10px;
  margin-top: -10px;
}

.no-images {
  text-align: center;
  padding: 40px;
  color: #999;
  font-style: italic;
}

    /* [KEEP ALL YOUR EXISTING CSS - NO CHANGES] */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #333;
      margin: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      background: #f0f4f8;
    }

    .topbar {
      background: #060000;
      color: #fff;
      text-align: center;
      font-size: 1.7rem;
      font-weight: bold;
      padding: 17px;
      position: relative;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    .hamburger {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1.8rem;
      background: none;
      border: none;
      color: white;
      cursor: pointer;
    }

    .container {
  flex: 1;
  display: flex;
  flex-direction: row;  /* ‚úÖ Make sure this is 'row' not 'column' */
  height: calc(100vh - 60px);
}


    .leftbar {
      width: 0;
      background: #d4faff;
      border-right: 8px solid #a8ebf9;
      overflow-y: auto;
      transition: width 0.3s ease;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .leftbar.open {
      width: 220px;
      padding: 15px;
    }

    .menu {
      list-style: none;
      padding: 0;
    }

    .menu li {
      padding: 10px;
      margin-bottom: 8px;
      background: #fff;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.2s;
      font-weight: 500;
    }

    .menu li:hover {
      background: #7a9fef;
      color: #fff;
    }

    .settings {
      margin-top: auto;
      padding: 10px;
      background: #fff;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: 0.2s;
    }

    .settings:hover {
      background: #7a9adf;
      color: rgb(255, 255, 255);
    }

    .chat-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: #f9fafb;
      position: relative;
    }

    .chat-window {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
    }

    .chat-window div {
      max-width: 70%;
      padding: 10px 15px;
      border-radius: 15px;
      line-height: 1.4;
      font-size: 0.95rem;
      margin-bottom: 12px;
    }

    .bot-msg {
      background: #2575d6;
      color: #ffffff;
      text-align: left;
    }

    .user-msg {
      background:linear-gradient(rgb(144, 179, 214) 0%,rgb(168, 242, 161) 20%);
      color: rgb(0, 0, 0);
      text-align: right;
      margin-left: auto;
    }

    .top-typing-box {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      color: white;
      padding: 20px;
      margin: 10px 16px;
      border-radius: 15px;
      display: none;
      min-height: 60px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      animation: slideDown 0.4s ease;
    }

    .top-typing-box.active {
      display: block;
    }

    @keyframes slideDown {
      from {
        transform: translateY(-30px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .typing-title {
      font-size: 0.75rem;
      font-weight: bold;
      margin-bottom: 8px;
      opacity: 0.8;
      text-transform: uppercase;
    }

    #topTypingContent {
      font-size: 1.1rem;
      line-height: 1.5;
      font-weight: 500;
    }

    .suggestions-box {
      background: #ffffff;
      border-top: 3px solid #2563eb;
      border-bottom: 3px solid #2563eb;
      padding: 12px 16px;
      display: none;
      max-height: 250px;
      overflow-y: auto;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
    }

    .suggestions-box.active {
      display: block;
    }

    .suggestions-title {
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 10px;
      font-weight: 600;
    }

    .suggestion-item {
      padding: 12px 15px;
      cursor: pointer;
      border-bottom: 1px solid #e5e7eb;
      transition: all 0.2s;
      border-radius: 5px;
      margin-bottom: 5px;
      background: #f9fafb;
      font-size: 0.9rem;
    }

    .suggestion-item:hover {
      background: #2563eb;
      color: white;
      transform: translateX(5px);
    }

    .suggestion-item:last-child {
      border-bottom: none;
    }

    .no-suggestions {
      text-align: center;
      color: #999;
      padding: 15px;
      font-style: italic;
      font-size: 0.9rem;
    }

    .search-bar {
      flex:0 0 60px;
      display: flex;
      align-items: center;
      gap: 8px;
      border-top: 5px solid #ffffff;
      background: white;
      padding: 12px;
    }

    .search-bar input {
      flex: 1;
      border: 2px solid #9fbff0c1;
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 0.95rem;
      outline: none;
    }

    .btn{
      display:flex;
      gap:10px;
      padding: 10px 12px;
      border-radius: 8px;
      color: rgb(236, 223, 215);
      font-weight: bold;
      cursor: pointer;
      border: 2px solid;
      transition: 0.1s;
    }

    .btn:hover { transform: scale(1.05); }
    .mic { background: #95b1ea; }
    .upload { background: #fef8df; }
    .send { background: #6b7280; }

    .rightbar {
  width: 25%;
  min-width: 300px;  /* ‚úÖ ADD THIS */
  flex-shrink: 0;    /* ‚úÖ ADD THIS */
  background: white;
  border-left: 8px solid #ffffff;
  padding: 16px;
  display: flex;
  flex-direction: column;
  overflow-y: auto;
}

    .emergency {
      background: #dc2626;
      color: white;
      padding: 12px;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: bold;
      margin-bottom: 12px;
      cursor: pointer;
      border: none;
    }
    .emergency:hover { background: #b91c1c; }

    .connect-doctor {
      background: #2563eb;
      color: white;
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: bold;
      text-align: center;
      margin-bottom: 10px;
      cursor: pointer;
      border: none;
      transition: 0.2s;
    }
    .connect-doctor:hover { background: #1d4ed8; }

    #doctorListContainer {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s ease-in-out;
      background: #f0f4f8;
      border-radius: 10px;
      margin-bottom: 15px;
    }

    #doctorListContainer.expanded {
      min-height: 300px !important;
      max-height: none !important;
      height: 300px !important;
      padding: 15px;
      border: 2px solid #2563eb;
      overflow-y:auto;
      overflow-x:hidden;
      margin-bottom: 20px;
      animation :slideDown 0.4s ease-out ;
    }

    .doctor-card {
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    #doctorList {
    }

    .doctor-card:hover {
      transform: translateX(5px);
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
      background:  linear-gradient(135deg, #10b981 0%, #059669 100%);
    }

    .doctor-info {
      flex-grow: 1;
    }

    .doctor-name {
      font-weight: bold;
      color: #333;
      margin-bottom: 3px;
      font-size: 0.95rem;
    }

    .doctor-specialty {
      font-size: 0.8rem;
      color: #666;
    }

    .status-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-left: 10px;
    }

    .status-available {
      background: #10b981;
      box-shadow: 0 0 8px #10b981;
      animation: pulse 2s infinite;
    }

    .status-engaged {
      background: #ef4444;
      box-shadow: 0 0 8px #ef4444;
      animation:pulse 8s infinite;
    }

    .status-offline {
      background: #9ca3af;
    }
    @keyframes slideDowm{
      from {
        opacity : 0;
        transform: translateY(-20px);
      }
      to{
        opacity :1;
        transform: translateY(0);
      }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .loading-doctors {
      text-align: center;
      color: #666;
      padding: 20px;
      font-style: italic;
    }

    .hospital-section {
      margin-top: 20px;
    }

    .location-title {
      font-size: 1rem;
      color: rgb(42, 106, 255);
      margin-bottom: 15px;
      font-weight: bold;
    }

    .location-form {
      background: #f0f4f8;
      padding: 15px;
      border-radius: 10px;
      border: 2px solid #cbd5e1;
    }

    .location-input {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: 2px solid #cbd5e1;
      border-radius: 8px;
      font-size: 0.9rem;
      background: white;
      cursor: pointer;
    }

    .location-input:disabled {
      background: #f3f4f6;
      cursor: not-allowed;
    }

    .location-input:focus {
      outline: none;
      border-color: #2563eb;
    }

    .save-location-btn {
      width: 100%;
      padding: 12px;
      background: #10b981;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.2s;
    }

    .save-location-btn:hover {
      background: #059669;
      transform: scale(1.02);
    }

    /* Chat History Styles */
    #chatHistoryPanel {
      width: 0;
      background: white;
      border-right: 8px solid #e5e7eb;
      overflow-y: auto;
      transition: width 0.3s ease;
      display: flex;
      flex-direction: column;
      padding: 0;
    }

    #chatHistoryPanel.open {
      width: 300px;
      padding: 15px;
    }

    .history-header {
      font-size: 1.1rem;
      font-weight: bold;
      color: #2563eb;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #e5e7eb;
    }

    .history-item {
      background: #f9fafb;
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 8px;
      border: 2px solid #e5e7eb;
      cursor: pointer;
      transition: 0.2s;
    }

    .history-item:hover {
      background: #e0f2fe;
      border-color: #2563eb;
      transform: translateX(5px);
    }

    .history-title {
      font-weight: 600;
      color: #333;
      font-size: 0.9rem;
      margin-bottom: 5px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .history-time {
      font-size: 0.75rem;
      color: #666;
    }

    .no-history {
      text-align: center;
      color: #999;
      padding: 20px;
      font-style: italic;
    }

    .clear-history-btn {
      background: #dc2626;
      color: white;
      padding: 8px 15px;
      border: none;
      border-radius: 5px;
      font-size: 0.85rem;
      cursor: pointer;
      margin-top: 10px;
      width: 100%;
      transition: 0.2s;
    }

    .clear-history-btn:hover {
      background: #b91c1c;
    }

    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-thumb { background: #9ca3af; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #4b5563; }

    /* Modal System */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.75);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10000;
  backdrop-filter: blur(5px);
}

.modal-content {
  background: white;
  padding: 30px;
  border-radius: 15px;
  max-width: 500px;
  width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  position: relative;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
  animation: modalSlideIn 0.3s ease-out;
}

@keyframes modalSlideIn {
  from {
    transform: translateY(-50px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.modal-close {
  position: absolute;
  top: 15px;
  right: 15px;
  background: #f3f4f6;
  border: none;
  width: 35px;
  height: 35px;
  border-radius: 50%;
  font-size: 1.3rem;
  cursor: pointer;
  transition: 0.2s;
  color: #666;
}

.modal-close:hover {
  background: #e5e7eb;
  color: #333;
  transform: rotate(90deg);
}

/* Role Selection Modal */
.role-modal {
  text-align: center;
  padding: 40px;
}

.role-modal h2 {
  color: #2563eb;
  margin-bottom: 10px;
  font-size: 1.8rem;
}

.role-buttons {
  display: flex;
  flex-direction: column;
  gap: 15px;
  margin-top: 30px;
}

.btn-role {
  padding: 18px 30px;
  font-size: 1.2rem;
  font-weight: bold;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.btn-doctor {
  background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
  color: white;
}

.btn-guest {
  background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
  color: white;
}

.btn-role:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
}

/* Form Styles */
.doctor-form-modal {
  max-width: 550px;
}

.form-group {
  margin-bottom: 20px;
  text-align: left;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: #374151;
  font-size: 0.95rem;
}

.form-group input,
.form-group select {
  width: 100%;
  padding: 12px 15px;
  border: 2px solid #e5e7eb;
  border-radius: 8px;
  font-size: 1rem;
  transition: border-color 0.2s;
  font-family: inherit;
}

.form-group input:focus,
.form-group select:focus {
  outline: none;
  border-color: #2563eb;
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.form-buttons {
  display: flex;
  gap: 10px;
  margin-top: 25px;
}

.btn-submit {
  flex: 1;
  padding: 14px;
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  color: white;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  font-size: 1rem;
  cursor: pointer;
  transition: 0.3s;
}

.btn-submit:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
}

.btn-cancel {
  flex: 1;
  padding: 14px;
  background: #6b7280;
  color: white;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  font-size: 1rem;
  cursor: pointer;
  transition: 0.3s;
}

.btn-cancel:hover {
  background: #4b5563;
}

.form-footer {
  text-align: center;
  margin-top: 20px;
  color: #6b7280;
  font-size: 0.95rem;
}

.form-footer a {
  color: #2563eb;
  text-decoration: none;
  font-weight: 600;
}

.form-footer a:hover {
  text-decoration: underline;
}

/* Doctor Dashboard */
.doctor-dashboard {
  max-width: 600px;
}

.doctor-profile {
  padding: 20px;
}

.profile-header {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-bottom: 25px;
  padding-bottom: 25px;
  border-bottom: 2px solid #e5e7eb;
}

.profile-avatar {
  font-size: 4rem;
  background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
  width: 90px;
  height: 90px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.profile-info h3 {
  margin: 0 0 8px 0;
  color: #111827;
  font-size: 1.5rem;
}

.profile-info p {
  margin: 5px 0;
  color: #6b7280;
  font-size: 0.95rem;
}

.status-selector {
  margin: 25px 0;
}

.status-selector label {
  display: block;
  margin-bottom: 10px;
  font-weight: 600;
  color: #374151;
}

.status-selector select {
  width: 100%;
  padding: 12px;
  border: 2px solid #e5e7eb;
  border-radius: 8px;
  font-size: 1rem;
  cursor: pointer;
}

.dashboard-actions {
  margin-top: 25px;
}

.btn-logout {
  width: 100%;
  padding: 12px;
  background: #dc2626;
  color: white;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  font-size: 1rem;
  cursor: pointer;
  transition: 0.3s;
}

.btn-logout:hover {
  background: #b91c1c;
  transform: translateY(-2px);
}
/* Settings arrow animation */
.settings-arrow {
  display: inline-block;
  transition: transform 0.3s ease;
  margin-left: 5px;
}

.settings-arrow.open {
  transform: rotate(180deg);
}

/* ========== IN-WEBSITE NOTIFICATION SYSTEM ========== */
.website-notification {
  position: fixed;
  top: 80px;
  left: 50%;
  transform: translateX(-50%) translateY(-100px);
  background: white;
  padding: 20px 30px;
  border-radius: 12px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
  z-index: 10001;
  min-width: 400px;
  max-width: 500px;
  opacity: 0;
  transition: all 0.4s ease;
  border-left: 5px solid #2563eb;
}

.website-notification.show {
  transform: translateX(-50%) translateY(0);
  opacity: 1;
}

.website-notification.success {
  border-left-color: #10b981;
}

.website-notification.error {
  border-left-color: #dc2626;
}

.website-notification.warning {
  border-left-color: #f59e0b;
}

.notification-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
}

.notification-icon {
  font-size: 2rem;
}

.notification-title {
  font-size: 1.2rem;
  font-weight: bold;
  color: #111827;
}

.notification-message {
  color: #4b5563;
  line-height: 1.6;
  margin-bottom: 15px;
}

.notification-actions {
  display: flex;
  gap: 10px;
  justify-content: flex-end;
}

.notification-btn {
  padding: 8px 16px;
  border: none;
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
  transition: 0.2s;
}

.notification-btn.primary {
  background: #2563eb;
  color: white;
}

.notification-btn.primary:hover {
  background: #1d4ed8;
}

.notification-btn.secondary {
  background: #e5e7eb;
  color: #374151;
}

.notification-btn.secondary:hover {
  background: #d1d5db;
}


/* ========== ABOUT MODAL FIX ========== */
#aboutModal {
  display: none;
  position: fixed;
  z-index: 10000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.75);
  justify-content: center;
  align-items: center;
  backdrop-filter: blur(5px);
}

.about-content {
  background: white;
  margin: 3% auto;
  padding: 0;
  border-radius: 20px;
  width: 85%;
  max-width: 900px;
  max-height: 85vh;
  overflow: hidden;
  box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
}

.about-header {
  background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
  color: white;
  padding: 25px 40px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-radius: 20px 20px 0 0;
}

.about-header h2 {
  margin: 0;
  font-size: 1.8rem;
  font-weight: bold;
}

.about-close {
  background: rgba(255, 255, 255, 0.2);
  border: none;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  font-size: 1.5rem;
  cursor: pointer;
  color: white;
  transition: 0.3s;
}

.about-close:hover {
  background: rgba(255, 255, 255, 0.3);
  transform: rotate(90deg);
}

.about-body {
  padding: 30px 40px;
  max-height: calc(85vh - 100px);
  overflow-y: auto;
}

.about-section {
  margin-bottom: 30px;
  padding: 25px;
  background: white;
  border-radius: 12px;
  border-left: 4px solid #2563eb;
}

.about-section h3 {
  color: #2563eb;
  font-size: 1.3rem;
  margin-bottom: 15px;
}

.about-section p {
  color: #4b5563;
  line-height: 1.8;
}

.about-section ul {
  list-style: none;
  padding: 0;
}

.about-section ul li {
  padding: 8px 0;
  padding-left: 25px;
  position: relative;
}

.about-section ul li:before {
  content: "‚úì";
  position: absolute;
  left: 0;
  color: #10b981;
  font-weight: bold;
}

.warning-box {
  background: #fef3c7;
  border: 2px solid #f59e0b;
  border-radius: 10px;
  padding: 20px;
  margin: 20px 0;
}

.about-footer {
  text-align: center;
  padding: 20px;
  background: #f3f4f6;
  color: #6b7280;
}

</style>
</head>
<body>

  <header class="topbar">
    <button class="hamburger" onclick="toggleMenu()">‚ò∞</button>
    üéÄ NEURO BUDDYY
  </header>

  <!-- Role Selection Modal (First Visit) -->
<div id="roleModal" class="modal-overlay" style="display: none;">
  <div class="modal-content role-modal">
    <h2>üè• Welcome to NEUROBUDDYY.AI</h2>
    <p style="font-size: 1.1rem; color: #666; margin: 20px 0;">Are you a healthcare professional?</p>
    
    <div class="role-buttons">
      <button class="btn-role btn-doctor" onclick="showDoctorRegister()">
        üë®‚Äç‚öïÔ∏è Yes, I'm a Doctor
      </button>
      <button class="btn-role btn-guest" onclick="closeRoleModal()">
        üë§ Continue as Guest
      </button>
    </div>
    
    <p style="margin-top: 20px; font-size: 0.9rem; color: #999;">
      Already registered? <a href="#" onclick="showDoctorLogin(); event.preventDefault();" style="color: #2563eb; font-weight: bold;">Login here</a>
    </p>
  </div>
</div>

<!-- Doctor Registration Modal -->
<div id="doctorRegModal" class="modal-overlay" style="display: none;">
  <div class="modal-content doctor-form-modal">
    <button class="modal-close" onclick="closeDoctorRegister()">‚úï</button>
    <h2>üë®‚Äç‚öïÔ∏è Doctor Registration</h2>
    <p style="color: #666; margin-bottom: 20px;">Join our network of healthcare professionals</p>
    
    <form id="doctorRegForm" onsubmit="registerDoctor(event)">
      <div class="form-group">
        <label>Full Name *</label>
        <input type="text" id="docName" placeholder="Dr. John Doe" required>
      </div>
      
      <div class="form-group">
        <label>Email *</label>
        <input type="email" id="docEmail" placeholder="doctor@example.com" required>
      </div>
      
      <div class="form-group">
        <label>Password *</label>
        <input type="password" id="docPassword" placeholder="Minimum 6 characters" required minlength="6">
      </div>
      
      <div class="form-group">
        <label>Specialty *</label>
        <select id="docSpecialty" required>
          <option value="">Select Specialty</option>
          <option value="Neurologist">Neurologist</option>
          <option value="Psychiatrist">Psychiatrist</option>
          <option value="Neurosurgeon">Neurosurgeon</option>
          <option value="Neurophysiologist">Neurophysiologist</option>
          <option value="Neuroradiologist">Neuroradiologist</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Phone Number *</label>
        <input type="tel" id="docPhone" placeholder="+91-XXXXXXXXXX" required>
      </div>
      
      <div class="form-group">
        <label>Medical License Number *</label>
        <input type="text" id="docLicense" placeholder="MCI Registration Number" required>
      </div>
      
      <div class="form-buttons">
        <button type="submit" class="btn-submit">
          <span id="regBtnText">Register</span>
          <span id="regBtnLoader" style="display: none;">‚è≥ Processing...</span>
        </button>
        <button type="button" class="btn-cancel" onclick="closeDoctorRegister()">Cancel</button>
      </div>
    </form>
    
    <p class="form-footer">
      Already registered? <a href="#" onclick="showDoctorLogin(); event.preventDefault();">Login here</a>
    </p>
  </div>
</div>

<!-- Doctor Login Modal -->
<div id="doctorLoginModal" class="modal-overlay" style="display: none;">
  <div class="modal-content doctor-form-modal">
    <button class="modal-close" onclick="closeDoctorLogin()">‚úï</button>
    <h2>üë®‚Äç‚öïÔ∏è Doctor Login</h2>
    <p style="color: #666; margin-bottom: 20px;">Access your professional dashboard</p>
    
    <form id="doctorLoginForm" onsubmit="loginDoctor(event)">
      <div class="form-group">
        <label>Email *</label>
        <input type="email" id="loginEmail" placeholder="doctor@example.com" required>
      </div>
      
      <div class="form-group">
        <label>Password *</label>
        <input type="password" id="loginPassword" placeholder="Enter your password" required>
      </div>
      
      <div class="form-buttons">
        <button type="submit" class="btn-submit">
          <span id="loginBtnText">Login</span>
          <span id="loginBtnLoader" style="display: none;">‚è≥ Logging in...</span>
        </button>
        <button type="button" class="btn-cancel" onclick="closeDoctorLogin()">Cancel</button>
      </div>
    </form>
    
    <p class="form-footer">
      Don't have an account? <a href="#" onclick="showDoctorRegister(); event.preventDefault();">Register here</a>
    </p>
  </div>
</div>

<!-- Doctor Dashboard Modal -->
<div id="doctorDashboard" class="modal-overlay" style="display: none;">
  <div class="modal-content doctor-dashboard">
    <button class="modal-close" onclick="closeDoctorDashboard()">‚úï</button>
    <h2>üë®‚Äç‚öïÔ∏è Doctor Dashboard</h2>
    
    <div class="doctor-profile">
      <div class="profile-header">
        <div class="profile-avatar">üë®‚Äç‚öïÔ∏è</div>
        <div class="profile-info">
          <h3 id="dashboardName">Loading...</h3>
          <p id="dashboardSpecialty">Loading...</p>
          <p id="dashboardEmail">Loading...</p>
        </div>
      </div>
      
      <div class="status-selector">
        <label>Your Status:</label>
        <select id="doctorStatusSelect" onchange="updateDoctorStatus()">
          <option value="available">üü¢ Available</option>
          <option value="engaged">üî¥ Engaged</option>
          <option value="offline">‚ö´ Offline</option>
        </select>
      </div>
      
      <div class="dashboard-actions">
        <button class="btn-logout" onclick="logoutDoctor()">üö™ Logout</button>
      </div>
    </div>
  </div>
</div>


  <div class="container">

    <aside class="leftbar" id="sidebar">
      <ul class="menu">
        <li onclick="toggleChatHistory()">üîé Search</li>
<li onclick="openMedicalGallery()">üß† Symptom Gallery</li>
      </ul>
      
      <div class="settings">
  <div onclick="toggleSettings()" style="cursor: pointer; margin-bottom: 8px; display: flex; align-items: center; justify-content: space-between;">
    <span>‚öôÔ∏è Settings</span>
    <span id="settingsArrow" class="settings-arrow">‚ñº</span>
  </div>
  <ul id="settingsSubmenu" style="display: none; list-style: none; padding-left: 10px; margin: 0;">
    <li onclick="openAbout()" style="padding: 8px; background: #376c90; cursor: pointer; border-radius: 5px;">
      üìñ About
    </li>
    <li onclick="openDoctorDashboard()" style="padding: 8px; background: #2563eb; cursor: pointer; border-radius: 5px; margin-top: 5px; color: white;">
      üë®‚Äç‚öïÔ∏è Doctor Portal
    </li>
  </ul>
</div>

      </div>
    </aside>

    <!-- CHAT HISTORY PANEL -->
   <aside id="chatHistoryPanel">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
    <div class="history-header">üí¨ Chat History</div>
    <button onclick="toggleChatHistory()" style="background: #dc2626; color: white; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 0.85rem; transition: 0.2s;" onmouseover="this.style.background='#b91c1c'" onmouseout="this.style.background='#dc2626'">
      ‚úï Close
    </button>
  </div>
  <div id="historyList"></div>
  <button class="clear-history-btn" onclick="clearChatHistory()">üóëÔ∏è Clear History</button>
</aside>


    <main class="chat-section">
      <div class="top-typing-box" id="topTypingBox">
        <div class="typing-title">‚úçÔ∏è You're typing...</div>
        <div id="topTypingContent"></div>
      </div>

      <div class="chat-window" id="chatWindow">
        <div class="bot-msg">üëã Hello! Type your health question below and I'll help you find answers.</div>
      </div>

      <div class="suggestions-box" id="suggestionsBox">
        <div class="suggestions-title">üí° Related Questions (click to select):</div>
        <div id="suggestionsList"></div>
      </div>

      <div class="search-bar">
        <input type="text" id="userInput" placeholder="Type your health question here...">
        <button class="btn send" onclick="sendMessage()">‚¨ÜÔ∏è</button>
        <button class="btn"> <span class="mic">üé§ </span> <span class="upload"> üìÅ </span></button>
      </div>
    </main>

    <aside class="rightbar">
      <button class="emergency" onclick="triggerEmergency()">üö® Emergency</button>
      
      <button class="connect-doctor" onclick="toggleDoctorList()" id="connectDoctorBtn">
        üë®‚Äç‚öïÔ∏è Connect to Doctors
      </button>
      
      <div id="doctorListContainer">
        <div id="doctorList">
          <p class="loading-doctors">Loading doctors...</p>
        </div>
      </div>

      <!-- HOSPITAL LOCATION SECTION -->
      <div class="hospital-section">
        <h2 class="location-title" id="hospitalSectionTitle">üè• Setup Nearest Hospital</h2>
        
        <div class="location-form" id="locationForm">
          <p style="font-size: 0.85rem; color: #666; margin-bottom: 15px;">
            ‚ö†Ô∏è Required for Emergency Button
          </p>
          
          <select id="stateInput" class="location-input" onchange="loadDistricts()">
            <option value="">Select State</option>
            <option value="Delhi">Delhi</option>
            <option value="Maharashtra">Maharashtra</option>
            <option value="Karnataka">Karnataka</option>
            <option value="Tamil Nadu">Tamil Nadu</option>
            <option value="West Bengal">West Bengal</option>
            <option value="Gujarat">Gujarat</option>
            <option value="Rajasthan">Rajasthan</option>
            <option value="Uttar Pradesh">Uttar Pradesh</option>
            <option value="Assam">Assam</option>
          </select>
          
          <select id="districtInput" class="location-input" disabled onchange="loadAreas()">
            <option value="">Select District</option>
          </select>
          
          <select id="areaInput" class="location-input" disabled>
            <option value="">Select Area</option>
          </select>
          
          <button class="save-location-btn" onclick="saveUserLocation()">
            üíæ Save Location
          </button>
        </div>
        
        <div id="savedLocationDisplay" style="display: none;"></div>
      </div>
    </aside>

  </div>

  <!-- Enhanced About Modal -->
<div id="aboutModal">
  <div class="about-content">
    <!-- Header with Close Button -->
    <div class="about-header">
      <h2>üß† About NEUROBUDDYY.AI</h2>
      <button class="about-close" onclick="closeAbout()">‚úï</button>
    </div>
    
    <!-- Scrollable Body Content -->
    <div class="about-body">
      
      <!-- Platform Overview -->
      <div class="about-section">
        <h3>üè• Platform Overview</h3>
        <p>
          <strong>NEUROBUDDYY.AI</strong> is an advanced AI-powered healthcare platform 
          specializing in neurological and brain-related health information. We combine 
          cutting-edge artificial intelligence with medical knowledge to provide instant, 
          reliable answers to your health questions 24/7.
        </p>
        <p>
          Our mission is to democratize healthcare information, making expert-level 
          neurological knowledge accessible to everyone, anywhere, at any time. Whether 
          you're experiencing symptoms, seeking information about a diagnosis, or simply 
          learning about brain health, NEUROBUDDYY.AI is here to help.
        </p>
      </div>

      <!-- Key Features -->
      <div class="about-section">
        <h3>‚≠ê Key Features</h3>
        <ul>
          <li><strong>AI-Powered Chat Assistant:</strong> Get instant answers to health questions using advanced natural language processing</li>
          <li><strong>Neurological Expertise:</strong> Specialized knowledge in brain disorders, stroke, epilepsy, Alzheimer's, Parkinson's, and more</li>
          <li><strong>Medical Image Gallery:</strong> Educational library of neurological conditions with visual references</li>
          <li><strong>Doctor Network:</strong> Connect with verified neurologists and healthcare professionals in real-time</li>
          <li><strong>Chat History:</strong> Access your previous conversations and track your health inquiries</li>
          <li><strong>Emergency Assistance:</strong> Quick access to nearest hospitals and emergency services</li>
          <li><strong>Privacy-First:</strong> Your health data is encrypted and stored securely</li>
        </ul>
      </div>

      <!-- Specializations -->
      <div class="about-section">
        <h3>üß™ Our Specializations</h3>
        <p>NEUROBUDDYY.AI provides comprehensive information on:</p>
        <ul>
          <li>Brain tumors and cancer</li>
          <li>Stroke (ischemic and hemorrhagic)</li>
          <li>Epilepsy and seizure disorders</li>
          <li>Alzheimer's disease and dementia</li>
          <li>Parkinson's disease</li>
          <li>Multiple sclerosis (MS)</li>
          <li>Migraines and headaches</li>
          <li>Traumatic brain injury (TBI)</li>
          <li>Mental health and neuropsychiatric conditions</li>
          <li>Sleep disorders</li>
        </ul>
      </div>

      <!-- How It Works -->
      <div class="about-section">
        <h3>üîß How It Works</h3>
        <p>
          <strong>1. Ask Your Question:</strong> Type your health concern or symptom in the chat box. 
          Our AI will analyze your query and provide relevant medical information.
        </p>
        <p>
          <strong>2. Get Intelligent Suggestions:</strong> As you type, the system suggests related 
          questions to help you find exactly what you're looking for.
        </p>
        <p>
          <strong>3. Review Detailed Answers:</strong> Receive comprehensive, evidence-based information 
          with medical references and recommendations.
        </p>
        <p>
          <strong>4. Connect with Doctors:</strong> If needed, connect with verified neurologists 
          through our platform for professional consultation.
        </p>
      </div>

      <!-- Important Usage Instructions -->
      <div class="warning-box">
        <h4>‚ö†Ô∏è Important Usage Instructions</h4>
        <p>
          <strong>For accurate responses:</strong> When using the chatbot, please select your 
          question from the <strong>suggestion box</strong> that appears while typing. If you 
          type a question manually without selecting from suggestions, it may cause errors or 
          incomplete responses. Always choose from the provided suggestions for the best experience.
        </p>
      </div>

      <!-- Medical Disclaimer -->
      <div class="about-section">
        <h3>‚öñÔ∏è Medical Disclaimer</h3>
        <p>
          <strong>NEUROBUDDYY.AI is NOT a replacement for professional medical advice, 
          diagnosis, or treatment.</strong> The information provided on this platform is for 
          educational and informational purposes only.
        </p>
        <p>
          Always seek the advice of your physician or qualified healthcare provider with any 
          questions you may have regarding a medical condition. Never disregard professional 
          medical advice or delay seeking it because of information you received from this platform.
        </p>
        <p>
          <strong>In case of medical emergencies:</strong> Call your local emergency number 
          immediately. Do not rely on online information for emergency medical situations.
        </p>
      </div>

      <!-- Technology & Security -->
      <div class="about-section">
        <h3>üîí Technology & Security</h3>
        <p>
          NEUROBUDDYY.AI is built using state-of-the-art technologies including advanced 
          natural language processing (NLP), machine learning models trained on medical 
          literature, and secure cloud infrastructure.
        </p>
        <p>
          <strong>Your privacy matters:</strong> All conversations are encrypted end-to-end. 
          We do not share your personal health information with third parties. Your data is 
          stored securely in compliance with healthcare data protection regulations.
        </p>
      </div>

      <!-- Contact & Support -->
      <div class="about-section">
        <h3>üìû Contact & Support</h3>
        <p>
          Have questions, feedback, or technical issues? We're here to help!
        </p>
        <p>
          <strong>Email:</strong> support@neurobuddyy.ai<br>
          <strong>Response Time:</strong> Within 24 hours<br>
          <strong>Platform Status:</strong> Operational 24/7
        </p>
      </div>

    </div>

    <!-- Footer -->
    <div class="about-footer">
      <strong>¬© 2025 NEUROBUDDYY.AI</strong><br>
      Empowering Health Through AI Technology
    </div>
  </div>
</div>


<script>
  const BACKEND_URL = 'https://neurobuddyy-ai.onrender.com';

  // ========== HOSPITAL LOCATION FEATURE ==========

  const districtData = {
  "Andaman & Nicobar Islands": ["Nicobar","North & Middle Andaman","South Andaman"],
  "Andhra Pradesh": ["Anantapur","Chittoor","East Godavari","Guntur","Kadapa","Krishna","Kurnool","Nellore","Prakasam","Srikakulam","Visakhapatnam","Vizianagaram","West Godavari"],
  "Arunachal Pradesh": ["Anjaw","Changlang","East Kameng","East Siang","Kurung Kumey","Lohit","Lower Dibang Valley","Lower Siang","Lower Subansiri","Namsai","Papum Pare","Shi Yomi","Siang","Tawang","Tirap","Upper Dibang Valley","Upper Siang","Upper Subansiri","West Kameng","West Siang"],
  "Assam": ["Baksa","Barpeta","Biswanath","Bongaigaon","Cachar","Charaideo","Chirang","Darrang","Dhemaji","Dhubri","Dibrugarh","Dima Hasao","Guwahati","Goalpara","Golaghat","Hailakandi","Hojai","Jorhat","Kamrup","Kamrup Metropolitan","Karbi Anglong","Karimganj","Kokrajhar","Lakhimpur","Majuli","Morigaon","Nagaon","Nalbari","Sivasagar","Sonitpur","Tinsukia","Udalguri","West Karbi Anglong"],
  "Bihar": ["Araria","Arwal","Aurangabad","Banka","Begusarai","Bhagalpur","Bhojpur","Buxar","Darbhanga","East Champaran","Gaya","Gopalganj","Jamui","Jehanabad","Kaimur","Katihar","Khagaria","Kishanganj","Lakhisarai","Madhepura","Madhubani","Munger","Muzaffarpur","Nalanda","Nawada","Pashchim Champaran","Patna","Purba Champaran","Purnia","Rohtas","Saharsa","Samastipur","Saran","Sheikhpura","Sheohar","Sitamarhi","Siwan","Supaul","Vaishali","West Champaran"],
  "Chandigarh": ["Chandigarh"],
  "Chhattisgarh": ["Balod","Baloda Bazar","Balrampur","Bastar","Bemetara","Bijapur","Bilaspur","Dakshin Bastar (Dantewada)","Dhamtari","Durg","Gariaband","Janjgir-Champa","Jashpur","Kabirdham","Kanker","Kondagaon","Korba","Koriya","Mahasamund","Mungeli","Narayanpur","Raigarh","Raipur","Rajnandgaon","Sukma","Surajpur","Surguja"],
  "Dadra & Nagar Haveli and Daman & Diu": ["Dadra & Nagar Haveli","Daman","Diu"],
  "Delhi": ["Central Delhi","East Delhi","New Delhi","North Delhi","North East Delhi","North West Delhi","Shahdara","South Delhi","South East Delhi","South West Delhi","West Delhi"],
  "Goa": ["North Goa","South Goa"],
  "Gujarat": ["Ahmedabad","Amreli","Anand","Aravalli","Banaskantha","Bharuch","Bhavnagar","Botad","Chhota Udaipur","Dahod","Dang","Devbhoomi Dwarka","Gandhinagar","Gir Somnath","Jamnagar","Junagadh","Kheda","Kutch","Mahisagar","Mehsana","Morbi","Narmada","Navsari","Panchmahal","Patan","Porbandar","Rajkot","Sabarkantha","Surat","Surendranagar","Tapi","Vadodara","Valsad"],
  "Haryana": ["Ambala","Bhiwani","Charkhi Dadri","Faridabad","Fatehabad","Gurugram","Hisar","Jhajjar","Jind","Kaithal","Kurukshetra","Mahendragarh","Nuh","Palwal","Panchkula","Panipat","Rewari","Rohtak","Sirsa","Sonipat","Yamunanagar"],
  "Himachal Pradesh": ["Bilaspur","Chamba","Hamirpur","Kangra","Kinnaur","Kullu","Lahaul & Spiti","Mandi","Shimla","Sirmaur","Solan","Una"],
  "Jammu & Kashmir": ["Anantnag","Bandipora","Baramulla","Budgam","Doda","Ganderbal","Kulgam","Kupwara","Kishtwar","Poonch","Pulwama","Ramban","Reasi","Samba","Shopian","Srinagar","Udhampur","Rajouri","Kathua"],
  "Jharkhand": ["Bokaro","Chatra","Deoghar","Dhanbad","Dumka","East Singhbhum","Garhwa","Giridih","Godda","Gumla","Hazaribagh","Jamtara","Khunti","Koderma","Latehar","Lohardaga","Pakur","Palamu","Ramgarh","Ranchi","Sahibganj","Seraikela Kharsawan","Simdega","West Singhbhum"],
  "Karnataka": ["Bagalkot","Ballari","Belagavi","Bengaluru Rural","Bengaluru Urban","Bidar","Chamarajanagar","Chikkaballapura","Chikkamagaluru","Chitradurga","Dakshina Kannada","Davanagere","Dharwad","Gadag","Hassan","Haveri","Kalaburagi","Kodagu","Kolar","Mandya","Mysuru","Raichur","Ramanagara","Shivamogga","Tumakuru","Udupi","Uttara Kannada","Vijayapura","Yadgir"],
  "Kerala": ["Alappuzha","Ernakulam","Idukki","Kannur","Kasaragod","Kollam","Kottayam","Kozhikode","Malappuram","Palakkad","Pathanamthitta","Thiruvananthapuram","Thrissur","Wayanad"],
  "Lakshadweep": ["Lakshadweep"],
  "Madhya Pradesh": ["Agar Malwa","Alirajpur","Anuppur","Ashoknagar","Balaghat","Barwani","Betul","Bhind","Bhopal","Burhanpur","Chhatarpur","Chhindwara","Damoh","Datia","Dewas","Dhar","Dindori","Guna","Gwalior","Harda","Hoshangabad","Indore","Jabalpur","Jhabua","Katni","Khandwa","Khargone","Mandla","Mandsaur","Morena","Narsinghpur","Neemuch","Panna","Rajgarh","Ratlam","Rewa","Sagar","Satna","Sehore","Seoni","Shahdol","Shajapur","Sheopur","Shivpuri","Singrauli","Tikamgarh","Ujjain"],
  "Maharashtra": ["Ahmednagar","Akola","Amravati","Aurangabad","Beed","Bhandara","Buldhana","Chandrapur","Dhule","Gadchiroli","Gondia","Hingoli","Jalgaon","Jalna","Kolhapur","Latur","Mumbai City","Mumbai Suburban","Nagpur","Nanded","Nandurbar","Nashik","Osmanabad","Palghar","Parbhani","Pune","Raigad","Ratnagiri","Sangli","Satara","Sindhudurg","Solapur","Thane","Wardha","Washim","Yavatmal"],
  "Manipur": ["Bishnupur","Chandel","Churachandpur","Imphal East","Imphal West","Jiribam","Kakching","Kamjong","Kangpokpi","Noney","Pherzawl","Senapati","Tamenglong","Tengnoupal","Thoubal","Ukhrul"],
  "Meghalaya": ["East Garo Hills","East Jaintia Hills","East Khasi Hills","North Garo Hills","Ri Bhoi","South Garo Hills","South West Garo Hills","West Garo Hills","West Jaintia Hills","West Khasi Hills"],
  "Mizoram": ["Aizawl","Champhai","Hnahthial","Khawzawl","Kolasib","Lawngtlai","Lunglei","Mamit","Siaha","Serchhip"],
  "Nagaland": ["Dimapur","Kiphire","Kohima","Longleng","Mokokchung","Mon","Niuland","Noklak","Peren","Phek","Tuensang","Wokha","Z√ºnheboto"],
  "Odisha": ["Angul","Balangir","Balasore","Bargarh","Bhadrak","Boudh","Cuttack","Deogarh","Dhenkanal","Gajapati","Ganjam","Jagatsinghpur","Jajpur","Jharsuguda","Kalahandi","Kandhamal","Kendrapara","Kendujhar","Khordha","Koraput","Malkangiri","Mayurbhanj","Nabarangpur","Nayagarh","Nuapada","Puri","Rayagada","Sambalpur","Sonepur","Sundergarh"],
  "Puducherry": ["Karaikal","Mahe","Puducherry","Yanam"],
  "Punjab": ["Amritsar","Barnala","Bathinda","Faridkot","Fatehgarh Sahib","Fazilka","Firozpur","Gurdaspur","Hoshiarpur","Jalandhar","Kapurthala","Ludhiana","Mansa","Moga","Pathankot","Patiala","Rupnagar","Sahibzada Ajit Singh Nagar (Mohali)","Sangrur","Tarn Taran"],
  "Rajasthan": ["Ajmer","Alwar","Banswara","Baran","Barmer","Bharatpur","Bhilwara","Bikaner","Bundi","Chittorgarh","Churu","Dausa","Dholpur","Dungarpur","Hanumangarh","Jaipur","Jaisalmer","Jalore","Jhalawar","Jhunjhunu","Jodhpur","Karauli","Kota","Nagaur","Pali","Pratapgarh","Rajsamand","Sawai Madhopur","Sikar","Sirohi","Sri Ganganagar","Tonk","Udaipur"],
  "Sikkim": ["East Sikkim","North Sikkim","South Sikkim","West Sikkim"],
  "Tamil Nadu": ["Ariyalur","Chengalpattu","Chennai","Coimbatore","Cuddalore","Dharmapuri","Dindigul","Erode","Kallakurichi","Kanchipuram","Kanyakumari","Karur","Krishnagiri","Madurai","Nagapattinam","Namakkal","Nilgiris","Perambalur","Pudukkottai","Ramanathapuram","Ranipet","Salem","Sivaganga","Tenkasi","Thanjavur","Theni","Thoothukudi","Tiruchirappalli","Tirunelveli","Tirupathur","Tiruppur","Tiruvallur","Tiruvannamalai","Tiruvarur","Vellore","Viluppuram","Virudhunagar"],
  "Telangana": ["Adilabad","Bhadradri Kothagudem","Hyderabad","Jagtial","Jangaon","Jayashankar Bhupalpally","Jogulamba Gadwal","Kamareddy","Karimnagar","Khammam","Kumuram Bheem Asifabad","Mahabubabad","Mahabubnagar","Mancherial","Medak","Medchal-Malkajgiri","Mulugu","Nagarkurnool","Nalgonda","Narayanpet","Nizamabad","Peddapalli","Rajanna Sircilla","Ranga Reddy","Sangareddy","Siddipet","Suryapet","Vikarabad","Wanaparthy","Warangal (Urban)","Warangal (Rural)","Yadadri Bhuvanagiri"],
  "Tripura": ["Dhalai","Gomati","Khowai","North Tripura","Sepahijala","South Tripura","Unakoti","West Tripura"],
  "Uttarakhand": ["Almora","Bageshwar","Chamoli","Champawat","Dehradun","Haridwar","Nainital","Pauri Garhwal","Pithoragarh","Rudraprayag","Tehri Garhwal","Udham Singh Nagar","Uttarkashi"],
  "Uttar Pradesh": ["Agra","Aligarh","Ambedkar Nagar","Amethi","Amroha","Auraiya","Ayodhya","Azamgarh","Baghpat","Bahraich","Ballia","Banda","Barabanki","Bareilly","Basti","Bijnor","Bulandshahr","Chandauli","Chitrakoot","Deoria","Etah","Etawah","Farrukhabad","Fatehpur","Firozabad","Gautam Buddha Nagar","Ghaziabad","Ghazipur","Hardoi","Hathras","Jalaun","Jaunpur","Jhansi","Kannauj","Kanpur Dehat","Kanpur Nagar","Kasganj","Kaushambi","Kushinagar","Lalitpur","Lucknow","Maharajganj","Mahoba","Mainpuri","Mathura","Mau","Meerut","Mirzapur","Moradabad","Muzaffarnagar","Pilibhit","Pratapgarh","Rae Bareli","Rampur","Saharanpur","Sambhal","Sant Kabir Nagar","Shahjahanpur","Shamli","Shravasti","Siddharthnagar","Sitapur","Sonbhadra","Sultanpur","Unnao","Varanasi"],
  "West Bengal": ["Alipurduar","Bankura","Birbhum","Cooch Behar","Dakshin Dinajpur","Darjeeling","Hooghly","Howrah","Jalpaiguri","Jhargram","Kalimpong","Kolkata","Malda","Murshidabad","Nadia","North 24 Parganas","Paschim Medinipur","Purba Medinipur","Purulia","South 24 Parganas","Uttar Dinajpur"]
};


  const areaData = {
  // DELHI (All 11 Districts)
  "Central Delhi": ["Connaught Place", "Karol Bagh", "Paharganj", "Rajinder Nagar", "Patel Nagar"],
  "South Delhi": ["Hauz Khas", "Saket", "Greater Kailash", "Lajpat Nagar", "Nehru Place", "Defence Colony"],
  "West Delhi": ["Rajouri Garden", "Janakpuri", "Punjabi Bagh", "Vikaspuri", "Tilak Nagar"],
  "New Delhi": ["Lodhi Road", "Chanakyapuri", "RK Puram", "Khan Market", "Vasant Vihar"],
  "North Delhi": ["Civil Lines", "Kamla Nagar", "Model Town", "Kashmere Gate", "Shakti Nagar"],
  "East Delhi": ["Preet Vihar", "Laxmi Nagar", "Mayur Vihar", "Gandhi Nagar", "Krishna Nagar"],
  "North East Delhi": ["Seelampur", "Shahdara", "Dilshad Garden", "Nand Nagri", "Yamuna Vihar"],
  "North West Delhi": ["Rohini", "Pitampura", "Shalimar Bagh", "Model Town", "Saraswati Vihar"],
  "South East Delhi": ["Kalkaji", "Okhla", "Jamia Nagar", "Govindpuri", "Sarita Vihar"],
  "South West Delhi": ["Dwarka", "Vasant Kunj", "Najafgarh", "Uttam Nagar", "Kapashera"],
  "Shahdara": ["Dilshad Garden", "Karkardooma", "Vivek Vihar", "Jhilmil", "Nand Nagri"],

  // MUMBAI
  "Mumbai City": ["Colaba", "Fort", "Marine Drive", "Churchgate", "Nariman Point", "Girgaon"],
  "Mumbai Suburban": ["Andheri", "Bandra", "Borivali", "Dadar", "Kurla", "Mulund", "Goregaon"],

  // BANGALORE
  "Bengaluru Urban": ["Koramangala", "Whitefield", "Indiranagar", "Jayanagar", "Electronic City", "BTM Layout"],
  "Bengaluru Rural": ["Nelamangala", "Doddaballapura", "Devanahalli", "Hosakote"],

  // CHENNAI
  "Chennai": ["T Nagar", "Anna Nagar", "Velachery", "Adyar", "Mylapore", "Egmore", "Nungambakkam"],

  // KOLKATA
  "Kolkata": ["Salt Lake", "Park Street", "Ballygunge", "Alipore", "New Town", "Behala", "Tollygunge"],
  "Howrah": ["Shibpur", "Liluah", "Bally", "Santragachi", "Howrah Maidan"],

  // HYDERABAD
  "Hyderabad": ["Banjara Hills", "Jubilee Hills", "HITEC City", "Gachibowli", "Madhapur", "Secunderabad"],

  // PUNE
  "Pune": ["Koregaon Park", "Shivaji Nagar", "Kothrud", "Hinjewadi", "Viman Nagar", "Aundh", "Deccan"],

  // AHMEDABAD
  "Ahmedabad": ["Satellite", "Vastrapur", "CG Road", "Maninagar", "Navrangpura", "Bopal"],

  // JAIPUR
  "Jaipur": ["Malviya Nagar", "C-Scheme", "MI Road", "Vaishali Nagar", "Mansarovar", "Raja Park"],

  // LUCKNOW
  "Lucknow": ["Hazratganj", "Gomti Nagar", "Alambagh", "Aliganj", "Indira Nagar", "Mahanagar"],

  // KANPUR
  "Kanpur Nagar": ["Civil Lines", "Swaroop Nagar", "Kakadeo", "Panki", "GTB Nagar"],

  // NAGPUR
  "Nagpur": ["Sitabuldi", "Dharampeth", "Sadar", "Civil Lines", "Khamla", "Wardha Road"],

  // INDORE
  "Indore": ["Vijay Nagar", "Palasia", "MG Road", "Rau", "Sanwer Road", "AB Road"],

  // BHOPAL
  "Bhopal": ["New Market", "MP Nagar", "Arera Colony", "Kolar", "Berasia Road"],

  // PATNA
  "Patna": ["Boring Road", "Fraser Road", "Kankarbagh", "Rajendra Nagar", "Patliputra", "Gandhi Maidan"],

  // SURAT
  "Surat": ["Adajan", "Vesu", "Piplod", "Athwa", "Katargam", "Rander"],

  // VISAKHAPATNAM
  "Visakhapatnam": ["MVP Colony", "Dwaraka Nagar", "Gajuwaka", "Madhurawada", "Rushikonda"],

  // VADODARA
  "Vadodara": ["Alkapuri", "Sayajigunj", "Fatehgunj", "Manjalpur", "Gotri", "Akota"],

  // CHANDIGARH
  "Chandigarh": ["Sector 17", "Sector 22", "Sector 35", "Elante Mall", "Sukhna Lake"],

  // GUWAHATI
  "Guwahati": ["Fancy Bazar", "Paltan Bazar", "Pan Bazaar", "Ulubari", "Six Mile", "Beltola", "Ganeshguri"],
  "Kamrup Metropolitan": ["Dispur", "Bharalumukh", "Maligaon", "Khanapara", "Basistha"],
  
  // GOALPARA
  "Goalpara": ["Seven Sister Hospital","Goalpara Railway Station","Near Transport","Pragati-Nagar","Bara Bazar","Lakhipur","Dudhnoi","Matia","Rangjuli","Balijana","Agia","Krishnai","Civil Hospital Goalpara","Goalpara Circuit House","DC Office Road","Goalpara College","Mission Chariali","Kachugaon","Jaleswar","Goalpara Stadium","Old Bus Stand","New Market Area","Goalpara Police Station","Block Development Office","Goalpara Post Office","NH-17 Road","Goalpara Medical College Area"],


  // COIMBATORE
  "Coimbatore": ["RS Puram", "Gandhipuram", "Peelamedu", "Saibaba Colony", "Race Course"],

  // KOCHI/ERNAKULAM
  "Ernakulam": ["Marine Drive", "MG Road", "Kadavanthra", "Kaloor", "Edappally", "Kakkanad"],

  // THIRUVANANTHAPURAM
  "Thiruvananthapuram": ["Vellayambalam", "Pattom", "Vazhuthacaud", "Sasthamangalam", "Medical College"],

  // KOZHIKODE
  "Kozhikode": ["SM Street", "Mavoor Road", "West Hill", "Kallai", "Beach Road"],

  // MYSURU
  "Mysuru": ["Chamundipuram", "Saraswathipuram", "Kuvempunagar", "Vijayanagar", "Yadavagiri"],

  // MADURAI
  "Madurai": ["Anna Nagar", "KK Nagar", "Sellur", "Villapuram", "Goripalayam"],

  // AGRA
  "Agra": ["Sadar Bazaar", "Kamla Nagar", "Sikandra", "Dayal Bagh", "Tajganj", "Sanjay Place"],

  // VARANASI
  "Varanasi": ["Godowlia", "Lanka", "Sigra", "Bhelupur", "Maidagin", "Lahurabir"],

  // RANCHI
  "Ranchi": ["Albert Ekka Chowk", "Harmu", "Doranda", "Kanke", "Hinoo", "Lalpur"],

  // JODHPUR
  "Jodhpur": ["Paota", "Sardarpura", "Shastri Nagar", "Ratanada", "Chopasni"],

  // GWALIOR
  "Gwalior": ["Lashkar", "Morar", "City Centre", "Thatipur", "Kampoo"],

  // GURUGRAM
  "Gurugram": ["DLF Phase 1", "Sector 14", "MG Road", "Sohna Road", "Golf Course Road", "Cyber City"],

  // FARIDABAD
  "Faridabad": ["Sector 15", "NIT", "Old Faridabad", "Sector 21", "Ballabhgarh"],

  // AMRITSAR
  "Amritsar": ["Ranjit Avenue", "Mall Road", "Lawrence Road", "Golden Temple", "Majitha Road"],

  // LUDHIANA
  "Ludhiana": ["Sarabha Nagar", "Civil Lines", "Model Town", "Dugri", "Ferozepur Road"],

  // JALANDHAR
  "Jalandhar": ["Model Town", "Civil Lines", "Cantt Area", "Ladowali Road", "Kapurthala Road"],

  // DEHRADUN
  "Dehradun": ["Rajpur Road", "Mussoorie Road", "Sahastradhara Road", "Clock Tower", "Clement Town"],

  // HARIDWAR
  "Haridwar": ["Har Ki Pauri", "BHEL", "Jwalapur", "Ranipur", "Kankhal"],

  // SILIGURI
  "Darjeeling": ["Chowrasta", "Mall Road", "Ghoom", "Lebong", "Happy Valley"],

  // RAIPUR
  "Raipur": ["Shankar Nagar", "Civil Lines", "Devendra Nagar", "Pandri", "Telibandha"],

  // BILASPUR (Chhattisgarh)
  "Bilaspur": ["Vyapar Vihar", "Nehru Nagar", "Link Road", "Torwa", "Seepat Road"],

  // JAMMU
  "Jammu": ["Gandhi Nagar", "Bahu Plaza", "Residency Road", "Raghunath Bazar", "Canal Road"],

  // SRINAGAR
  "Srinagar": ["Lal Chowk", "Dal Lake", "Residency Road", "Rajbagh", "Jawahar Nagar"],

  // GUWAHATI OTHER AREAS
  "Dibrugarh": ["Graham Bazar", "Mancotta Road", "Chowkidingee", "Lahowal"],
  "Jorhat": ["AT Road", "Gar Ali", "Mithapukhuri", "Tarajan"],
  "Tinsukia": ["Rangagora", "Bordumsa", "Makum", "Panitola"],
  "Silchar": ["Tarapur", "Rangirkhari", "Premtala", "Ambicapatty"],

  // WEST BENGAL
  "North 24 Parganas": ["Barasat", "Barrackpore", "Dum Dum", "Madhyamgram", "New Town"],
  "South 24 Parganas": ["Sonarpur", "Baruipur", "Diamond Harbour", "Canning"],

  // TELANGANA
  "Warangal (Urban)": ["Kazipet", "Hanamkonda", "Subedari", "Nakkalagutta"],
  "Karimnagar": ["Mankammathota", "Mukarampura", "Bhagathnagar", "Ramnagar"],

  // ANDHRA PRADESH
  "Guntur": ["Lakshmipuram", "Arundelpet", "Brodipet", "Kothapet"],
  "Vijayawada": ["Benz Circle", "Governorpet", "Patamata", "Auto Nagar"],

  // KERALA
  "Kannur": ["Fort Road", "Thalassery", "Payyambalam", "Thana"],
  "Kollam": ["Chinnakada", "Kilikollur", "Asramam", "Sakthikulangara"],

  // RAJASTHAN
  "Udaipur": ["City Palace", "Lake Pichola", "Fateh Sagar", "Bapu Bazar"],
  "Bikaner": ["Karni Nagar", "Rani Bazar", "Ganganagar Road"],
  "Ajmer": ["Pushkar", "Vaishali Nagar", "Nasirabad", "Beawar"],

  // MADHYA PRADESH
  "Jabalpur": ["Napier Town", "Civil Lines", "Russell Chowk", "Vijay Nagar"],
  "Ujjain": ["Freeganj", "Dewas Gate", "Mahakal Temple", "Dhanvantri Nagar"],

  // UTTAR PRADESH
  "Allahabad": ["Civil Lines", "Georgetown", "Katra", "Lukerganj"],
  "Meerut": ["Shastri Nagar", "Brahmpuri", "Sadar Bazar", "Pallavpuram"],
  "Bareilly": ["Civil Lines", "Pilibhit Road", "CB Ganj", "Subhash Nagar"],

  // BIHAR
  "Gaya": ["Town Hall", "Rampur", "Tikari", "Manpur"],
  "Bhagalpur": ["Nathnagar", "Tilkamanjhi", "Sabour", "Kahalgaon"],
  "Muzaffarpur": ["Juran Chhapra", "Motipur", "Brahampur"],

  // GOA
  "North Goa": ["Panaji", "Mapusa", "Candolim", "Calangute", "Baga", "Anjuna"],
  "South Goa": ["Margao", "Colva", "Benaulim", "Palolem", "Vasco da Gama"],

  // JHARKHAND
  "Dhanbad": ["Bank More", "Hirapur", "Saraidhela", "Jharia"],
  "Jamshedpur": ["Bistupur", "Sakchi", "Mango", "Kadma", "Sonari"],

  // ODISHA
  "Bhubaneswar": ["Kharavel Nagar", "Sahid Nagar", "Patia", "Chandrasekharpur"],
  "Cuttack": ["Buxi Bazar", "Badambadi", "Link Road", "College Square"],
  "Puri": ["Swargadwar", "Grand Road", "Sea Beach", "Balighai"],

  // ASSAM (More Districts)
  "Nagaon": ["Ward No 1", "Haiborgaon", "Bamungaon", "Juria"],
  "Barpeta": ["Barpeta Road", "Pathsala", "Sarthebari", "Baghbar"],
  "Sivasagar": ["AT Road", "Gaurisagar", "Nazira", "Amguri"],
  
  // ADDITIONAL COVERAGE
  "Dharwad": ["Vidyanagar", "Navoday Nagar", "Tolnur", "Hubli"],
  "Belgaum": ["Tilakwadi", "Camp Area", "Shahu Nagar", "Hindalga"],
  "Mangalore": ["Hampankatta", "Bunts Hostel", "Kadri", "Kankanady"],
  "Aurangabad": ["Town Centre", "Cidco", "Garkheda", "MIDC"],
  "Nashik": ["College Road", "Gangapur Road", "Satpur", "Mumbai Nagar"],
  "Kolhapur": ["Shahupuri", "Rajarampuri", "New Shahupuri", "Station Road"],
  "Solapur": ["Sakhar Peth", "Sidheshwar Peth", "Railway Lines", "Hotgi Road"],
  "Salem": ["Fairlands", "Hasthampatty", "Fort", "Ammapet"],
  "Tirupur": ["Kumaran Road", "Big Bazaar", "Gandhi Nagar", "Kangeyam Road"],
  "Trichy": ["Thillai Nagar", "Cantonment", "Srirangam", "K K Nagar"],
  "Tiruvallur": ["Redhills", "Poonamallee", "Avadi", "Ambattur"],
  "Vellore": ["Officer's Line", "Sathuvachari", "Gandhi Nagar", "Thorapadi"],
  "Tirunelveli": ["Palayamkottai", "Vannarpet", "High Ground", "Melapalayam"],
  "Wayanad": ["Kalpetta", "Mananthavady", "Sulthan Bathery", "Meppadi"],
  "Malappuram": ["Mini Bypass", "Down Hill", "Manjeri", "Tirur"],
  "Thrissur": ["Round", "Swaraj Round", "East Fort", "Vadakkumnathan"],
  "Alappuzha": ["Beach Road", "Iron Bridge", "Mullackal", "Thathampally"],
  "Shimla": ["Mall Road", "Lakkar Bazar", "Sanjauli", "Jakhoo"],
  "Dharamshala": ["McLeod Ganj", "Lower Dharamshala", "Kotwali Bazar", "Naddi"],
  "Gangtok": ["MG Marg", "Lal Bazar", "Tadong", "Deorali"],
  "Imphal": ["Paona Bazar", "Thangal Bazar", "Singjamei", "Uripok"],
  "Kohima": ["Aradurah Hill", "PR Hill", "High School", "New Market"],
  "Aizawl": ["Bara Bazar", "Zarkawt", "Dawrpui", "Thuampui"],
  "Shillong": ["Police Bazar", "Laitumkhrah", "Laban", "Mawlai"],
  "Agartala": ["Battala", "Palace Compound", "GB Road", "Abhoynagar"],
  "Port Blair": ["Aberdeen Bazaar", "Haddo", "Phoenix Bay", "Atlanta Point"],

  // CONTINUE FROM WHERE WE LEFT OFF - ADD THESE TO YOUR areaData:

// ========== ASSAM (Missing Districts) ==========
"Baksa": ["Mushalpur", "Tamulpur", "Barama", "Tihu"],
"Chirang": ["Kajalgaon", "Bijni", "Sidli", "Runikhata"],
"Dhemaji": ["Dhemaji Town", "Jonai", "Silapathar", "Sissiborgaon"],
"Dhubri": ["Dhubri Town", "Bilasipara", "Gauripur", "South Salmara"],
"Dima Hasao": ["Haflong", "Maibang", "Mahur", "Umrangso"],
"Hojai": ["Hojai Town", "Lanka", "Lumding", "Doboka"],
"Karimganj": ["Karimganj Town", "Badarpur", "Patharkandi", "Ramkrishna Nagar"],
"Kokrajhar": ["Kokrajhar Town", "Gossaigaon", "Dotma", "Fakirganj"],
"Lakhimpur": ["North Lakhimpur", "Dhakuakhana", "Bihpuria", "Narayanpur"],
"Majuli": ["Garamur", "Kamalabari", "Jengraimukh", "Phuloni"],
"Morigaon": ["Morigaon Town", "Jagiroad", "Laharighat", "Moirabari"],
"Nalbari": ["Nalbari Town", "Tihu", "Mukalmua", "Barbari"],
"Udalguri": ["Udalguri Town", "Bhergaon", "Mazbat", "Kalaigaon"],
"West Karbi Anglong": ["Hamren", "Donka", "Baithalangso", "Lumbajong"],
"Cachar": ["Silchar Town", "Udharbond", "Sonai", "Lakhipur"],
"Charaideo": ["Sonari", "Sapekhati", "Mahmora", "Rajgarh"],
"Darrang": ["Mangaldoi", "Dalgaon", "Kalaigaon", "Sipajhar"],
"Golaghat": ["Golaghat Town", "Bokakhat", "Sarupathar", "Dergaon"],
"Hailakandi": ["Hailakandi Town", "Katlicherra", "Lala", "Algapur"],
"Kamrup": ["Rangia", "Hajo", "Chhaygaon", "Boko"],
"Karbi Anglong": ["Diphu", "Bokajan", "Howraghat", "Donka"],
"Sonitpur": ["Tezpur", "Biswanath Chariali", "Rangapara", "Dhekiajuli"],

// ========== BIHAR (Missing Districts) ==========
"Araria": ["Araria Town", "Forbesganj", "Raniganj", "Jokihat"],
"Arwal": ["Arwal Town", "Kurtha", "Kaler", "Karpi"],
"Aurangabad": ["Aurangabad Town", "Daudnagar", "Goh", "Rafiganj"],
"Banka": ["Banka Town", "Katoria", "Amarpur", "Barahat"],
"Begusarai": ["Begusarai Town", "Barauni", "Khudhabandpur", "Teghra"],
"Bhojpur": ["Ara Town", "Jagdishpur", "Piro", "Shahpur"],
"Buxar": ["Buxar Town", "Dumraon", "Chausa", "Rajpur"],
"Darbhanga": ["Darbhanga Town", "Benipur", "Jale", "Kusheshwar Asthan"],
"East Champaran": ["Motihari", "Dhaka", "Raxaul", "Chakia"],
"Gopalganj": ["Gopalganj Town", "Barauli", "Kateya", "Sidhwalia"],
"Jamui": ["Jamui Town", "Jhajha", "Sono", "Barhat"],
"Jehanabad": ["Jehanabad Town", "Makhdumpur", "Kako", "Ghoshi"],
"Kaimur": ["Bhabua", "Mohania", "Adhaura", "Bhagwanpur"],
"Katihar": ["Katihar Town", "Manihari", "Barari", "Kadwa"],
"Khagaria": ["Khagaria Town", "Parbatta", "Beldaur", "Mansi"],
"Kishanganj": ["Kishanganj Town", "Bahadurganj", "Dighalbank", "Thakurganj"],
"Lakhisarai": ["Lakhisarai Town", "Halsi", "Surajgarha", "Ramgarh Chowk"],
"Madhepura": ["Madhepura Town", "Udakishanganj", "Murliganj", "Singheshwar"],
"Madhubani": ["Madhubani Town", "Jhanjharpur", "Benipatti", "Jainagar"],
"Munger": ["Munger Town", "Jamalpur", "Kharagpur", "Tarapur"],
"Nalanda": ["Bihar Sharif", "Rajgir", "Hilsa", "Islampur"],
"Nawada": ["Nawada Town", "Warsaliganj", "Rajauli", "Hisua"],
"Pashchim Champaran": ["Bettiah", "Bagaha", "Ramnagar", "Sikta"],
"Purba Champaran": ["Motihari", "Dhaka", "Raxaul", "Adapur"],
"Purnia": ["Purnia Town", "Dhamdaha", "Baisi", "Krityanand Nagar"],
"Rohtas": ["Sasaram", "Dehri", "Bikramganj", "Nokha"],
"Saharsa": ["Saharsa Town", "Sonbarsa", "Simri Bakhtiarpur", "Mahishi"],
"Samastipur": ["Samastipur Town", "Dalsinghsarai", "Rosera", "Patori"],
"Saran": ["Chapra", "Marhaura", "Sonepur", "Amnour"],
"Sheikhpura": ["Sheikhpura Town", "Ariari", "Barbigha", "Chewara"],
"Sheohar": ["Sheohar Town", "Dumri Katsari", "Piprahi", "Tariani Chowk"],
"Sitamarhi": ["Sitamarhi Town", "Dumra", "Pupri", "Parsauni"],
"Siwan": ["Siwan Town", "Maharajganj", "Mairwa", "Hussainganj"],
"Supaul": ["Supaul Town", "Triveniganj", "Nirmali", "Chhatapur"],
"Vaishali": ["Hajipur", "Mahua", "Lalganj", "Raghopur"],
"West Champaran": ["Bettiah", "Bagaha", "Narkatiaganj", "Chanpatia"],

// ========== UTTAR PRADESH (Additional Districts) ==========
"Aligarh": ["Civil Lines", "University Area", "Ramghat Road", "Dodhpur"],
"Ambedkar Nagar": ["Akbarpur", "Tanda", "Jalalpur", "Bhiyaon"],
"Amethi": ["Gauriganj", "Jagdishpur", "Musafirkhana", "Sangrampur"],
"Amroha": ["Amroha City", "Gajraula", "Hasanpur", "Dhanaura"],
"Auraiya": ["Auraiya Town", "Bidhuna", "Achchalda", "Dibiyapur"],
"Ayodhya": ["Ram Janmabhoomi", "Naya Ghat", "Civil Lines", "Goshainganj"],
"Azamgarh": ["Azamgarh Town", "Mubarakpur", "Lalganj", "Nizamabad"],
"Baghpat": ["Baghpat Town", "Baraut", "Pilana", "Khekada"],
"Bahraich": ["Bahraich Town", "Nanpara", "Kaiserganj", "Mahasi"],
"Ballia": ["Ballia Town", "Rasra", "Bansdih", "Bairiya"],
"Banda": ["Banda Town", "Atarra", "Naraini", "Baberu"],
"Barabanki": ["Barabanki Town", "Nawabganj", "Fatehpur", "Haidergarh"],
"Basti": ["Basti Town", "Harraiya", "Rudhauli", "Kaptanganj"],
"Bijnor": ["Bijnor Town", "Najibabad", "Chandpur", "Nagina"],
"Bulandshahr": ["Bulandshahr Town", "Khurja", "Sikandrabad", "Jahangirabad"],
"Chandauli": ["Chandauli Town", "Mughalsarai", "Sakaldiha", "Chakia"],
"Chitrakoot": ["Karvi", "Manikpur", "Mau", "Rajapur"],
"Deoria": ["Deoria Town", "Salempur", "Barhaj", "Pathardeva"],
"Etah": ["Etah Town", "Kasganj", "Jalesar", "Aliganj"],
"Etawah": ["Etawah Town", "Bharthana", "Saifai", "Basrehar"],
"Farrukhabad": ["Farrukhabad Town", "Fatehgarh", "Kamalganj", "Mohammadabad"],
"Fatehpur": ["Fatehpur Town", "Bindki", "Khaga", "Jahanabad"],
"Firozabad": ["Firozabad Town", "Shikohabad", "Tundla", "Jasrana"],
"Gautam Buddha Nagar": ["Noida", "Greater Noida", "Dadri", "Jewar"],
"Ghaziabad": ["Ghaziabad City", "Indirapuram", "Vasundhara", "Modinagar"],
"Ghazipur": ["Ghazipur Town", "Zamania", "Saidpur", "Mohammadabad"],
"Hardoi": ["Hardoi Town", "Shahabad", "Sandila", "Sawayajpur"],
"Hathras": ["Hathras Town", "Sadabad", "Sikandra Rao", "Sasni"],
"Jalaun": ["Orai", "Jalaun Town", "Kalpi", "Konch"],
"Jaunpur": ["Jaunpur Town", "Mariahu", "Shahganj", "Badlapur"],
"Jhansi": ["Jhansi City", "Mauranipur", "Garautha", "Moth"],
"Kannauj": ["Kannauj Town", "Tirwa", "Chhibramau", "Talgram"],
"Kanpur Dehat": ["Akbarpur", "Bhognipur", "Rasulabad", "Derapur"],
"Kasganj": ["Kasganj Town", "Sahawar", "Sidhpura", "Soron"],
"Kaushambi": ["Manjhanpur", "Bharwari", "Sirathu", "Chail"],
"Kushinagar": ["Padrauna", "Kasya", "Tamkuhi Raj", "Khadda"],
"Lalitpur": ["Lalitpur Town", "Mahroni", "Talbehat", "Bar"],
"Maharajganj": ["Maharajganj Town", "Nautanwa", "Pharenda", "Nichlaul"],
"Mahoba": ["Mahoba Town", "Kulpahar", "Charkhari", "Panwari"],
"Mainpuri": ["Mainpuri Town", "Bhongaon", "Ghiror", "Karhal"],
"Mathura": ["Mathura City", "Vrindavan", "Govardhan", "Chhata"],
"Mau": ["Mau Town", "Madhuban", "Mohammadabad", "Ghosi"],
"Mirzapur": ["Mirzapur Town", "Chunar", "Vindhyachal", "Marihan"],
"Moradabad": ["Moradabad City", "Sambhal", "Thakurdwara", "Bilari"],
"Muzaffarnagar": ["Muzaffarnagar Town", "Shamli", "Kairana", "Charthawal"],
"Pilibhit": ["Pilibhit Town", "Puranpur", "Bisalpur", "Barkhera"],
"Pratapgarh": ["Pratapgarh Town", "Kunda", "Lalganj", "Patti"],
"Rae Bareli": ["Rae Bareli Town", "Lalganj", "Salon", "Dalmau"],
"Rampur": ["Rampur Town", "Milak", "Swar", "Shahabad"],
"Saharanpur": ["Saharanpur Town", "Deoband", "Nakur", "Gangoh"],
"Sambhal": ["Sambhal Town", "Chandausi", "Bahjoi", "Gunnaur"],
"Sant Kabir Nagar": ["Khalilabad", "Mehdawal", "Dhanghata", "Haldi"],
"Shahjahanpur": ["Shahjahanpur Town", "Tilhar", "Jalalabad", "Powayan"],
"Shamli": ["Shamli Town", "Kairana", "Thanabhawan", "Un"],
"Shravasti": ["Bhinga", "Gilaula", "Ikauna", "Jamunaha"],
"Siddharthnagar": ["Naugarh", "Bansi", "Domariyaganj", "Itwa"],
"Sitapur": ["Sitapur Town", "Biswan", "Mahmudabad", "Laharpur"],
"Sonbhadra": ["Robertsganj", "Obra", "Duddhi", "Chopan"],
"Sultanpur": ["Sultanpur Town", "Kadipur", "Lambhua", "Dostpur"],
"Unnao": ["Unnao Town", "Purwa", "Hasanganj", "Safipur"],

// ========== MADHYA PRADESH (Additional Districts) ==========
"Agar Malwa": ["Agar", "Susner", "Nalkheda", "Barod"],
"Alirajpur": ["Alirajpur Town", "Jobat", "Bhabra", "Katthiwara"],
"Anuppur": ["Anuppur Town", "Jaithari", "Kotma", "Pushprajgarh"],
"Ashoknagar": ["Ashoknagar Town", "Chanderi", "Mungaoli", "Isagarh"],
"Balaghat": ["Balaghat Town", "Waraseoni", "Katangi", "Khairlanji"],
"Barwani": ["Barwani Town", "Sendhwa", "Rajpur", "Pansemal"],
"Betul": ["Betul Town", "Multai", "Bhainsdehi", "Amla"],
"Bhind": ["Bhind Town", "Gohad", "Lahar", "Mehgaon"],
"Burhanpur": ["Burhanpur Town", "Nepanagar", "Shahpur", "Khaknar"],
"Chhatarpur": ["Chhatarpur Town", "Nowgong", "Bijawar", "Rajnagar"],
"Chhindwara": ["Chhindwara Town", "Parasia", "Sausar", "Pandhurna"],
"Damoh": ["Damoh Town", "Hata", "Patharia", "Tendukheda"],
"Datia": ["Datia Town", "Seondha", "Bhander", "Indergarh"],
"Dewas": ["Dewas Town", "Khategaon", "Bagli", "Tonk Khurd"],
"Dhar": ["Dhar Town", "Manawar", "Sardarpur", "Kukshi"],
"Dindori": ["Dindori Town", "Shahpura", "Amarpur", "Karanjia"],
"Guna": ["Guna Town", "Ashok Nagar", "Raghogarh", "Chachoda"],
"Harda": ["Harda Town", "Timarni", "Khirkiya", "Rehatgaon"],
"Hoshangabad": ["Hoshangabad Town", "Itarsi", "Sohagpur", "Pipariya"],
"Katni": ["Katni Town", "Vijayraghogarh", "Murwara", "Barhi"],
"Khandwa": ["Khandwa Town", "Pandhana", "Harsud", "Khalwa"],
"Khargone": ["Khargone Town", "Maheshwar", "Bhikangaon", "Kasrawad"],
"Mandla": ["Mandla Town", "Nainpur", "Bichhiya", "Niwas"],
"Mandsaur": ["Mandsaur Town", "Sitamau", "Malhargarh", "Garoth"],
"Morena": ["Morena Town", "Sabalgarh", "Ambah", "Joura"],
"Narsinghpur": ["Narsinghpur Town", "Gadarwara", "Kareli", "Gotegaon"],
"Neemuch": ["Neemuch Town", "Manasa", "Jawad", "Rampura"],
"Panna": ["Panna Town", "Ajaigarh", "Pawai", "Amanganj"],
"Rajgarh": ["Rajgarh Town", "Biaora", "Narsingarh", "Khilchipur"],
"Ratlam": ["Ratlam Town", "Alot", "Jaora", "Sailana"],
"Rewa": ["Rewa Town", "Sirmour", "Mauganj", "Teonthar"],
"Sagar": ["Sagar Town", "Khurai", "Rehli", "Bina"],
"Satna": ["Satna Town", "Maihar", "Nagod", "Rampur Baghelan"],
"Sehore": ["Sehore Town", "Nasrullaganj", "Budni", "Ashta"],
"Seoni": ["Seoni Town", "Lakhnadon", "Barghat", "Keolari"],
"Shahdol": ["Shahdol Town", "Beohari", "Jaisinghnagar", "Burhar"],
"Shajapur": ["Shajapur Town", "Shujalpur", "Kalapipal", "Moman Badodiya"],
"Sheopur": ["Sheopur Town", "Vijaypur", "Karahal", "Badoda"],
"Shivpuri": ["Shivpuri Town", "Kolaras", "Karera", "Pichhore"],
"Singrauli": ["Waidhan", "Chitrangi", "Deosar", "Singrauli Town"],
"Tikamgarh": ["Tikamgarh Town", "Jatara", "Niwari", "Palera"],

// ========== RAJASTHAN (Additional Districts) ==========
"Alwar": ["Alwar City", "Behror", "Tijara", "Rajgarh"],
"Banswara": ["Banswara Town", "Kushalgarh", "Ghatol", "Bagidora"],
"Baran": ["Baran Town", "Atru", "Chhabra", "Kishanganj"],
"Barmer": ["Barmer Town", "Balotra", "Pachpadra", "Siwana"],
"Bharatpur": ["Bharatpur City", "Bayana", "Kaman", "Deeg"],
"Bhilwara": ["Bhilwara Town", "Shahpura", "Mandal", "Asind"],
"Bundi": ["Bundi Town", "Keshoraipatan", "Nainwa", "Hindoli"],
"Chittorgarh": ["Chittorgarh Town", "Nimbahera", "Begun", "Kapasan"],
"Churu": ["Churu Town", "Ratangarh", "Sardarshahar", "Taranagar"],
"Dausa": ["Dausa Town", "Lalsot", "Bandikui", "Baswa"],
"Dholpur": ["Dholpur Town", "Bari", "Baseri", "Rajakhera"],
"Dungarpur": ["Dungarpur Town", "Sagwara", "Aspur", "Simalwara"],
"Hanumangarh": ["Hanumangarh Town", "Nohar", "Pilibanga", "Sangaria"],
"Jaisalmer": ["Jaisalmer City", "Pokaran", "Sam Sand Dunes", "Ramgarh"],
"Jalore": ["Jalore Town", "Bhinmal", "Sanchore", "Ahore"],
"Jhalawar": ["Jhalawar Town", "Khanpur", "Jhalrapatan", "Aklera"],
"Jhunjhunu": ["Jhunjhunu Town", "Nawalgarh", "Chirawa", "Pilani"],
"Karauli": ["Karauli Town", "Hindaun", "Todabhim", "Sapotra"],
"Kota": ["Kota City", "Ramganj Mandi", "Sangod", "Ladpura"],
"Nagaur": ["Nagaur Town", "Merta City", "Didwana", "Makrana"],
"Pali": ["Pali Town", "Sojat", "Jaitaran", "Sumerpur"],
"Pratapgarh": ["Pratapgarh Town", "Arnod", "Chhoti Sadri", "Dhariawad"],
"Rajsamand": ["Kankroli", "Nathdwara", "Rajsamand Town", "Amet"],
"Sawai Madhopur": ["Sawai Madhopur Town", "Gangapur City", "Bonli", "Malarna Dungar"],
"Sikar": ["Sikar Town", "Fatehpur", "Ramgarh", "Sri Madhopur"],
"Sirohi": ["Sirohi Town", "Mount Abu", "Pindwara", "Sheoganj"],
"Sri Ganganagar": ["Sri Ganganagar Town", "Suratgarh", "Anupgarh", "Raisinghnagar"],
"Tonk": ["Tonk Town", "Newai", "Uniara", "Deoli"],

// ========== MAHARASHTRA (Additional Districts) ==========
"Ahmednagar": ["Ahmednagar City", "Sangamner", "Shrirampur", "Nevasa"],
"Akola": ["Akola City", "Balapur", "Akot", "Barshitakli"],
"Amravati": ["Amravati City", "Chandur Railway", "Morshi", "Dhamangaon"],
"Beed": ["Beed Town", "Ambejogai", "Georai", "Majalgaon"],
"Bhandara": ["Bhandara Town", "Tumsar", "Pauni", "Mohadi"],
"Buldhana": ["Buldhana Town", "Malkapur", "Chikhli", "Khamgaon"],
"Chandrapur": ["Chandrapur Town", "Ballarpur", "Warora", "Rajura"],
"Dhule": ["Dhule City", "Sakri", "Sindkheda", "Shirpur"],
"Gadchiroli": ["Gadchiroli Town", "Aheri", "Dhanora", "Kurkheda"],
"Gondia": ["Gondia Town", "Tirora", "Goregaon", "Sadak Arjuni"],
"Hingoli": ["Hingoli Town", "Kalamnuri", "Aundha Nagnath", "Basmath"],
"Jalgaon": ["Jalgaon City", "Bhusawal", "Jamner", "Amalner"],
"Jalna": ["Jalna Town", "Bhokardan", "Partur", "Ambad"],
"Latur": ["Latur City", "Ausa", "Nilanga", "Ahmadpur"],
"Nanded": ["Nanded City", "Kinwat", "Mukhed", "Deglur"],
"Nandurbar": ["Nandurbar Town", "Shahada", "Taloda", "Akkalkuwa"],
"Osmanabad": ["Osmanabad Town", "Tuljapur", "Kalamb", "Bhum"],
"Palghar": ["Palghar Town", "Vasai", "Virar", "Dahanu"],
"Parbhani": ["Parbhani Town", "Gangakhed", "Jintur", "Pathri"],
"Raigad": ["Alibag", "Panvel", "Pen", "Karjat"],
"Ratnagiri": ["Ratnagiri City", "Chiplun", "Dapoli", "Mandangad"],
"Sangli": ["Sangli City", "Miraj", "Tasgaon", "Islampur"],
"Satara": ["Satara City", "Karad", "Wai", "Phaltan"],
"Sindhudurg": ["Oras", "Malvan", "Kudal", "Sawantwadi"],
"Thane": ["Thane City", "Kalyan", "Dombivli", "Bhiwandi"],
"Wardha": ["Wardha Town", "Hinganghat", "Arvi", "Deoli"],
"Washim": ["Washim Town", "Karanja", "Malegaon", "Risod"],
"Yavatmal": ["Yavatmal Town", "Pusad", "Darwha", "Wani"]


};

  function loadDistricts() {
    const state = document.getElementById('stateInput').value;
    const districtSelect = document.getElementById('districtInput');
    const areaSelect = document.getElementById('areaInput');
    
    districtSelect.innerHTML = '<option value="">Select District</option>';
    areaSelect.innerHTML = '<option value="">Select Area</option>';
    areaSelect.disabled = true;
    
    if (state && districtData[state]) {
      districtSelect.disabled = false;
      districtData[state].forEach(district => {
        const option = document.createElement('option');
        option.value = district;
        option.textContent = district;
        districtSelect.appendChild(option);
      });
    } else {
      districtSelect.disabled = true;
    }
  }

  function loadAreas() {
    const district = document.getElementById('districtInput').value;
    const areaSelect = document.getElementById('areaInput');
    
    areaSelect.innerHTML = '<option value="">Select Area</option>';
    
    if (district && areaData[district]) {
      areaSelect.disabled = false;
      areaData[district].forEach(area => {
        const option = document.createElement('option');
        option.value = area;
        option.textContent = area;
        areaSelect.appendChild(option);
      });
    } else {
      areaSelect.disabled = true;
    }
  }

  async function saveUserLocation() {
    const state = document.getElementById('stateInput').value;
    const district = document.getElementById('districtInput').value;
    const area = document.getElementById('areaInput').value;
    
    if (!state || !district || !area) {
      alert("‚ö†Ô∏è Please fill all location fields!");
      return;
    }
    
    const locationData = {
      state: state,
      district: district,
      area: area,
      timestamp: new Date().toISOString()
    };
    
    try {
      const response = await fetch(`${BACKEND_URL}/api/save-user-location`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(locationData)
      });
      
      const result = await response.json();
      
      if (result.success) {
        localStorage.setItem('userLocation', JSON.stringify(locationData));
        localStorage.setItem('nearestHospital', JSON.stringify(result.hospital));
        
        displaySavedLocation(locationData, result.hospital);
        
        alert("‚úÖ Location saved successfully!\n\nEmergency button is now ready to use.");
      } else {
        alert("‚ùå Failed to save location: " + result.message);
      }
      
    } catch (error) {
      console.error('Error:', error);
      alert("‚ùå Server error. Please check if backend is running.");
    }
  }

  function displaySavedLocation(location, hospitalData) {
    console.log("Displaying saved location:", location);
    console.log("Hospital data received:", hospitalData);
    
    const title = document.getElementById('hospitalSectionTitle');
    if (title) title.style.display = 'none';
    document.getElementById('locationForm').style.display = 'none';
    
    const savedDisplay = document.getElementById('savedLocationDisplay');
    savedDisplay.style.display = 'block';
    
    let hospitals = Array.isArray(hospitalData) ? hospitalData : [hospitalData];
    
    let html = `
      <div style="background: white; padding: 15px; border-radius: 10px; border: 2px solid #e5e7eb; margin-bottom: 15px;">
        <p style="font-weight: bold; margin-bottom: 15px; color: #2563eb; font-size: 1rem;">
          üìã Your Nearest Hospitals (${hospitals.length})
        </p>
    `;
    
    hospitals.forEach((hospital, index) => {
      const isPrimary = index === 0;
      const bgColor = isPrimary ? '#d1fae5' : '#f9fafb';
      const borderColor = isPrimary ? '#10b981' : '#e5e7eb';
      
      let mapsLink = '#';
      if (hospital.coordinates) {
        mapsLink = `https://www.google.com/maps/search/?api=1&query=${hospital.coordinates.lat},${hospital.coordinates.lng}`;
      }
      
      html += `
        <div style="
          background: ${bgColor}; 
          padding: 12px; 
          border-radius: 8px; 
          border: 2px solid ${borderColor};
          margin-bottom: 10px;
        ">
          <div style="display: flex; justify-content: space-between; align-items: start;">
            <div style="flex: 1;">
              <p style="font-weight: bold; color: #333; font-size: 0.95rem; margin-bottom: 5px;">
                ${index + 1}. ${hospital.hospital}
              </p>
              <p style="font-size: 0.85rem; color: #666; margin: 3px 0;">
                üìû ${hospital.phone}
              </p>
              <p style="font-size: 0.85rem; color: #10b981; margin: 3px 0;">
                üìç ${hospital.distance}
              </p>
              ${hospital.coordinates ? `
                <a href="${mapsLink}" target="_blank" style="
                  display: inline-block;
                  margin-top: 8px;
                  padding: 6px 12px;
                  background: #2563eb;
                  color: white;
                  text-decoration: none;
                  border-radius: 5px;
                  font-size: 0.8rem;
                  font-weight: bold;
                  transition: 0.2s;
                " onmouseover="this.style.background='#1d4ed8'" onmouseout="this.style.background='#2563eb'">
                  üó∫Ô∏è View on Map
                </a>
              ` : ''}
            </div>
            ${isPrimary ? `
              <div style="
                background: #10b981; 
                color: white; 
                padding: 4px 10px; 
                border-radius: 5px; 
                font-size: 0.75rem;
                font-weight: bold;
                white-space: nowrap;
              ">
                PRIMARY
              </div>
            ` : ''}
          </div>
          ${isPrimary ? `
            <p style="
              font-size: 0.8rem; 
              color: #065f46; 
              margin-top: 8px; 
              font-style: italic;
            ">
              ‚ö° Emergency alerts will be sent here
            </p>
          ` : ''}
        </div>
      `;
    });
    
    html += `
      </div>
      
      <button onclick="editLocation()" style="
        width: 100%;
        background: #2563eb; 
        color: white; 
        border: none;
        padding: 12px 15px; 
        border-radius: 8px; 
        cursor: pointer;
        font-size: 0.95rem;
        font-weight: bold;
        transition: 0.2s;
      " onmouseover="this.style.background='#1d4ed8'" onmouseout="this.style.background='#2563eb'">
        ‚úèÔ∏è Edit Location
      </button>
    `;
    
    savedDisplay.innerHTML = html;
  }

  function editLocation() {
    const title = document.getElementById('hospitalSectionTitle');
    if (title) title.style.display = 'block';
    
    document.getElementById('locationForm').style.display = 'block';
    document.getElementById('savedLocationDisplay').style.display = 'none';
    
    localStorage.removeItem('userLocation');
    localStorage.removeItem('nearestHospital');
  }

  // ========== IN-WEBSITE NOTIFICATION SYSTEM ==========

let currentNotification = null;

function showWebsiteNotification(options) {
  // Remove existing notification if any
  if (currentNotification) {
    currentNotification.remove();
  }
  
  const {
    type = 'info', // 'success', 'error', 'warning', 'info'
    title = 'Notification',
    message = '',
    icon = 'üîî',
    duration = 5000, // Auto-close after 5 seconds
    actions = [] // Array of {text, callback, primary}
  } = options;
  
  // Create notification element
  const notification = document.createElement('div');
  notification.className = `website-notification ${type}`;
  
  let actionsHTML = '';
  if (actions.length > 0) {
    actionsHTML = '<div class="notification-actions">';
    actions.forEach(action => {
      const btnClass = action.primary ? 'primary' : 'secondary';
      actionsHTML += `
        <button class="notification-btn ${btnClass}" onclick="${action.callback}">
          ${action.text}
        </button>
      `;
    });
    actionsHTML += '</div>';
  } else {
    // Default close button
    actionsHTML = `
      <div class="notification-actions">
        <button class="notification-btn secondary" onclick="closeWebsiteNotification()">
          Close
        </button>
      </div>
    `;
  }
  
  notification.innerHTML = `
    <div class="notification-header">
      <div class="notification-icon">${icon}</div>
      <div class="notification-title">${title}</div>
    </div>
    <div class="notification-message">${message}</div>
    ${actionsHTML}
  `;
  
  document.body.appendChild(notification);
  currentNotification = notification;
  
  // Animate in
  setTimeout(() => {
    notification.classList.add('show');
  }, 10);
  
  // Auto-close after duration
  if (duration > 0) {
    setTimeout(() => {
      closeWebsiteNotification();
    }, duration);
  }
}

function closeWebsiteNotification() {
  if (currentNotification) {
    currentNotification.classList.remove('show');
    setTimeout(() => {
      currentNotification.remove();
      currentNotification = null;
    }, 400);
  }
}

// Replace emergency notification system
async function sendEmergencyAlert() {
  const location = JSON.parse(localStorage.getItem('userLocation'));
  const hospital = JSON.parse(localStorage.getItem('nearestHospital'));
  
  // Show sending notification
  showWebsiteNotification({
    type: 'warning',
    title: 'üö® Sending Emergency Alert',
    icon: '‚è≥',
    message: 'Please wait while we contact the nearest hospital...',
    duration: 0 // Don't auto-close
  });
  
  try {
    const response = await fetch(`${BACKEND_URL}/api/send-emergency-alert`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        userId: getUserId(),
        location: location,
        hospital: hospital,
        timestamp: new Date().toISOString()
      })
    });
    
    const result = await response.json();
    
    if (result.success) {
      // Success notification
      showWebsiteNotification({
        type: 'success',
        title: '‚úÖ Emergency Alert Sent',
        icon: 'üè•',
        message: `Emergency services have been notified at <strong>${hospital[0].hospital}</strong>. Help is on the way!<br><br>Emergency Contact: <strong>${hospital[0].phone}</strong>`,
        duration: 10000
      });
    } else {
      throw new Error(result.message || 'Failed to send alert');
    }
    
  } catch (error) {
    console.error('Emergency alert error:', error);
    
    // Error notification with call option
    const emergencyPhone = hospital && hospital[0] ? hospital[0].phone : '108';
    
    showWebsiteNotification({
      type: 'error',
      title: '‚ùå Emergency Alert Failed',
      icon: '‚ö†Ô∏è',
      message: `Unable to send emergency alert due to: <strong>${error.message}</strong><br><br>Please call emergency services immediately:<br><strong>${emergencyPhone}</strong>`,
      duration: 0, // Keep open until user closes
      actions: [
        {
          text: `üìû Call ${emergencyPhone}`,
          callback: `window.location.href='tel:${emergencyPhone}'`,
          primary: true
        },
        {
          text: 'Close',
          callback: 'closeWebsiteNotification()',
          primary: false
        }
      ]
    });
  }
}


  // ========== EMERGENCY BUTTON ==========

  function triggerEmergency() {
    const savedLocation = localStorage.getItem('userLocation');
    
    if (!savedLocation) {
      alert(
        "‚ö†Ô∏è Location Not Set!\n\n" +
        "Please set your nearest hospital location first.\n\n" +
        "Scroll down to 'Setup Nearest Hospital' section."
      );
      return;
    }
    
    const confirmed = confirm(
      "üö® EMERGENCY ALERT\n\n" +
      "This will notify your nearest neuro-hospital about your emergency.\n\n" +
      "Click OK to proceed."
    );
    
    if (!confirmed) return;
    
    sendEmergencyAlert();
  }

  async function sendEmergencyAlert() {
    const location = JSON.parse(localStorage.getItem('userLocation'));
    
    const loadingDiv = document.createElement('div');
    loadingDiv.id = 'emergencyLoading';
    loadingDiv.style.cssText = `
      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
      background: white; padding: 30px; border-radius: 15px;
      box-shadow: 0 10px 50px rgba(0,0,0,0.3); z-index: 10000; text-align: center;
    `;
    loadingDiv.innerHTML = `
      <h2 style="color: #dc2626;">üö® Sending Emergency Alert...</h2>
      <p>Please wait...</p>
    `;
    document.body.appendChild(loadingDiv);
    
    try {
      const response = await fetch(`${BACKEND_URL}/api/emergency-alert`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          location: location,
          timestamp: new Date().toISOString()
        })
      });
      
      const result = await response.json();
      
      document.body.removeChild(loadingDiv);
      
      if (result.success) {
        showEmergencySuccess(result);
      } else {
        alert("‚ùå Failed to send alert.\n\nPlease call emergency services: 108");
      }
      
    } catch (error) {
      document.body.removeChild(loadingDiv);
      console.error("Emergency alert error:", error);
      alert("‚ùå Server error.\n\nPlease call emergency services: 108");
    }
  }

  function showEmergencySuccess(result) {
    const popup = document.createElement('div');
    popup.style.cssText = `
      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
      background: white; padding: 40px; border-radius: 15px;
      box-shadow: 0 10px 50px rgba(0,0,0,0.3); z-index: 10000;
      max-width: 500px; text-align: center;
    `;
    
    popup.innerHTML = `
      <h2 style="color: #10b981;">‚úÖ Emergency Alert Sent!</h2>
      <p style="font-size: 1.1rem; margin: 20px 0;">
        ${result.hospital_name} has been notified.
      </p>
      <div style="background: #f0f4f8; padding: 15px; border-radius: 10px; margin: 20px 0;">
        <p><strong>Reference ID:</strong> ${result.reference_id}</p>
        <p><strong>Hospital Phone:</strong> ${result.hospital_phone}</p>
        <p><strong>Hospital Email:</strong> ${result.hospital_email}</p>
        <p style="font-size: 0.9rem; color: #10b981; margin-top: 10px;">
          ‚úÖ Email Alert: ${result.email_status === 'success' ? 'Sent' : 'Failed'}<br>
          üì± SMS Alert: ${result.sms_status === 'success' ? 'Sent' : result.sms_status === 'skipped' ? 'Skipped (Not Configured)' : 'Failed'}
        </p>
      </div>
      <p style="color: #666; font-size: 0.9rem;">
        Help is on the way. Stay calm and wait for assistance.
      </p>
      <button onclick="this.parentElement.remove()" style="
        background: #2563eb; color: white; border: none;
        padding: 12px 30px; border-radius: 8px; font-size: 1rem;
        cursor: pointer; margin-top: 20px;
      ">OK</button>
    `;
    
    document.body.appendChild(popup);
  }

  // ========== CHAT HISTORY FEATURE ==========

  let chatHistory = [];

  function loadChatHistory() {
    const saved = localStorage.getItem('chatHistory');
    if (saved) {
      chatHistory = JSON.parse(saved);
    }
  }

  function saveChatHistory() {
    localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
  }

  function addToHistory(firstQuestion) {
    const greetingWords = ['hi', 'hello', 'hey', 'good morning', 'good evening', 'good afternoon'];
    const isGreeting = greetingWords.some(word => firstQuestion.toLowerCase().includes(word));
    
    if (!firstQuestion || isGreeting) {
      return;
    }
    
    const historyItem = {
      id: Date.now(),
      title: firstQuestion,
      timestamp: new Date().toISOString(),
      date: new Date()
    };
    
    chatHistory.unshift(historyItem);
    
    if (chatHistory.length > 20) {
      chatHistory = chatHistory.slice(0, 20);
    }
    
    saveChatHistory();
  }

  function toggleChatHistory() {
    const panel = document.getElementById('chatHistoryPanel');
    const sidebar = document.getElementById('sidebar');
    
    if (panel.classList.contains('open')) {
      panel.classList.remove('open');
    } else {
      panel.classList.add('open');
      sidebar.classList.remove('open');
      displayChatHistory();
    }
  }

  function displayChatHistory() {
    const historyList = document.getElementById('historyList');
    
    if (chatHistory.length === 0) {
      historyList.innerHTML = '<div class="no-history">No chat history yet.<br>Start a conversation!</div>';
      return;
    }
    
    let html = '';
    chatHistory.forEach(item => {
      const timeAgo = getTimeAgo(new Date(item.timestamp));
      
      html += `
        <div class="history-item" onclick="loadConversation('${item.id}')">
          <div class="history-title">${item.title}</div>
          <div class="history-time">${timeAgo}</div>
        </div>
      `;
    });
    
    historyList.innerHTML = html;
  }

  function getTimeAgo(date) {
    const now = new Date();
    const diffMs = now - date;
    const diffMins = Math.floor(diffMs / 60000);
    const diffHours = Math.floor(diffMs / 3600000);
    const diffDays = Math.floor(diffMs / 86400000);
    
    if (diffMins < 1) return 'Just now';
    if (diffMins < 60) return `${diffMins} minute${diffMins > 1 ? 's' : ''} ago`;
    if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
    if (diffDays === 1) return 'Yesterday';
    if (diffDays < 7) return `${diffDays} days ago`;
    return date.toLocaleDateString();
  }

  function loadConversation(id) {
    alert('Conversation loading feature coming soon!\n\nConversation ID: ' + id);
  }

  function clearChatHistory() {
    const confirmed = confirm('Are you sure you want to clear all chat history?');
    if (confirmed) {
      chatHistory = [];
      saveChatHistory();
      displayChatHistory();
    }
  }

  // ========== CHATBOT FUNCTIONS ==========

  const userInputField = document.getElementById('userInput');
  const topTypingBox = document.getElementById('topTypingBox');
  const topTypingContent = document.getElementById('topTypingContent');
  const suggestionsBox = document.getElementById('suggestionsBox');
  const suggestionsList = document.getElementById('suggestionsList');
  const chatWindow = document.getElementById('chatWindow');

  function toggleMenu() {
    document.getElementById("sidebar").classList.toggle("open");
  }

  userInputField.addEventListener('input', function() {
    const text = userInputField.value.trim();
    
    if (text.length > 0) {
      topTypingBox.classList.add('active');
      topTypingContent.textContent = text;
    } else {
      topTypingBox.classList.remove('active');
      suggestionsBox.classList.remove('active');
      return;
    }
    
    if (text.length >= 1) {
      getSuggestions(text);
    } else {
      suggestionsBox.classList.remove('active');
    }
  });

  async function getSuggestions(text) {
    try {
      const response = await fetch(`${BACKEND_URL}/api/get-suggestions`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text: text })
      });
      
      const data = await response.json();
      showSuggestions(data.suggestions);
    } catch (error) {
      console.error('Error:', error);
      suggestionsList.innerHTML = '<div class="no-suggestions">‚ö†Ô∏è  Connection error....</div>';
      suggestionsBox.classList.add('active');
    }
  }

  function showSuggestions(suggestions) {
    suggestionsList.innerHTML = '';
    
    if (suggestions.length > 0) {
      suggestions.forEach(question => {
        const div = document.createElement('div');
        div.className = 'suggestion-item';
        div.textContent = question;
        
        div.addEventListener('click', function() {
          userInputField.value = question;
          topTypingBox.classList.remove('active');
          suggestionsBox.classList.remove('active');
          userInputField.focus();
        });
        
        suggestionsList.appendChild(div);
      });
      
      suggestionsBox.classList.add('active');
    } else {
      suggestionsList.innerHTML = '<div class="no-suggestions">No matching questions found.</div>';
      suggestionsBox.classList.add('active');
    }
  }

  async function sendMessage() {
    const userText = userInputField.value.trim();
    if (!userText) return;

    topTypingBox.classList.remove('active');
    suggestionsBox.classList.remove('active');

    const userMsg = document.createElement("div");
    userMsg.className = "user-msg";
    userMsg.textContent = userText;
    chatWindow.appendChild(userMsg);
    chatWindow.scrollTop = chatWindow.scrollHeight;

    userInputField.value = '';

    // ‚úÖ TRACK FIRST REAL QUESTION (FIXED VERSION)
    if (!window.currentSessionFirstQuestion) {
      const greetingWords = ['hi', 'hello', 'hey', 'good morning', 'good evening', 'good afternoon', 'hii', 'hlo', 'namaste'];
      const isGreeting = greetingWords.some(word => userText.toLowerCase().trim() === word || userText.toLowerCase().includes(word));
      
      if (!isGreeting && userText.length > 5) {
        window.currentSessionFirstQuestion = userText;
        addToHistory(userText);
      }
    }

    const loadingMsg = document.createElement("div");
    loadingMsg.className = "bot-msg";
    loadingMsg.textContent = "üôÑ Finding answer...";
    loadingMsg.id = "loading-msg";
    chatWindow.appendChild(loadingMsg);
    chatWindow.scrollTop = chatWindow.scrollHeight;

    try {
      const response = await fetch(`${BACKEND_URL}/api/get-answer`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ question: userText })
      });
      
      const data = await response.json();
      
      const loading = document.getElementById("loading-msg");
      if (loading) loading.remove();

      const botMsg = document.createElement("div");
      botMsg.className = "bot-msg";
      chatWindow.appendChild(botMsg);
      
      let i = 0;
      function typeWriter() {
        if (i < data.answer.length) {
          botMsg.textContent += data.answer.charAt(i);
          i++;
          setTimeout(typeWriter, 20);
          chatWindow.scrollTop = chatWindow.scrollHeight;
        }
      }
      typeWriter();
      
    } catch (error) {
      const loading = document.getElementById("loading-msg");
      if (loading) loading.remove();
      
      const botMsg = document.createElement("div");
      botMsg.className = "bot-msg";
      botMsg.textContent = "‚ö†Ô∏è Server down!";
      chatWindow.appendChild(botMsg);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }
  }

  userInputField.addEventListener("keydown", function(e) {
    if (e.key === "Enter") {
      sendMessage();
    }
  });

  // Update toggleSettings function
function toggleSettings() {
  const submenu = document.getElementById('settingsSubmenu');
  const arrow = document.getElementById('settingsArrow');
  

  
  if (submenu.style.display === 'none' || submenu.style.display === '') {
    submenu.style.display = 'block';
    arrow.classList.add('open'); // Rotate arrow up
  } else {
    submenu.style.display = 'none';
    arrow.classList.remove('open'); // Rotate arrow down
    
    // AUTO-CLOSE HISTORY when settings menu closes
    const historyPanel = document.getElementById('chatHistoryPanel');
    if (historyPanel.classList.contains('open')) {
      historyPanel.classList.remove('open');
    }
  }
}

// About Modal Functions
function openAbout() {
  document.getElementById('aboutModal').style.display = 'flex';
}

function closeAbout() {
  document.getElementById('aboutModal').style.display = 'none';
}


// Update toggleChatHistory to close history when clicking again
function toggleChatHistory() {
  const panel = document.getElementById('chatHistoryPanel');
  
  if (panel.classList.contains('open')) {
    panel.classList.remove('open');
  } else {
    panel.classList.add('open');
    loadChatHistory();
  }
}

  // ========== DOCTOR CONNECT ==========
  
  // ========== DOCTOR CONNECT (FIXED) ==========

let doctorListVisible = false;

// Toggle doctor list
function toggleDoctorList() {
  const container = document.getElementById('doctorListContainer');
  const btn = document.getElementById('connectDoctorBtn');
  
  if (!doctorListVisible) {
    container.classList.add('expanded');
    btn.textContent = 'üö´ Close Doctor List';
    loadRealDoctors(); // ‚úÖ Call the REAL function
    doctorListVisible = true;
  } else {
    container.classList.remove('expanded');
    btn.textContent = 'üë®‚Äç‚öïÔ∏è Connect to Doctors';
    doctorListVisible = false;
  }
}

// Display doctors in the list
function displayDoctors(doctors) {
  const doctorList = document.getElementById('doctorList');
  
  if (!doctors || doctors.length === 0) {
    doctorList.innerHTML = '<p style="text-align: center; color: #666;">No doctors available.</p>';
    return;
  }
  
  let html = '';
  doctors.forEach(doctor => {
    let statusClass = '';
    let statusText = '';
    
    if (doctor.status === 'available') {
      statusClass = 'status-available';
      statusText = 'Available';
    } else if (doctor.status === 'engaged') {
      statusClass = 'status-engaged';
      statusText = 'Engaged';
    } else {
      statusClass = 'status-offline';
      statusText = 'Offline';
    }
    
    html += `
      <div class="doctor-card" onclick="selectDoctor('${doctor.id}', '${doctor.name}')">
        <div class="doctor-info">
          <div class="doctor-name">${doctor.name}</div>
          <div class="doctor-specialty">${doctor.specialty}</div>
        </div>
        <div class="status-indicator ${statusClass}" title="${statusText}"></div>
      </div>
    `;
  });
  
  doctorList.innerHTML = html;
}

// Select doctor for consultation
function selectDoctor(doctorId, doctorName) {
  alert(`You selected ${doctorName}!\n\nConsultation feature coming soon...`);
  console.log('Selected doctor ID:', doctorId);
}

// Auto-refresh doctor list every 10 seconds
setInterval(function() {
  if (doctorListVisible) {
    loadRealDoctors(); // ‚úÖ Call the REAL function
  }
}, 10000);


   // ========== PAGE LOAD ==========

  window.addEventListener('DOMContentLoaded', function() {
    loadChatHistory();
    
    const savedLocation = localStorage.getItem('userLocation');
    const savedHospital = localStorage.getItem('nearestHospital');
    
    if (savedLocation && savedHospital) {
      const location = JSON.parse(savedLocation);
      const hospital = JSON.parse(savedHospital);
      displaySavedLocation(location, hospital);
    }
  });  // ‚úÖ FIXED - was ")" before
</script>



<script>
// Toggle rightbar on mobile
function toggleSuggestions() {
  const rightbar = document.querySelector('.rightbar');
  rightbar.classList.toggle('mobile-active');
}

// Close rightbar when clicking outside (optional)
document.addEventListener('click', function(e) {
  if (window.innerWidth <= 768) {
    const rightbar = document.querySelector('.rightbar');
    const toggleBtn = document.querySelector('.suggestions-toggle-btn');
    if (!rightbar.contains(e.target) && e.target !== toggleBtn) {
      rightbar.classList.remove('mobile-active');
    }
  }
});
// ========== SAVE CHAT HISTORY TO FIRESTORE ==========
async function saveChatToHistory(userMessage, botResponse) {
  try {
    const userId = getUserId(); // Get or create unique user ID
    
    await db.collection('chatHistory').add({
      userId: userId,
      userMessage: userMessage,
      botResponse: botResponse,
      timestamp: firebase.firestore.FieldValue.serverTimestamp(),
      date: new Date().toLocaleDateString('en-IN')
    });
    
    console.log('‚úÖ Chat saved to history');
  } catch (error) {
    console.error('‚ùå Error saving chat:', error);
  }
}

// Get or create unique user ID
function getUserId() {
  let userId = localStorage.getItem('neurobuddy_user_id');
  if (!userId) {
    userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    localStorage.setItem('neurobuddy_user_id', userId);
  }
  return userId;
}

// Update your sendMessage function to save history
async function sendMessage() {
  const userText = userInputField.value.trim();
  if (!userText) return;
  
  // ... all your existing code ...
  
  // At the END, after bot response is displayed:
  function typeWriter() {
    if (i < data.answer.length) {
      botMsg.textContent += data.answer.charAt(i);
      i++;
      setTimeout(typeWriter, 20);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    } else {
      // ‚úÖ ADD THIS LINE HERE (after typing animation completes):
      saveChatToHistory(userText, data.answer);
    }
  }
  typeWriter();
}

// Add this line after bot response is displayed:
// saveChatToHistory(userInput, botResponse);


// ========== DOCTOR AUTHENTICATION SYSTEM ==========

let currentDoctor = null; // Store logged-in doctor data

// Check if doctor is already logged in (session storage)
function checkDoctorSession() {
  const doctorSession = sessionStorage.getItem('doctorSession');
  if (doctorSession) {
    currentDoctor = JSON.parse(doctorSession);
    console.log('‚úÖ Doctor session found:', currentDoctor.name);
    return true;
  }
  return false;
}

// Show role selection modal on first visit
function showRoleModalOnFirstVisit() {
  const hasVisited = localStorage.getItem('hasVisited');
  const hasSession = checkDoctorSession();
  
  if (!hasVisited && !hasSession) {
    setTimeout(() => {
      document.getElementById('roleModal').style.display = 'flex';
    }, 1000); // Show after 1 second
    localStorage.setItem('hasVisited', 'true');
  }
}

// Close role selection modal (user chose guest)
function closeRoleModal() {
  document.getElementById('roleModal').style.display = 'none';
}

// Show doctor registration form
function showDoctorRegister() {
  document.getElementById('roleModal').style.display = 'none';
  document.getElementById('doctorLoginModal').style.display = 'none';
  document.getElementById('doctorRegModal').style.display = 'flex';
}

// Close doctor registration
function closeDoctorRegister() {
  document.getElementById('doctorRegModal').style.display = 'none';
  document.getElementById('doctorRegForm').reset();
}

// Show doctor login modal
function showDoctorLogin() {
  document.getElementById('roleModal').style.display = 'none';
  document.getElementById('doctorRegModal').style.display = 'none';
  document.getElementById('doctorLoginModal').style.display = 'flex';
}

// Close doctor login
function closeDoctorLogin() {
  document.getElementById('doctorLoginModal').style.display = 'none';
  document.getElementById('doctorLoginForm').reset();
}

// ========== DOCTOR REGISTRATION (SAVE TO FIRESTORE) ==========
async function registerDoctor(event) {
  event.preventDefault();
  
  const name = document.getElementById('docName').value;
  const email = document.getElementById('docEmail').value;
  const password = document.getElementById('docPassword').value;
  const specialty = document.getElementById('docSpecialty').value;
  const phone = document.getElementById('docPhone').value;
  const license = document.getElementById('docLicense').value;
  
  // Show loading
  document.getElementById('regBtnText').style.display = 'none';
  document.getElementById('regBtnLoader').style.display = 'inline';
  
  try {
    // Save to Firestore
    const docRef = await db.collection('doctors').add({
      name: name,
      email: email,
      password: password, // In production, use encrypted password!
      specialty: specialty,
      phone: phone,
      license: license,
      status: 'available',
      registeredAt: firebase.firestore.FieldValue.serverTimestamp(),
      approved: false // Requires admin approval
    });
    
    console.log('‚úÖ Doctor registered with ID:', docRef.id);
    
    // Show success message
    alert('‚úÖ Registration successful! Your account is pending approval.');
    
    // Close modal and reset form
    closeDoctorRegister();
    document.getElementById('doctorRegForm').reset();
    
  } catch (error) {
    console.error('‚ùå Registration error:', error);
    alert('Registration failed: ' + error.message);
  } finally {
    // Hide loading
    document.getElementById('regBtnText').style.display = 'inline';
    document.getElementById('regBtnLoader').style.display = 'none';
  }
}

// Login doctor
async function loginDoctor(event) {
  event.preventDefault();
  
  const loginBtn = document.getElementById('loginBtnText');
  const loginLoader = document.getElementById('loginBtnLoader');
  
  // Show loading
  loginBtn.style.display = 'none';
  loginLoader.style.display = 'inline';
  
  const loginData = {
    email: document.getElementById('loginEmail').value,
    password: document.getElementById('loginPassword').value
  };
  
  try {
    const response = await fetch(`${BACKEND_URL}/api/doctor/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(loginData)
    });
    
    const result = await response.json();
    
    // Hide loading
    loginBtn.style.display = 'inline';
    loginLoader.style.display = 'none';
    
    if (result.success) {
      // Save session
      currentDoctor = result.doctor;
      sessionStorage.setItem('doctorSession', JSON.stringify(result.doctor));
      
      alert('‚úÖ Login successful!\n\nWelcome, Dr. ' + result.doctor.name);
      closeDoctorLogin();
      
      // Load real doctors list
      loadRealDoctors();
    } else {
      alert('‚ùå Login failed:\n\n' + result.message);
    }
  } catch (error) {
    console.error('Login error:', error);
    loginBtn.style.display = 'inline';
    loginLoader.style.display = 'none';
    alert('‚ùå Server error. Please try again later.');
  }
}

// Open doctor dashboard
function openDoctorDashboard() {
  if (!currentDoctor) {
    showDoctorLogin();
    return;
  }
  
  // Populate dashboard
  document.getElementById('dashboardName').textContent = currentDoctor.name;
  document.getElementById('dashboardSpecialty').textContent = currentDoctor.specialty;
  document.getElementById('dashboardEmail').textContent = currentDoctor.email;
  document.getElementById('doctorStatusSelect').value = currentDoctor.status;
  
  document.getElementById('doctorDashboard').style.display = 'flex';
}

// Close doctor dashboard
function closeDoctorDashboard() {
  document.getElementById('doctorDashboard').style.display = 'none';
}

// Update doctor status
async function updateDoctorStatus() {
  if (!currentDoctor) return;
  
  const newStatus = document.getElementById('doctorStatusSelect').value;
  
  try {
    const response = await fetch(`${BACKEND_URL}/api/doctor/status`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        doctor_id: currentDoctor.id,
        status: newStatus
      })
    });
    
    const result = await response.json();
    
    if (result.success) {
      currentDoctor.status = newStatus;
      sessionStorage.setItem('doctorSession', JSON.stringify(currentDoctor));
      alert('‚úÖ Status updated to: ' + newStatus);
      
      // Reload doctors list
      if (doctorListVisible) {
        loadRealDoctors();
      }
    } else {
      alert('‚ùå Failed to update status');
    }
  } catch (error) {
    console.error('Status update error:', error);
    alert('‚ùå Server error');
  }
}

// Logout doctor
function logoutDoctor() {
  const confirmed = confirm('Are you sure you want to logout?');
  if (!confirmed) return;
  
  currentDoctor = null;
  sessionStorage.removeItem('doctorSession');
  closeDoctorDashboard();
  
  alert('‚úÖ Logged out successfully!');
}

// Load REAL doctors from backend (replaces demo doctors)
async function loadRealDoctors() {
  const doctorList = document.getElementById('doctorList');
  doctorList.innerHTML = '<p class="loading-doctors">Loading doctors...</p>';
  
  try {
    const response = await fetch(`${BACKEND_URL}/api/doctor/list`);
    const result = await response.json();
    
    if (result.success && result.doctors.length > 0) {
      displayDoctors(result.doctors);
    } else {
      doctorList.innerHTML = '<p style="text-align: center; color: #666;">No doctors registered yet.</p>';
    }
  } catch (error) {
    console.error('Error loading doctors:', error);
    doctorList.innerHTML = '<p style="text-align: center; color: #dc2626;">Failed to load doctors.</p>';
  }
}

// ========== LOAD DOCTORS FROM FIRESTORE (REAL-TIME) ==========
function loadDoctorsFromFirestore() {
  const doctorList = document.getElementById('doctorList');
  doctorList.innerHTML = '<p class="loading-doctors">Loading doctors...</p>';
  
  // Real-time listener for approved doctors
  db.collection('doctors')
    .where('approved', '==', true)
    .onSnapshot((snapshot) => {
      doctorList.innerHTML = ''; // Clear list
      
      if (snapshot.empty) {
        doctorList.innerHTML = '<p class="no-doctors" style="text-align: center; color: #999; padding: 20px;">No doctors available right now</p>';
        return;
      }
      
      snapshot.forEach((doc) => {
        const doctor = doc.data();
        const statusClass = doctor.status === 'available' ? 'status-available' : 
                           doctor.status === 'engaged' ? 'status-engaged' : 'status-offline';
        
        const card = document.createElement('div');
        card.className = 'doctor-card';
        card.innerHTML = `
          <div class="doctor-info">
            <div class="doctor-name">üë®‚Äç‚öïÔ∏è ${doctor.name}</div>
            <div class="doctor-specialty">${doctor.specialty}</div>
          </div>
          <div class="${statusClass} status-indicator"></div>
        `;
        
        card.onclick = () => connectToDoctor(doc.id, doctor);
        doctorList.appendChild(card);
      });
      
      console.log(`‚úÖ Loaded ${snapshot.size} doctors from Firestore`);
    }, (error) => {
      console.error('‚ùå Error loading doctors:', error);
      doctorList.innerHTML = '<p style="color: red; padding: 15px;">Error loading doctors</p>';
    });
}

// UPDATED toggleDoctorList function
function toggleDoctorList() {
  const container = document.getElementById('doctorListContainer');
  const isExpanded = container.classList.contains('expanded');
  
  if (!isExpanded) {
    container.classList.add('expanded');
    loadDoctorsFromFirestore(); // Load from database
  } else {
    container.classList.remove('expanded');
  }
}


// Initialize on page load
window.addEventListener('DOMContentLoaded', function() {
  loadChatHistory();
  
  const savedLocation = localStorage.getItem('userLocation');
  const savedHospital = localStorage.getItem('nearestHospital');
  
  if (savedLocation && savedHospital) {
    const location = JSON.parse(savedLocation);
    const hospital = JSON.parse(savedHospital);
    displaySavedLocation(location, hospital);
  }
  
  // ‚úÖ Check doctor session and show role modal
  checkDoctorSession();
  showRoleModalOnFirstVisit();
});

// ========== MEDICAL IMAGE GALLERY FUNCTIONS ==========

// Educational medical images database
const educationalImages = [
  {
    id: 1,
    title: "Brain Tumor - MRI Scan",
    description: "MRI showing a brain tumor with surrounding edema. Common symptoms include headaches and seizures.",
    image: "https://images.unsplash.com/photo-1559757175-0eb30cd8c063?w=400"
  },
  {
    id: 2,
    title: "Stroke - CT Scan",
    description: "CT scan showing ischemic stroke in the left hemisphere. Early detection is crucial for treatment.",
    image: "https://images.unsplash.com/photo-1576091160550-2173dba999ef?w=400"
  },
  {
    id: 3,
    title: "Migraine Visual Aura",
    description: "Visual representation of migraine aura patterns. Often precedes severe headaches.",
    image: "https://images.unsplash.com/photo-1617791160505-6f00504e3519?w=400"
  },
  {
    id: 4,
    title: "Alzheimer's Brain",
    description: "Comparison showing brain atrophy in Alzheimer's disease patients vs healthy brain.",
    image: "https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400"
  },
  {
    id: 5,
    title: "Parkinson's Disease",
    description: "Brain imaging showing reduced dopamine in Parkinson's disease progression.",
    image: "https://images.unsplash.com/photo-1576671081837-49000212a370?w=400"
  },
  {
    id: 6,
    title: "Epilepsy EEG Pattern",
    description: "Electroencephalogram showing seizure activity patterns in epilepsy patients.",
    image: "https://images.unsplash.com/photo-1631248056268-f37b1b61f728?w=400"
  }
];

// Open gallery modal
function openMedicalGallery() {
  document.getElementById('galleryModal').style.display = 'flex';
  loadEducationalImages();
  loadCommunityImages();
}

// Close gallery modal
function closeGallery() {
  document.getElementById('galleryModal').style.display = 'none';
}

// Switch between tabs
function switchGalleryTab(tab) {
  // Update tab buttons
  document.querySelectorAll('.gallery-tab').forEach(btn => {
    btn.classList.remove('active');
  });
  event.target.classList.add('active');
  
  // Show/hide content
  if (tab === 'educational') {
    document.getElementById('educationalGallery').style.display = 'block';
    document.getElementById('communityGallery').style.display = 'none';
  } else {
    document.getElementById('educationalGallery').style.display = 'none';
    document.getElementById('communityGallery').style.display = 'block';
  }
}

// Load educational images
function loadEducationalImages() {
  const grid = document.getElementById('educationalGrid');
  grid.innerHTML = '';
  
  educationalImages.forEach(img => {
    const item = document.createElement('div');
    item.className = 'gallery-item';
    item.onclick = () => openLightbox(img);
    
    item.innerHTML = `
      <img src="${img.image}" alt="${img.title}" class="gallery-image">
      <div class="gallery-info">
        <div class="gallery-title">${img.title}</div>
        <div class="gallery-description">${img.description}</div>
      </div>
    `;
    
    grid.appendChild(item);
  });
}

// Load community uploaded images from Firestore
function loadCommunityImages() {
  const grid = document.getElementById('communityGrid');
  const noImagesMsg = document.getElementById('noCommunityImages');
  
  grid.innerHTML = '<p style="text-align: center; padding: 20px; color: #999;">Loading community images...</p>';
  
  db.collection('medicalImages')
    .orderBy('uploadedAt', 'desc')
    .limit(20)
    .get()
    .then((snapshot) => {
      grid.innerHTML = '';
      
      if (snapshot.empty) {
        noImagesMsg.style.display = 'block';
        return;
      }
      
      noImagesMsg.style.display = 'none';
      
      snapshot.forEach((doc) => {
        const img = doc.data();
        const item = document.createElement('div');
        item.className = 'gallery-item';
        item.onclick = () => openLightbox(img);
        
        item.innerHTML = `
          <img src="${img.imageUrl}" alt="${img.title}" class="gallery-image">
          <div class="gallery-info">
            <div class="gallery-title">${img.title}</div>
            <div class="gallery-description">${img.description}</div>
            <div style="font-size: 0.75rem; color: #999; margin-top: 8px;">
              Uploaded: ${new Date(img.uploadedAt.seconds * 1000).toLocaleDateString()}
            </div>
          </div>
        `;
        
        grid.appendChild(item);
      });
    })
    .catch((error) => {
      console.error('Error loading community images:', error);
      grid.innerHTML = '<p style="text-align: center; padding: 20px; color: #dc2626;">Error loading images</p>';
    });
}

// Preview selected image before upload
function previewImage(event) {
  const file = event.target.files[0];
  const preview = document.getElementById('imagePreview');
  
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      preview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
      preview.style.display = 'block';
    };
    reader.readAsDataURL(file);
  }
}

// Upload image (DISABLED - Shows error message)
async function uploadImage() {
  const fileInput = document.getElementById('imageUpload');
  const title = document.getElementById('imageTitle').value.trim();
  const description = document.getElementById('imageDescription').value.trim();
  
  if (!fileInput.files[0]) {
    alert('‚ö†Ô∏è Please select an image first');
    return;
  }
  
  if (!title || !description) {
    alert('‚ö†Ô∏è Please provide both title and description');
    return;
  }
  
  // Show error message instead of uploading
  alert('‚ùå Upload Feature Temporarily Disabled\n\n' +
        'This feature requires Firebase Storage upgrade to Blaze plan.\n\n' +
        'Current Status: Educational gallery is available.\n' +
        'Community uploads will be enabled soon!\n\n' +
        'Thank you for your understanding. üôè');
  
  // Reset form
  fileInput.value = '';
  document.getElementById('imageTitle').value = '';
  document.getElementById('imageDescription').value = '';
  document.getElementById('imagePreview').style.display = 'none';
}

    
   // Load community uploaded images (DISABLED message)
function loadCommunityImages() {
  const grid = document.getElementById('communityGrid');
  const noImagesMsg = document.getElementById('noCommunityImages');
  
  grid.innerHTML = `
    <div style="text-align: center; padding: 40px; background: #fff3cd; border-radius: 10px; margin: 20px;">
      <h3 style="color: #856404; margin-bottom: 15px;">üì§ Community Uploads Coming Soon!</h3>
      <p style="color: #856404; font-size: 1rem; margin-bottom: 10px;">
        This feature requires Firebase Storage upgrade.
      </p>
      <p style="color: #856404; font-size: 0.9rem;">
        For now, explore our <strong>Educational Image Gallery</strong> tab above! üìö
      </p>
    </div>
  `;
  
  noImagesMsg.style.display = 'none';
}


// Open image in lightbox
function openLightbox(imageData) {
  document.getElementById('lightbox').classList.add('active');
  document.getElementById('lightboxImage').src = imageData.image || imageData.imageUrl;
  document.getElementById('lightboxTitle').textContent = imageData.title;
  document.getElementById('lightboxDescription').textContent = imageData.description;
}

// Close lightbox
function closeLightbox() {
  document.getElementById('lightbox').classList.remove('active');
}


</script>
<!-- Medical Image Gallery Modal -->
<div id="galleryModal" class="modal-overlay" style="display: none;">
  <div class="modal-content gallery-modal">
    <button class="modal-close" onclick="closeGallery()">‚úï</button>
    <h2 style="color: #2563eb; margin-bottom: 10px;">üß† Neurological Symptom Gallery</h2>
    <p style="color: #666; margin-bottom: 25px;">
      Educational medical images to help you understand neurological conditions
    </p>
    
    <!-- Gallery Tabs -->
    <div class="gallery-tabs">
      <button class="gallery-tab active" onclick="switchGalleryTab('educational')">
        üìö Educational Images
      </button>
      <button class="gallery-tab" onclick="switchGalleryTab('community')">
        üë• Community Uploads
      </button>
    </div>
    
    <!-- Educational Images Section -->
    <div id="educationalGallery" class="gallery-content">
      <div class="gallery-grid" id="educationalGrid"></div>
    </div>
    
    <!-- Community Uploads Section -->
    <div id="communityGallery" class="gallery-content" style="display: none;">
      <div class="gallery-grid" id="communityGrid"></div>
      <p class="no-images" id="noCommunityImages" style="display: none;">
        No community images yet. Be the first to contribute!
      </p>
    </div>
    
    <!-- Upload Section -->
    <div class="upload-section">
      <h3>üì§ Contribute Your Medical Images</h3>
      <p style="color: #666; margin-bottom: 20px; font-size: 0.9rem;">
        Help others by sharing anonymized medical images (X-rays, MRI scans, symptom photos)
      </p>
      
      <div class="upload-area">
        <input type="file" id="imageUpload" class="upload-input" accept="image/*" onchange="previewImage(event)">
        <label for="imageUpload" class="upload-button">
          üìÅ Choose Image
        </label>
        
        <div id="imagePreview" style="display: none;"></div>
        
        <input type="text" id="imageTitle" placeholder="Image Title (e.g., Brain MRI - Tumor)" 
               style="width: 100%; max-width: 400px; padding: 10px; border: 2px solid #cbd5e1; border-radius: 8px;">
        
        <textarea id="imageDescription" placeholder="Brief description of the condition or symptom..." 
                  style="width: 100%; max-width: 400px; padding: 10px; border: 2px solid #cbd5e1; border-radius: 8px; min-height: 80px;"></textarea>
        
        <button class="upload-button" onclick="uploadImage()" id="uploadBtn">
          ‚¨ÜÔ∏è Upload Image
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Image Lightbox -->
<div id="lightbox" class="lightbox-overlay" onclick="closeLightbox()">
  <div class="lightbox-content" onclick="event.stopPropagation()">
    <button class="lightbox-close" onclick="closeLightbox()">‚úï</button>
    <img id="lightboxImage" src="" alt="">
    <div class="lightbox-info">
      <h3 id="lightboxTitle" style="color: #2563eb; margin-bottom: 5px;"></h3>
      <p id="lightboxDescription" style="color: #666;"></p>
    </div>
  </div>
</div>

</body>
</html>
