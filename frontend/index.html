<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=1400,maximum-scale=2.0,user-scalable=yes">
  <title>NEUROBUDDYY.ai</title>
  <style>
    /* [KEEP ALL YOUR EXISTING CSS - NO CHANGES] */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #333;
      margin: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      background: #f0f4f8;
    }

    .topbar {
      background: #060000;
      color: #fff;
      text-align: center;
      font-size: 1.7rem;
      font-weight: bold;
      padding: 17px;
      position: relative;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    .hamburger {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1.8rem;
      background: none;
      border: none;
      color: white;
      cursor: pointer;
    }

    .container {
      flex: 1;
      display: flex;
      height:calc(100vh - 60px);
    }

    .leftbar {
      width: 0;
      background: #d4faff;
      border-right: 8px solid #a8ebf9;
      overflow-y: auto;
      transition: width 0.3s ease;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .leftbar.open {
      width: 220px;
      padding: 15px;
    }

    .menu {
      list-style: none;
      padding: 0;
    }

    .menu li {
      padding: 10px;
      margin-bottom: 8px;
      background: #fff;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.2s;
      font-weight: 500;
    }

    .menu li:hover {
      background: #7a9fef;
      color: #fff;
    }

    .settings {
      margin-top: auto;
      padding: 10px;
      background: #fff;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: 0.2s;
    }

    .settings:hover {
      background: #7a9adf;
      color: rgb(255, 255, 255);
    }

    .chat-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: #f9fafb;
      position: relative;
    }

    .chat-window {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
    }

    .chat-window div {
      max-width: 70%;
      padding: 10px 15px;
      border-radius: 15px;
      line-height: 1.4;
      font-size: 0.95rem;
      margin-bottom: 12px;
    }

    .bot-msg {
      background: #2575d6;
      color: #ffffff;
      text-align: left;
    }

    .user-msg {
      background:linear-gradient(rgb(144, 179, 214) 0%,rgb(168, 242, 161) 20%);
      color: rgb(0, 0, 0);
      text-align: right;
      margin-left: auto;
    }

    .top-typing-box {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      color: white;
      padding: 20px;
      margin: 10px 16px;
      border-radius: 15px;
      display: none;
      min-height: 60px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      animation: slideDown 0.4s ease;
    }

    .top-typing-box.active {
      display: block;
    }

    @keyframes slideDown {
      from {
        transform: translateY(-30px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .typing-title {
      font-size: 0.75rem;
      font-weight: bold;
      margin-bottom: 8px;
      opacity: 0.8;
      text-transform: uppercase;
    }

    #topTypingContent {
      font-size: 1.1rem;
      line-height: 1.5;
      font-weight: 500;
    }

    .suggestions-box {
      background: #ffffff;
      border-top: 3px solid #2563eb;
      border-bottom: 3px solid #2563eb;
      padding: 12px 16px;
      display: none;
      max-height: 250px;
      overflow-y: auto;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
    }

    .suggestions-box.active {
      display: block;
    }

    .suggestions-title {
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 10px;
      font-weight: 600;
    }

    .suggestion-item {
      padding: 12px 15px;
      cursor: pointer;
      border-bottom: 1px solid #e5e7eb;
      transition: all 0.2s;
      border-radius: 5px;
      margin-bottom: 5px;
      background: #f9fafb;
      font-size: 0.9rem;
    }

    .suggestion-item:hover {
      background: #2563eb;
      color: white;
      transform: translateX(5px);
    }

    .suggestion-item:last-child {
      border-bottom: none;
    }

    .no-suggestions {
      text-align: center;
      color: #999;
      padding: 15px;
      font-style: italic;
      font-size: 0.9rem;
    }

    .search-bar {
      flex:0 0 60px;
      display: flex;
      align-items: center;
      gap: 8px;
      border-top: 5px solid #ffffff;
      background: white;
      padding: 12px;
    }

    .search-bar input {
      flex: 1;
      border: 2px solid #9fbff0c1;
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 0.95rem;
      outline: none;
    }

    .btn{
      display:flex;
      gap:10px;
      padding: 10px 12px;
      border-radius: 8px;
      color: rgb(236, 223, 215);
      font-weight: bold;
      cursor: pointer;
      border: 2px solid;
      transition: 0.1s;
    }

    .btn:hover { transform: scale(1.05); }
    .mic { background: #95b1ea; }
    .upload { background: #fef8df; }
    .send { background: #6b7280; }

    .rightbar {
      width: 25%;
      background: white;
      border-left: 8px solid #ffffff;
      padding: 16px;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }

    .emergency {
      background: #dc2626;
      color: white;
      padding: 12px;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: bold;
      margin-bottom: 12px;
      cursor: pointer;
      border: none;
    }
    .emergency:hover { background: #b91c1c; }

    .connect-doctor {
      background: #2563eb;
      color: white;
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: bold;
      text-align: center;
      margin-bottom: 10px;
      cursor: pointer;
      border: none;
      transition: 0.2s;
    }
    .connect-doctor:hover { background: #1d4ed8; }

    #doctorListContainer {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s ease-in-out;
      background: #f0f4f8;
      border-radius: 10px;
      margin-bottom: 15px;
    }

    #doctorListContainer.expanded {
      max-height: 600px;
      padding: 15px;
      border: 2px solid #2563eb;
      overflow-y:auto;
      overflow-x:hidden;
    }

    .doctor-card {
      background: white;
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    #doctorList {
      max-height: 350px;
      overflow-y:auto;
      overflow:hidden;
    }

    .doctor-card:hover {
      transform: translateX(5px);
      box-shadow: 0 3px 10px rgba(0,0,0,0.15);
      background: #f0f9ff;
    }

    .doctor-info {
      flex-grow: 1;
    }

    .doctor-name {
      font-weight: bold;
      color: #333;
      margin-bottom: 3px;
      font-size: 0.95rem;
    }

    .doctor-specialty {
      font-size: 0.8rem;
      color: #666;
    }

    .status-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-left: 10px;
    }

    .status-available {
      background: #10b981;
      box-shadow: 0 0 8px #10b981;
      animation: pulse 2s infinite;
    }

    .status-engaged {
      background: #ef4444;
      box-shadow: 0 0 8px #ef4444;
    }

    .status-offline {
      background: #9ca3af;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .loading-doctors {
      text-align: center;
      color: #666;
      padding: 20px;
      font-style: italic;
    }

    .hospital-section {
      margin-top: 15px;
    }

    .location-title {
      font-size: 1rem;
      color: rgb(42, 106, 255);
      margin-bottom: 15px;
      font-weight: bold;
    }

    .location-form {
      background: #f0f4f8;
      padding: 15px;
      border-radius: 10px;
      border: 2px solid #cbd5e1;
    }

    .location-input {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: 2px solid #cbd5e1;
      border-radius: 8px;
      font-size: 0.9rem;
      background: white;
      cursor: pointer;
    }

    .location-input:disabled {
      background: #f3f4f6;
      cursor: not-allowed;
    }

    .location-input:focus {
      outline: none;
      border-color: #2563eb;
    }

    .save-location-btn {
      width: 100%;
      padding: 12px;
      background: #10b981;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.2s;
    }

    .save-location-btn:hover {
      background: #059669;
      transform: scale(1.02);
    }

    /* Chat History Styles */
    #chatHistoryPanel {
      width: 0;
      background: white;
      border-right: 8px solid #e5e7eb;
      overflow-y: auto;
      transition: width 0.3s ease;
      display: flex;
      flex-direction: column;
      padding: 0;
    }

    #chatHistoryPanel.open {
      width: 300px;
      padding: 15px;
    }

    .history-header {
      font-size: 1.1rem;
      font-weight: bold;
      color: #2563eb;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #e5e7eb;
    }

    .history-item {
      background: #f9fafb;
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 8px;
      border: 2px solid #e5e7eb;
      cursor: pointer;
      transition: 0.2s;
    }

    .history-item:hover {
      background: #e0f2fe;
      border-color: #2563eb;
      transform: translateX(5px);
    }

    .history-title {
      font-weight: 600;
      color: #333;
      font-size: 0.9rem;
      margin-bottom: 5px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .history-time {
      font-size: 0.75rem;
      color: #666;
    }

    .no-history {
      text-align: center;
      color: #999;
      padding: 20px;
      font-style: italic;
    }

    .clear-history-btn {
      background: #dc2626;
      color: white;
      padding: 8px 15px;
      border: none;
      border-radius: 5px;
      font-size: 0.85rem;
      cursor: pointer;
      margin-top: 10px;
      width: 100%;
      transition: 0.2s;
    }

    .clear-history-btn:hover {
      background: #b91c1c;
    }

    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-thumb { background: #9ca3af; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #4b5563; }




  </style>
</head>
<body>

  <header class="topbar">
    <button class="hamburger" onclick="toggleMenu()">‚ò∞</button>
    üéÄ NEURO BUDDYY
  </header>

  <div class="container">

    <aside class="leftbar" id="sidebar">
      <ul class="menu">
        <li onclick="toggleChatHistory()">üîé Search</li>
        <li>üìÇ Categories</li>
      </ul>
      <div class="settings">
        <div onclick="toggleSettings()" style="cursor: pointer; margin-bottom: 8px;">‚öôÔ∏è Settings ‚ñº</div>
        <ul id="settingsSubmenu" style="display: none; list-style: none; padding-left: 10px; margin: 0;">
          <li onclick="openAbout()" style="padding: 8px; background: #e0f2fe; cursor: pointer; border-radius: 5px;">
            ‚ÑπÔ∏è About
          </li>
        </ul>
      </div>
    </aside>

    <!-- CHAT HISTORY PANEL -->
    <aside id="chatHistoryPanel">
      <div class="history-header">üìú Chat History</div>
      <div id="historyList"></div>
      <button class="clear-history-btn" onclick="clearChatHistory()">üóëÔ∏è Clear History</button>
    </aside>

    <main class="chat-section">
      <div class="top-typing-box" id="topTypingBox">
        <div class="typing-title">‚úçÔ∏è You're typing...</div>
        <div id="topTypingContent"></div>
      </div>

      <div class="chat-window" id="chatWindow">
        <div class="bot-msg">üëã Hello! Type your health question below and I'll help you find answers.</div>
      </div>

      <div class="suggestions-box" id="suggestionsBox">
        <div class="suggestions-title">üí° Related Questions (click to select):</div>
        <div id="suggestionsList"></div>
      </div>

      <div class="search-bar">
        <input type="text" id="userInput" placeholder="Type your health question here...">
        <button class="btn send" onclick="sendMessage()">‚¨ÜÔ∏è</button>
        <button class="btn"> <span class="mic">üé§ </span> <span class="upload"> üìÅ </span></button>
      </div>
    </main>

    <aside class="rightbar">
      <button class="emergency" onclick="triggerEmergency()">üö® Emergency</button>
      
      <button class="connect-doctor" onclick="toggleDoctorList()" id="connectDoctorBtn">
        üë®‚Äç‚öïÔ∏è Connect to Doctors
      </button>
      
      <div id="doctorListContainer">
        <div id="doctorList">
          <p class="loading-doctors">Loading doctors...</p>
        </div>
      </div>

      <!-- HOSPITAL LOCATION SECTION -->
      <div class="hospital-section">
        <h2 class="location-title" id="hospitalSectionTitle">üè• Setup Nearest Hospital</h2>
        
        <div class="location-form" id="locationForm">
          <p style="font-size: 0.85rem; color: #666; margin-bottom: 15px;">
            ‚ö†Ô∏è Required for Emergency Button
          </p>
          
          <select id="stateInput" class="location-input" onchange="loadDistricts()">
            <option value="">Select State</option>
            <option value="Delhi">Delhi</option>
            <option value="Maharashtra">Maharashtra</option>
            <option value="Karnataka">Karnataka</option>
            <option value="Tamil Nadu">Tamil Nadu</option>
            <option value="West Bengal">West Bengal</option>
            <option value="Gujarat">Gujarat</option>
            <option value="Rajasthan">Rajasthan</option>
            <option value="Uttar Pradesh">Uttar Pradesh</option>
            <option value="Assam">Assam</option>
          </select>
          
          <select id="districtInput" class="location-input" disabled onchange="loadAreas()">
            <option value="">Select District</option>
          </select>
          
          <select id="areaInput" class="location-input" disabled>
            <option value="">Select Area</option>
          </select>
          
          <button class="save-location-btn" onclick="saveUserLocation()">
            üíæ Save Location
          </button>
        </div>
        
        <div id="savedLocationDisplay" style="display: none;"></div>
      </div>
    </aside>

  </div>

  <div id="aboutModal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6);">
    <div style="background-color: white; margin: 10% auto; padding: 40px; border-radius: 15px; width: 70%; max-width: 600px; box-shadow: 0 5px 30px rgba(0,0,0,0.3);">
      <span onclick="closeAbout()" style="float: right; font-size: 28px; font-weight: bold; cursor: pointer; color: #999;">&times;</span>
      <h2 style="color: #2563eb; margin-bottom: 20px;">‚ÑπÔ∏è About NeuroBuddyy.AI</h2>
      <p style="font-size: 1rem; line-height: 1.8; color: #555; text-align: justify;">
        NEUROBUDDYY.AI is an intelligent health chatbot developed by <strong>ZERO DAY CODERS</strong> to provide reliable information about health issues, neurology, and brain-related problems. Our mission is to make health information accessible to everyone. We specialize in neurological conditions, brain health, and general medical inquiries. This platform is designed to help people get instant answers to their health questions anytime, anywhere. However, please note that NeuroBuddy.AI is not a replacement for professional medical advice. Always consult with qualified healthcare providers for medical concerns.
      </p>
      <p style="text-align: center; margin-top: 20px; color: #2563eb; font-weight: bold;">¬© 2025 ZERO DAY CODERS</p>
      <p style="font-size: 1rem; line-height:1.8; color:#060000; text-align:justify;">
        Important Instruction: While entering a question in our chatbot, kindly select your query from the suggestion box. If you type a question manually without selecting a suggestion, it may cause an error. To ensure accurate responses, always choose a question from the suggestions provided.
      </p>
    </div>
  </div>

<script>
  const BACKEND_URL = 'https://neurobuddyy-ai.onrender.com';

  // ========== HOSPITAL LOCATION FEATURE ==========

  const districtData = {
  "Andaman & Nicobar Islands": ["Nicobar","North & Middle Andaman","South Andaman"],
  "Andhra Pradesh": ["Anantapur","Chittoor","East Godavari","Guntur","Kadapa","Krishna","Kurnool","Nellore","Prakasam","Srikakulam","Visakhapatnam","Vizianagaram","West Godavari"],
  "Arunachal Pradesh": ["Anjaw","Changlang","East Kameng","East Siang","Kurung Kumey","Lohit","Lower Dibang Valley","Lower Siang","Lower Subansiri","Namsai","Papum Pare","Shi Yomi","Siang","Tawang","Tirap","Upper Dibang Valley","Upper Siang","Upper Subansiri","West Kameng","West Siang"],
  "Assam": ["Baksa","Barpeta","Biswanath","Bongaigaon","Cachar","Charaideo","Chirang","Darrang","Dhemaji","Dhubri","Dibrugarh","Dima Hasao","Guwahati","Goalpara","Golaghat","Hailakandi","Hojai","Jorhat","Kamrup","Kamrup Metropolitan","Karbi Anglong","Karimganj","Kokrajhar","Lakhimpur","Majuli","Morigaon","Nagaon","Nalbari","Sivasagar","Sonitpur","Tinsukia","Udalguri","West Karbi Anglong"],
  "Bihar": ["Araria","Arwal","Aurangabad","Banka","Begusarai","Bhagalpur","Bhojpur","Buxar","Darbhanga","East Champaran","Gaya","Gopalganj","Jamui","Jehanabad","Kaimur","Katihar","Khagaria","Kishanganj","Lakhisarai","Madhepura","Madhubani","Munger","Muzaffarpur","Nalanda","Nawada","Pashchim Champaran","Patna","Purba Champaran","Purnia","Rohtas","Saharsa","Samastipur","Saran","Sheikhpura","Sheohar","Sitamarhi","Siwan","Supaul","Vaishali","West Champaran"],
  "Chandigarh": ["Chandigarh"],
  "Chhattisgarh": ["Balod","Baloda Bazar","Balrampur","Bastar","Bemetara","Bijapur","Bilaspur","Dakshin Bastar (Dantewada)","Dhamtari","Durg","Gariaband","Janjgir-Champa","Jashpur","Kabirdham","Kanker","Kondagaon","Korba","Koriya","Mahasamund","Mungeli","Narayanpur","Raigarh","Raipur","Rajnandgaon","Sukma","Surajpur","Surguja"],
  "Dadra & Nagar Haveli and Daman & Diu": ["Dadra & Nagar Haveli","Daman","Diu"],
  "Delhi": ["Central Delhi","East Delhi","New Delhi","North Delhi","North East Delhi","North West Delhi","Shahdara","South Delhi","South East Delhi","South West Delhi","West Delhi"],
  "Goa": ["North Goa","South Goa"],
  "Gujarat": ["Ahmedabad","Amreli","Anand","Aravalli","Banaskantha","Bharuch","Bhavnagar","Botad","Chhota Udaipur","Dahod","Dang","Devbhoomi Dwarka","Gandhinagar","Gir Somnath","Jamnagar","Junagadh","Kheda","Kutch","Mahisagar","Mehsana","Morbi","Narmada","Navsari","Panchmahal","Patan","Porbandar","Rajkot","Sabarkantha","Surat","Surendranagar","Tapi","Vadodara","Valsad"],
  "Haryana": ["Ambala","Bhiwani","Charkhi Dadri","Faridabad","Fatehabad","Gurugram","Hisar","Jhajjar","Jind","Kaithal","Kurukshetra","Mahendragarh","Nuh","Palwal","Panchkula","Panipat","Rewari","Rohtak","Sirsa","Sonipat","Yamunanagar"],
  "Himachal Pradesh": ["Bilaspur","Chamba","Hamirpur","Kangra","Kinnaur","Kullu","Lahaul & Spiti","Mandi","Shimla","Sirmaur","Solan","Una"],
  "Jammu & Kashmir": ["Anantnag","Bandipora","Baramulla","Budgam","Doda","Ganderbal","Kulgam","Kupwara","Kishtwar","Poonch","Pulwama","Ramban","Reasi","Samba","Shopian","Srinagar","Udhampur","Rajouri","Kathua"],
  "Jharkhand": ["Bokaro","Chatra","Deoghar","Dhanbad","Dumka","East Singhbhum","Garhwa","Giridih","Godda","Gumla","Hazaribagh","Jamtara","Khunti","Koderma","Latehar","Lohardaga","Pakur","Palamu","Ramgarh","Ranchi","Sahibganj","Seraikela Kharsawan","Simdega","West Singhbhum"],
  "Karnataka": ["Bagalkot","Ballari","Belagavi","Bengaluru Rural","Bengaluru Urban","Bidar","Chamarajanagar","Chikkaballapura","Chikkamagaluru","Chitradurga","Dakshina Kannada","Davanagere","Dharwad","Gadag","Hassan","Haveri","Kalaburagi","Kodagu","Kolar","Mandya","Mysuru","Raichur","Ramanagara","Shivamogga","Tumakuru","Udupi","Uttara Kannada","Vijayapura","Yadgir"],
  "Kerala": ["Alappuzha","Ernakulam","Idukki","Kannur","Kasaragod","Kollam","Kottayam","Kozhikode","Malappuram","Palakkad","Pathanamthitta","Thiruvananthapuram","Thrissur","Wayanad"],
  "Lakshadweep": ["Lakshadweep"],
  "Madhya Pradesh": ["Agar Malwa","Alirajpur","Anuppur","Ashoknagar","Balaghat","Barwani","Betul","Bhind","Bhopal","Burhanpur","Chhatarpur","Chhindwara","Damoh","Datia","Dewas","Dhar","Dindori","Guna","Gwalior","Harda","Hoshangabad","Indore","Jabalpur","Jhabua","Katni","Khandwa","Khargone","Mandla","Mandsaur","Morena","Narsinghpur","Neemuch","Panna","Rajgarh","Ratlam","Rewa","Sagar","Satna","Sehore","Seoni","Shahdol","Shajapur","Sheopur","Shivpuri","Singrauli","Tikamgarh","Ujjain"],
  "Maharashtra": ["Ahmednagar","Akola","Amravati","Aurangabad","Beed","Bhandara","Buldhana","Chandrapur","Dhule","Gadchiroli","Gondia","Hingoli","Jalgaon","Jalna","Kolhapur","Latur","Mumbai City","Mumbai Suburban","Nagpur","Nanded","Nandurbar","Nashik","Osmanabad","Palghar","Parbhani","Pune","Raigad","Ratnagiri","Sangli","Satara","Sindhudurg","Solapur","Thane","Wardha","Washim","Yavatmal"],
  "Manipur": ["Bishnupur","Chandel","Churachandpur","Imphal East","Imphal West","Jiribam","Kakching","Kamjong","Kangpokpi","Noney","Pherzawl","Senapati","Tamenglong","Tengnoupal","Thoubal","Ukhrul"],
  "Meghalaya": ["East Garo Hills","East Jaintia Hills","East Khasi Hills","North Garo Hills","Ri Bhoi","South Garo Hills","South West Garo Hills","West Garo Hills","West Jaintia Hills","West Khasi Hills"],
  "Mizoram": ["Aizawl","Champhai","Hnahthial","Khawzawl","Kolasib","Lawngtlai","Lunglei","Mamit","Siaha","Serchhip"],
  "Nagaland": ["Dimapur","Kiphire","Kohima","Longleng","Mokokchung","Mon","Niuland","Noklak","Peren","Phek","Tuensang","Wokha","Z√ºnheboto"],
  "Odisha": ["Angul","Balangir","Balasore","Bargarh","Bhadrak","Boudh","Cuttack","Deogarh","Dhenkanal","Gajapati","Ganjam","Jagatsinghpur","Jajpur","Jharsuguda","Kalahandi","Kandhamal","Kendrapara","Kendujhar","Khordha","Koraput","Malkangiri","Mayurbhanj","Nabarangpur","Nayagarh","Nuapada","Puri","Rayagada","Sambalpur","Sonepur","Sundergarh"],
  "Puducherry": ["Karaikal","Mahe","Puducherry","Yanam"],
  "Punjab": ["Amritsar","Barnala","Bathinda","Faridkot","Fatehgarh Sahib","Fazilka","Firozpur","Gurdaspur","Hoshiarpur","Jalandhar","Kapurthala","Ludhiana","Mansa","Moga","Pathankot","Patiala","Rupnagar","Sahibzada Ajit Singh Nagar (Mohali)","Sangrur","Tarn Taran"],
  "Rajasthan": ["Ajmer","Alwar","Banswara","Baran","Barmer","Bharatpur","Bhilwara","Bikaner","Bundi","Chittorgarh","Churu","Dausa","Dholpur","Dungarpur","Hanumangarh","Jaipur","Jaisalmer","Jalore","Jhalawar","Jhunjhunu","Jodhpur","Karauli","Kota","Nagaur","Pali","Pratapgarh","Rajsamand","Sawai Madhopur","Sikar","Sirohi","Sri Ganganagar","Tonk","Udaipur"],
  "Sikkim": ["East Sikkim","North Sikkim","South Sikkim","West Sikkim"],
  "Tamil Nadu": ["Ariyalur","Chengalpattu","Chennai","Coimbatore","Cuddalore","Dharmapuri","Dindigul","Erode","Kallakurichi","Kanchipuram","Kanyakumari","Karur","Krishnagiri","Madurai","Nagapattinam","Namakkal","Nilgiris","Perambalur","Pudukkottai","Ramanathapuram","Ranipet","Salem","Sivaganga","Tenkasi","Thanjavur","Theni","Thoothukudi","Tiruchirappalli","Tirunelveli","Tirupathur","Tiruppur","Tiruvallur","Tiruvannamalai","Tiruvarur","Vellore","Viluppuram","Virudhunagar"],
  "Telangana": ["Adilabad","Bhadradri Kothagudem","Hyderabad","Jagtial","Jangaon","Jayashankar Bhupalpally","Jogulamba Gadwal","Kamareddy","Karimnagar","Khammam","Kumuram Bheem Asifabad","Mahabubabad","Mahabubnagar","Mancherial","Medak","Medchal-Malkajgiri","Mulugu","Nagarkurnool","Nalgonda","Narayanpet","Nizamabad","Peddapalli","Rajanna Sircilla","Ranga Reddy","Sangareddy","Siddipet","Suryapet","Vikarabad","Wanaparthy","Warangal (Urban)","Warangal (Rural)","Yadadri Bhuvanagiri"],
  "Tripura": ["Dhalai","Gomati","Khowai","North Tripura","Sepahijala","South Tripura","Unakoti","West Tripura"],
  "Uttarakhand": ["Almora","Bageshwar","Chamoli","Champawat","Dehradun","Haridwar","Nainital","Pauri Garhwal","Pithoragarh","Rudraprayag","Tehri Garhwal","Udham Singh Nagar","Uttarkashi"],
  "Uttar Pradesh": ["Agra","Aligarh","Ambedkar Nagar","Amethi","Amroha","Auraiya","Ayodhya","Azamgarh","Baghpat","Bahraich","Ballia","Banda","Barabanki","Bareilly","Basti","Bijnor","Bulandshahr","Chandauli","Chitrakoot","Deoria","Etah","Etawah","Farrukhabad","Fatehpur","Firozabad","Gautam Buddha Nagar","Ghaziabad","Ghazipur","Hardoi","Hathras","Jalaun","Jaunpur","Jhansi","Kannauj","Kanpur Dehat","Kanpur Nagar","Kasganj","Kaushambi","Kushinagar","Lalitpur","Lucknow","Maharajganj","Mahoba","Mainpuri","Mathura","Mau","Meerut","Mirzapur","Moradabad","Muzaffarnagar","Pilibhit","Pratapgarh","Rae Bareli","Rampur","Saharanpur","Sambhal","Sant Kabir Nagar","Shahjahanpur","Shamli","Shravasti","Siddharthnagar","Sitapur","Sonbhadra","Sultanpur","Unnao","Varanasi"],
  "West Bengal": ["Alipurduar","Bankura","Birbhum","Cooch Behar","Dakshin Dinajpur","Darjeeling","Hooghly","Howrah","Jalpaiguri","Jhargram","Kalimpong","Kolkata","Malda","Murshidabad","Nadia","North 24 Parganas","Paschim Medinipur","Purba Medinipur","Purulia","South 24 Parganas","Uttar Dinajpur"]
};


  const areaData = {
  // DELHI (All 11 Districts)
  "Central Delhi": ["Connaught Place", "Karol Bagh", "Paharganj", "Rajinder Nagar", "Patel Nagar"],
  "South Delhi": ["Hauz Khas", "Saket", "Greater Kailash", "Lajpat Nagar", "Nehru Place", "Defence Colony"],
  "West Delhi": ["Rajouri Garden", "Janakpuri", "Punjabi Bagh", "Vikaspuri", "Tilak Nagar"],
  "New Delhi": ["Lodhi Road", "Chanakyapuri", "RK Puram", "Khan Market", "Vasant Vihar"],
  "North Delhi": ["Civil Lines", "Kamla Nagar", "Model Town", "Kashmere Gate", "Shakti Nagar"],
  "East Delhi": ["Preet Vihar", "Laxmi Nagar", "Mayur Vihar", "Gandhi Nagar", "Krishna Nagar"],
  "North East Delhi": ["Seelampur", "Shahdara", "Dilshad Garden", "Nand Nagri", "Yamuna Vihar"],
  "North West Delhi": ["Rohini", "Pitampura", "Shalimar Bagh", "Model Town", "Saraswati Vihar"],
  "South East Delhi": ["Kalkaji", "Okhla", "Jamia Nagar", "Govindpuri", "Sarita Vihar"],
  "South West Delhi": ["Dwarka", "Vasant Kunj", "Najafgarh", "Uttam Nagar", "Kapashera"],
  "Shahdara": ["Dilshad Garden", "Karkardooma", "Vivek Vihar", "Jhilmil", "Nand Nagri"],

  // MUMBAI
  "Mumbai City": ["Colaba", "Fort", "Marine Drive", "Churchgate", "Nariman Point", "Girgaon"],
  "Mumbai Suburban": ["Andheri", "Bandra", "Borivali", "Dadar", "Kurla", "Mulund", "Goregaon"],

  // BANGALORE
  "Bengaluru Urban": ["Koramangala", "Whitefield", "Indiranagar", "Jayanagar", "Electronic City", "BTM Layout"],
  "Bengaluru Rural": ["Nelamangala", "Doddaballapura", "Devanahalli", "Hosakote"],

  // CHENNAI
  "Chennai": ["T Nagar", "Anna Nagar", "Velachery", "Adyar", "Mylapore", "Egmore", "Nungambakkam"],

  // KOLKATA
  "Kolkata": ["Salt Lake", "Park Street", "Ballygunge", "Alipore", "New Town", "Behala", "Tollygunge"],
  "Howrah": ["Shibpur", "Liluah", "Bally", "Santragachi", "Howrah Maidan"],

  // HYDERABAD
  "Hyderabad": ["Banjara Hills", "Jubilee Hills", "HITEC City", "Gachibowli", "Madhapur", "Secunderabad"],

  // PUNE
  "Pune": ["Koregaon Park", "Shivaji Nagar", "Kothrud", "Hinjewadi", "Viman Nagar", "Aundh", "Deccan"],

  // AHMEDABAD
  "Ahmedabad": ["Satellite", "Vastrapur", "CG Road", "Maninagar", "Navrangpura", "Bopal"],

  // JAIPUR
  "Jaipur": ["Malviya Nagar", "C-Scheme", "MI Road", "Vaishali Nagar", "Mansarovar", "Raja Park"],

  // LUCKNOW
  "Lucknow": ["Hazratganj", "Gomti Nagar", "Alambagh", "Aliganj", "Indira Nagar", "Mahanagar"],

  // KANPUR
  "Kanpur Nagar": ["Civil Lines", "Swaroop Nagar", "Kakadeo", "Panki", "GTB Nagar"],

  // NAGPUR
  "Nagpur": ["Sitabuldi", "Dharampeth", "Sadar", "Civil Lines", "Khamla", "Wardha Road"],

  // INDORE
  "Indore": ["Vijay Nagar", "Palasia", "MG Road", "Rau", "Sanwer Road", "AB Road"],

  // BHOPAL
  "Bhopal": ["New Market", "MP Nagar", "Arera Colony", "Kolar", "Berasia Road"],

  // PATNA
  "Patna": ["Boring Road", "Fraser Road", "Kankarbagh", "Rajendra Nagar", "Patliputra", "Gandhi Maidan"],

  // SURAT
  "Surat": ["Adajan", "Vesu", "Piplod", "Athwa", "Katargam", "Rander"],

  // VISAKHAPATNAM
  "Visakhapatnam": ["MVP Colony", "Dwaraka Nagar", "Gajuwaka", "Madhurawada", "Rushikonda"],

  // VADODARA
  "Vadodara": ["Alkapuri", "Sayajigunj", "Fatehgunj", "Manjalpur", "Gotri", "Akota"],

  // CHANDIGARH
  "Chandigarh": ["Sector 17", "Sector 22", "Sector 35", "Elante Mall", "Sukhna Lake"],

  // GUWAHATI
  "Guwahati": ["Fancy Bazar", "Paltan Bazar", "Pan Bazaar", "Ulubari", "Six Mile", "Beltola", "Ganeshguri"],
  "Kamrup Metropolitan": ["Dispur", "Bharalumukh", "Maligaon", "Khanapara", "Basistha"],
  
  // GOALPARA
  "Goalpara": ["Seven Sister Hospital","Goalpara Town","Goalpara Railway Station","Near Transport","Pragathi Nagar","Bara Bazar","Lakhipur","Dudhnoi","Matia","Rangjuli","Balijana","Agia","Krishnai","Civil Hospital Goalpara","Goalpara Circuit House","DC Office Road","Goalpara College","Mission Chariali","Kachugaon","Jaleswar","Goalpara Stadium","Old Bus Stand","New Market Area","Goalpara Police Station","Block Development Office","Goalpara Post Office","NH-17 Road","Goalpara Medical College Area"],


  // COIMBATORE
  "Coimbatore": ["RS Puram", "Gandhipuram", "Peelamedu", "Saibaba Colony", "Race Course"],

  // KOCHI/ERNAKULAM
  "Ernakulam": ["Marine Drive", "MG Road", "Kadavanthra", "Kaloor", "Edappally", "Kakkanad"],

  // THIRUVANANTHAPURAM
  "Thiruvananthapuram": ["Vellayambalam", "Pattom", "Vazhuthacaud", "Sasthamangalam", "Medical College"],

  // KOZHIKODE
  "Kozhikode": ["SM Street", "Mavoor Road", "West Hill", "Kallai", "Beach Road"],

  // MYSURU
  "Mysuru": ["Chamundipuram", "Saraswathipuram", "Kuvempunagar", "Vijayanagar", "Yadavagiri"],

  // MADURAI
  "Madurai": ["Anna Nagar", "KK Nagar", "Sellur", "Villapuram", "Goripalayam"],

  // AGRA
  "Agra": ["Sadar Bazaar", "Kamla Nagar", "Sikandra", "Dayal Bagh", "Tajganj", "Sanjay Place"],

  // VARANASI
  "Varanasi": ["Godowlia", "Lanka", "Sigra", "Bhelupur", "Maidagin", "Lahurabir"],

  // RANCHI
  "Ranchi": ["Albert Ekka Chowk", "Harmu", "Doranda", "Kanke", "Hinoo", "Lalpur"],

  // JODHPUR
  "Jodhpur": ["Paota", "Sardarpura", "Shastri Nagar", "Ratanada", "Chopasni"],

  // GWALIOR
  "Gwalior": ["Lashkar", "Morar", "City Centre", "Thatipur", "Kampoo"],

  // GURUGRAM
  "Gurugram": ["DLF Phase 1", "Sector 14", "MG Road", "Sohna Road", "Golf Course Road", "Cyber City"],

  // FARIDABAD
  "Faridabad": ["Sector 15", "NIT", "Old Faridabad", "Sector 21", "Ballabhgarh"],

  // AMRITSAR
  "Amritsar": ["Ranjit Avenue", "Mall Road", "Lawrence Road", "Golden Temple", "Majitha Road"],

  // LUDHIANA
  "Ludhiana": ["Sarabha Nagar", "Civil Lines", "Model Town", "Dugri", "Ferozepur Road"],

  // JALANDHAR
  "Jalandhar": ["Model Town", "Civil Lines", "Cantt Area", "Ladowali Road", "Kapurthala Road"],

  // DEHRADUN
  "Dehradun": ["Rajpur Road", "Mussoorie Road", "Sahastradhara Road", "Clock Tower", "Clement Town"],

  // HARIDWAR
  "Haridwar": ["Har Ki Pauri", "BHEL", "Jwalapur", "Ranipur", "Kankhal"],

  // SILIGURI
  "Darjeeling": ["Chowrasta", "Mall Road", "Ghoom", "Lebong", "Happy Valley"],

  // RAIPUR
  "Raipur": ["Shankar Nagar", "Civil Lines", "Devendra Nagar", "Pandri", "Telibandha"],

  // BILASPUR (Chhattisgarh)
  "Bilaspur": ["Vyapar Vihar", "Nehru Nagar", "Link Road", "Torwa", "Seepat Road"],

  // JAMMU
  "Jammu": ["Gandhi Nagar", "Bahu Plaza", "Residency Road", "Raghunath Bazar", "Canal Road"],

  // SRINAGAR
  "Srinagar": ["Lal Chowk", "Dal Lake", "Residency Road", "Rajbagh", "Jawahar Nagar"],

  // GUWAHATI OTHER AREAS
  "Dibrugarh": ["Graham Bazar", "Mancotta Road", "Chowkidingee", "Lahowal"],
  "Jorhat": ["AT Road", "Gar Ali", "Mithapukhuri", "Tarajan"],
  "Tinsukia": ["Rangagora", "Bordumsa", "Makum", "Panitola"],
  "Silchar": ["Tarapur", "Rangirkhari", "Premtala", "Ambicapatty"],

  // WEST BENGAL
  "North 24 Parganas": ["Barasat", "Barrackpore", "Dum Dum", "Madhyamgram", "New Town"],
  "South 24 Parganas": ["Sonarpur", "Baruipur", "Diamond Harbour", "Canning"],

  // TELANGANA
  "Warangal (Urban)": ["Kazipet", "Hanamkonda", "Subedari", "Nakkalagutta"],
  "Karimnagar": ["Mankammathota", "Mukarampura", "Bhagathnagar", "Ramnagar"],

  // ANDHRA PRADESH
  "Guntur": ["Lakshmipuram", "Arundelpet", "Brodipet", "Kothapet"],
  "Vijayawada": ["Benz Circle", "Governorpet", "Patamata", "Auto Nagar"],

  // KERALA
  "Kannur": ["Fort Road", "Thalassery", "Payyambalam", "Thana"],
  "Kollam": ["Chinnakada", "Kilikollur", "Asramam", "Sakthikulangara"],

  // RAJASTHAN
  "Udaipur": ["City Palace", "Lake Pichola", "Fateh Sagar", "Bapu Bazar"],
  "Bikaner": ["Karni Nagar", "Rani Bazar", "Ganganagar Road"],
  "Ajmer": ["Pushkar", "Vaishali Nagar", "Nasirabad", "Beawar"],

  // MADHYA PRADESH
  "Jabalpur": ["Napier Town", "Civil Lines", "Russell Chowk", "Vijay Nagar"],
  "Ujjain": ["Freeganj", "Dewas Gate", "Mahakal Temple", "Dhanvantri Nagar"],

  // UTTAR PRADESH
  "Allahabad": ["Civil Lines", "Georgetown", "Katra", "Lukerganj"],
  "Meerut": ["Shastri Nagar", "Brahmpuri", "Sadar Bazar", "Pallavpuram"],
  "Bareilly": ["Civil Lines", "Pilibhit Road", "CB Ganj", "Subhash Nagar"],

  // BIHAR
  "Gaya": ["Town Hall", "Rampur", "Tikari", "Manpur"],
  "Bhagalpur": ["Nathnagar", "Tilkamanjhi", "Sabour", "Kahalgaon"],
  "Muzaffarpur": ["Juran Chhapra", "Motipur", "Brahampur"],

  // GOA
  "North Goa": ["Panaji", "Mapusa", "Candolim", "Calangute", "Baga", "Anjuna"],
  "South Goa": ["Margao", "Colva", "Benaulim", "Palolem", "Vasco da Gama"],

  // JHARKHAND
  "Dhanbad": ["Bank More", "Hirapur", "Saraidhela", "Jharia"],
  "Jamshedpur": ["Bistupur", "Sakchi", "Mango", "Kadma", "Sonari"],

  // ODISHA
  "Bhubaneswar": ["Kharavel Nagar", "Sahid Nagar", "Patia", "Chandrasekharpur"],
  "Cuttack": ["Buxi Bazar", "Badambadi", "Link Road", "College Square"],
  "Puri": ["Swargadwar", "Grand Road", "Sea Beach", "Balighai"],

  // ASSAM (More Districts)
  "Nagaon": ["Ward No 1", "Haiborgaon", "Bamungaon", "Juria"],
  "Barpeta": ["Barpeta Road", "Pathsala", "Sarthebari", "Baghbar"],
  "Sivasagar": ["AT Road", "Gaurisagar", "Nazira", "Amguri"],
  
  // ADDITIONAL COVERAGE
  "Dharwad": ["Vidyanagar", "Navoday Nagar", "Tolnur", "Hubli"],
  "Belgaum": ["Tilakwadi", "Camp Area", "Shahu Nagar", "Hindalga"],
  "Mangalore": ["Hampankatta", "Bunts Hostel", "Kadri", "Kankanady"],
  "Aurangabad": ["Town Centre", "Cidco", "Garkheda", "MIDC"],
  "Nashik": ["College Road", "Gangapur Road", "Satpur", "Mumbai Nagar"],
  "Kolhapur": ["Shahupuri", "Rajarampuri", "New Shahupuri", "Station Road"],
  "Solapur": ["Sakhar Peth", "Sidheshwar Peth", "Railway Lines", "Hotgi Road"],
  "Salem": ["Fairlands", "Hasthampatty", "Fort", "Ammapet"],
  "Tirupur": ["Kumaran Road", "Big Bazaar", "Gandhi Nagar", "Kangeyam Road"],
  "Trichy": ["Thillai Nagar", "Cantonment", "Srirangam", "K K Nagar"],
  "Tiruvallur": ["Redhills", "Poonamallee", "Avadi", "Ambattur"],
  "Vellore": ["Officer's Line", "Sathuvachari", "Gandhi Nagar", "Thorapadi"],
  "Tirunelveli": ["Palayamkottai", "Vannarpet", "High Ground", "Melapalayam"],
  "Wayanad": ["Kalpetta", "Mananthavady", "Sulthan Bathery", "Meppadi"],
  "Malappuram": ["Mini Bypass", "Down Hill", "Manjeri", "Tirur"],
  "Thrissur": ["Round", "Swaraj Round", "East Fort", "Vadakkumnathan"],
  "Alappuzha": ["Beach Road", "Iron Bridge", "Mullackal", "Thathampally"],
  "Shimla": ["Mall Road", "Lakkar Bazar", "Sanjauli", "Jakhoo"],
  "Dharamshala": ["McLeod Ganj", "Lower Dharamshala", "Kotwali Bazar", "Naddi"],
  "Gangtok": ["MG Marg", "Lal Bazar", "Tadong", "Deorali"],
  "Imphal": ["Paona Bazar", "Thangal Bazar", "Singjamei", "Uripok"],
  "Kohima": ["Aradurah Hill", "PR Hill", "High School", "New Market"],
  "Aizawl": ["Bara Bazar", "Zarkawt", "Dawrpui", "Thuampui"],
  "Shillong": ["Police Bazar", "Laitumkhrah", "Laban", "Mawlai"],
  "Agartala": ["Battala", "Palace Compound", "GB Road", "Abhoynagar"],
  "Port Blair": ["Aberdeen Bazaar", "Haddo", "Phoenix Bay", "Atlanta Point"],

  // CONTINUE FROM WHERE WE LEFT OFF - ADD THESE TO YOUR areaData:

// ========== ASSAM (Missing Districts) ==========
"Baksa": ["Mushalpur", "Tamulpur", "Barama", "Tihu"],
"Chirang": ["Kajalgaon", "Bijni", "Sidli", "Runikhata"],
"Dhemaji": ["Dhemaji Town", "Jonai", "Silapathar", "Sissiborgaon"],
"Dhubri": ["Dhubri Town", "Bilasipara", "Gauripur", "South Salmara"],
"Dima Hasao": ["Haflong", "Maibang", "Mahur", "Umrangso"],
"Hojai": ["Hojai Town", "Lanka", "Lumding", "Doboka"],
"Karimganj": ["Karimganj Town", "Badarpur", "Patharkandi", "Ramkrishna Nagar"],
"Kokrajhar": ["Kokrajhar Town", "Gossaigaon", "Dotma", "Fakirganj"],
"Lakhimpur": ["North Lakhimpur", "Dhakuakhana", "Bihpuria", "Narayanpur"],
"Majuli": ["Garamur", "Kamalabari", "Jengraimukh", "Phuloni"],
"Morigaon": ["Morigaon Town", "Jagiroad", "Laharighat", "Moirabari"],
"Nalbari": ["Nalbari Town", "Tihu", "Mukalmua", "Barbari"],
"Udalguri": ["Udalguri Town", "Bhergaon", "Mazbat", "Kalaigaon"],
"West Karbi Anglong": ["Hamren", "Donka", "Baithalangso", "Lumbajong"],
"Cachar": ["Silchar Town", "Udharbond", "Sonai", "Lakhipur"],
"Charaideo": ["Sonari", "Sapekhati", "Mahmora", "Rajgarh"],
"Darrang": ["Mangaldoi", "Dalgaon", "Kalaigaon", "Sipajhar"],
"Golaghat": ["Golaghat Town", "Bokakhat", "Sarupathar", "Dergaon"],
"Hailakandi": ["Hailakandi Town", "Katlicherra", "Lala", "Algapur"],
"Kamrup": ["Rangia", "Hajo", "Chhaygaon", "Boko"],
"Karbi Anglong": ["Diphu", "Bokajan", "Howraghat", "Donka"],
"Sonitpur": ["Tezpur", "Biswanath Chariali", "Rangapara", "Dhekiajuli"],

// ========== BIHAR (Missing Districts) ==========
"Araria": ["Araria Town", "Forbesganj", "Raniganj", "Jokihat"],
"Arwal": ["Arwal Town", "Kurtha", "Kaler", "Karpi"],
"Aurangabad": ["Aurangabad Town", "Daudnagar", "Goh", "Rafiganj"],
"Banka": ["Banka Town", "Katoria", "Amarpur", "Barahat"],
"Begusarai": ["Begusarai Town", "Barauni", "Khudhabandpur", "Teghra"],
"Bhojpur": ["Ara Town", "Jagdishpur", "Piro", "Shahpur"],
"Buxar": ["Buxar Town", "Dumraon", "Chausa", "Rajpur"],
"Darbhanga": ["Darbhanga Town", "Benipur", "Jale", "Kusheshwar Asthan"],
"East Champaran": ["Motihari", "Dhaka", "Raxaul", "Chakia"],
"Gopalganj": ["Gopalganj Town", "Barauli", "Kateya", "Sidhwalia"],
"Jamui": ["Jamui Town", "Jhajha", "Sono", "Barhat"],
"Jehanabad": ["Jehanabad Town", "Makhdumpur", "Kako", "Ghoshi"],
"Kaimur": ["Bhabua", "Mohania", "Adhaura", "Bhagwanpur"],
"Katihar": ["Katihar Town", "Manihari", "Barari", "Kadwa"],
"Khagaria": ["Khagaria Town", "Parbatta", "Beldaur", "Mansi"],
"Kishanganj": ["Kishanganj Town", "Bahadurganj", "Dighalbank", "Thakurganj"],
"Lakhisarai": ["Lakhisarai Town", "Halsi", "Surajgarha", "Ramgarh Chowk"],
"Madhepura": ["Madhepura Town", "Udakishanganj", "Murliganj", "Singheshwar"],
"Madhubani": ["Madhubani Town", "Jhanjharpur", "Benipatti", "Jainagar"],
"Munger": ["Munger Town", "Jamalpur", "Kharagpur", "Tarapur"],
"Nalanda": ["Bihar Sharif", "Rajgir", "Hilsa", "Islampur"],
"Nawada": ["Nawada Town", "Warsaliganj", "Rajauli", "Hisua"],
"Pashchim Champaran": ["Bettiah", "Bagaha", "Ramnagar", "Sikta"],
"Purba Champaran": ["Motihari", "Dhaka", "Raxaul", "Adapur"],
"Purnia": ["Purnia Town", "Dhamdaha", "Baisi", "Krityanand Nagar"],
"Rohtas": ["Sasaram", "Dehri", "Bikramganj", "Nokha"],
"Saharsa": ["Saharsa Town", "Sonbarsa", "Simri Bakhtiarpur", "Mahishi"],
"Samastipur": ["Samastipur Town", "Dalsinghsarai", "Rosera", "Patori"],
"Saran": ["Chapra", "Marhaura", "Sonepur", "Amnour"],
"Sheikhpura": ["Sheikhpura Town", "Ariari", "Barbigha", "Chewara"],
"Sheohar": ["Sheohar Town", "Dumri Katsari", "Piprahi", "Tariani Chowk"],
"Sitamarhi": ["Sitamarhi Town", "Dumra", "Pupri", "Parsauni"],
"Siwan": ["Siwan Town", "Maharajganj", "Mairwa", "Hussainganj"],
"Supaul": ["Supaul Town", "Triveniganj", "Nirmali", "Chhatapur"],
"Vaishali": ["Hajipur", "Mahua", "Lalganj", "Raghopur"],
"West Champaran": ["Bettiah", "Bagaha", "Narkatiaganj", "Chanpatia"],

// ========== UTTAR PRADESH (Additional Districts) ==========
"Aligarh": ["Civil Lines", "University Area", "Ramghat Road", "Dodhpur"],
"Ambedkar Nagar": ["Akbarpur", "Tanda", "Jalalpur", "Bhiyaon"],
"Amethi": ["Gauriganj", "Jagdishpur", "Musafirkhana", "Sangrampur"],
"Amroha": ["Amroha City", "Gajraula", "Hasanpur", "Dhanaura"],
"Auraiya": ["Auraiya Town", "Bidhuna", "Achchalda", "Dibiyapur"],
"Ayodhya": ["Ram Janmabhoomi", "Naya Ghat", "Civil Lines", "Goshainganj"],
"Azamgarh": ["Azamgarh Town", "Mubarakpur", "Lalganj", "Nizamabad"],
"Baghpat": ["Baghpat Town", "Baraut", "Pilana", "Khekada"],
"Bahraich": ["Bahraich Town", "Nanpara", "Kaiserganj", "Mahasi"],
"Ballia": ["Ballia Town", "Rasra", "Bansdih", "Bairiya"],
"Banda": ["Banda Town", "Atarra", "Naraini", "Baberu"],
"Barabanki": ["Barabanki Town", "Nawabganj", "Fatehpur", "Haidergarh"],
"Basti": ["Basti Town", "Harraiya", "Rudhauli", "Kaptanganj"],
"Bijnor": ["Bijnor Town", "Najibabad", "Chandpur", "Nagina"],
"Bulandshahr": ["Bulandshahr Town", "Khurja", "Sikandrabad", "Jahangirabad"],
"Chandauli": ["Chandauli Town", "Mughalsarai", "Sakaldiha", "Chakia"],
"Chitrakoot": ["Karvi", "Manikpur", "Mau", "Rajapur"],
"Deoria": ["Deoria Town", "Salempur", "Barhaj", "Pathardeva"],
"Etah": ["Etah Town", "Kasganj", "Jalesar", "Aliganj"],
"Etawah": ["Etawah Town", "Bharthana", "Saifai", "Basrehar"],
"Farrukhabad": ["Farrukhabad Town", "Fatehgarh", "Kamalganj", "Mohammadabad"],
"Fatehpur": ["Fatehpur Town", "Bindki", "Khaga", "Jahanabad"],
"Firozabad": ["Firozabad Town", "Shikohabad", "Tundla", "Jasrana"],
"Gautam Buddha Nagar": ["Noida", "Greater Noida", "Dadri", "Jewar"],
"Ghaziabad": ["Ghaziabad City", "Indirapuram", "Vasundhara", "Modinagar"],
"Ghazipur": ["Ghazipur Town", "Zamania", "Saidpur", "Mohammadabad"],
"Hardoi": ["Hardoi Town", "Shahabad", "Sandila", "Sawayajpur"],
"Hathras": ["Hathras Town", "Sadabad", "Sikandra Rao", "Sasni"],
"Jalaun": ["Orai", "Jalaun Town", "Kalpi", "Konch"],
"Jaunpur": ["Jaunpur Town", "Mariahu", "Shahganj", "Badlapur"],
"Jhansi": ["Jhansi City", "Mauranipur", "Garautha", "Moth"],
"Kannauj": ["Kannauj Town", "Tirwa", "Chhibramau", "Talgram"],
"Kanpur Dehat": ["Akbarpur", "Bhognipur", "Rasulabad", "Derapur"],
"Kasganj": ["Kasganj Town", "Sahawar", "Sidhpura", "Soron"],
"Kaushambi": ["Manjhanpur", "Bharwari", "Sirathu", "Chail"],
"Kushinagar": ["Padrauna", "Kasya", "Tamkuhi Raj", "Khadda"],
"Lalitpur": ["Lalitpur Town", "Mahroni", "Talbehat", "Bar"],
"Maharajganj": ["Maharajganj Town", "Nautanwa", "Pharenda", "Nichlaul"],
"Mahoba": ["Mahoba Town", "Kulpahar", "Charkhari", "Panwari"],
"Mainpuri": ["Mainpuri Town", "Bhongaon", "Ghiror", "Karhal"],
"Mathura": ["Mathura City", "Vrindavan", "Govardhan", "Chhata"],
"Mau": ["Mau Town", "Madhuban", "Mohammadabad", "Ghosi"],
"Mirzapur": ["Mirzapur Town", "Chunar", "Vindhyachal", "Marihan"],
"Moradabad": ["Moradabad City", "Sambhal", "Thakurdwara", "Bilari"],
"Muzaffarnagar": ["Muzaffarnagar Town", "Shamli", "Kairana", "Charthawal"],
"Pilibhit": ["Pilibhit Town", "Puranpur", "Bisalpur", "Barkhera"],
"Pratapgarh": ["Pratapgarh Town", "Kunda", "Lalganj", "Patti"],
"Rae Bareli": ["Rae Bareli Town", "Lalganj", "Salon", "Dalmau"],
"Rampur": ["Rampur Town", "Milak", "Swar", "Shahabad"],
"Saharanpur": ["Saharanpur Town", "Deoband", "Nakur", "Gangoh"],
"Sambhal": ["Sambhal Town", "Chandausi", "Bahjoi", "Gunnaur"],
"Sant Kabir Nagar": ["Khalilabad", "Mehdawal", "Dhanghata", "Haldi"],
"Shahjahanpur": ["Shahjahanpur Town", "Tilhar", "Jalalabad", "Powayan"],
"Shamli": ["Shamli Town", "Kairana", "Thanabhawan", "Un"],
"Shravasti": ["Bhinga", "Gilaula", "Ikauna", "Jamunaha"],
"Siddharthnagar": ["Naugarh", "Bansi", "Domariyaganj", "Itwa"],
"Sitapur": ["Sitapur Town", "Biswan", "Mahmudabad", "Laharpur"],
"Sonbhadra": ["Robertsganj", "Obra", "Duddhi", "Chopan"],
"Sultanpur": ["Sultanpur Town", "Kadipur", "Lambhua", "Dostpur"],
"Unnao": ["Unnao Town", "Purwa", "Hasanganj", "Safipur"],

// ========== MADHYA PRADESH (Additional Districts) ==========
"Agar Malwa": ["Agar", "Susner", "Nalkheda", "Barod"],
"Alirajpur": ["Alirajpur Town", "Jobat", "Bhabra", "Katthiwara"],
"Anuppur": ["Anuppur Town", "Jaithari", "Kotma", "Pushprajgarh"],
"Ashoknagar": ["Ashoknagar Town", "Chanderi", "Mungaoli", "Isagarh"],
"Balaghat": ["Balaghat Town", "Waraseoni", "Katangi", "Khairlanji"],
"Barwani": ["Barwani Town", "Sendhwa", "Rajpur", "Pansemal"],
"Betul": ["Betul Town", "Multai", "Bhainsdehi", "Amla"],
"Bhind": ["Bhind Town", "Gohad", "Lahar", "Mehgaon"],
"Burhanpur": ["Burhanpur Town", "Nepanagar", "Shahpur", "Khaknar"],
"Chhatarpur": ["Chhatarpur Town", "Nowgong", "Bijawar", "Rajnagar"],
"Chhindwara": ["Chhindwara Town", "Parasia", "Sausar", "Pandhurna"],
"Damoh": ["Damoh Town", "Hata", "Patharia", "Tendukheda"],
"Datia": ["Datia Town", "Seondha", "Bhander", "Indergarh"],
"Dewas": ["Dewas Town", "Khategaon", "Bagli", "Tonk Khurd"],
"Dhar": ["Dhar Town", "Manawar", "Sardarpur", "Kukshi"],
"Dindori": ["Dindori Town", "Shahpura", "Amarpur", "Karanjia"],
"Guna": ["Guna Town", "Ashok Nagar", "Raghogarh", "Chachoda"],
"Harda": ["Harda Town", "Timarni", "Khirkiya", "Rehatgaon"],
"Hoshangabad": ["Hoshangabad Town", "Itarsi", "Sohagpur", "Pipariya"],
"Katni": ["Katni Town", "Vijayraghogarh", "Murwara", "Barhi"],
"Khandwa": ["Khandwa Town", "Pandhana", "Harsud", "Khalwa"],
"Khargone": ["Khargone Town", "Maheshwar", "Bhikangaon", "Kasrawad"],
"Mandla": ["Mandla Town", "Nainpur", "Bichhiya", "Niwas"],
"Mandsaur": ["Mandsaur Town", "Sitamau", "Malhargarh", "Garoth"],
"Morena": ["Morena Town", "Sabalgarh", "Ambah", "Joura"],
"Narsinghpur": ["Narsinghpur Town", "Gadarwara", "Kareli", "Gotegaon"],
"Neemuch": ["Neemuch Town", "Manasa", "Jawad", "Rampura"],
"Panna": ["Panna Town", "Ajaigarh", "Pawai", "Amanganj"],
"Rajgarh": ["Rajgarh Town", "Biaora", "Narsingarh", "Khilchipur"],
"Ratlam": ["Ratlam Town", "Alot", "Jaora", "Sailana"],
"Rewa": ["Rewa Town", "Sirmour", "Mauganj", "Teonthar"],
"Sagar": ["Sagar Town", "Khurai", "Rehli", "Bina"],
"Satna": ["Satna Town", "Maihar", "Nagod", "Rampur Baghelan"],
"Sehore": ["Sehore Town", "Nasrullaganj", "Budni", "Ashta"],
"Seoni": ["Seoni Town", "Lakhnadon", "Barghat", "Keolari"],
"Shahdol": ["Shahdol Town", "Beohari", "Jaisinghnagar", "Burhar"],
"Shajapur": ["Shajapur Town", "Shujalpur", "Kalapipal", "Moman Badodiya"],
"Sheopur": ["Sheopur Town", "Vijaypur", "Karahal", "Badoda"],
"Shivpuri": ["Shivpuri Town", "Kolaras", "Karera", "Pichhore"],
"Singrauli": ["Waidhan", "Chitrangi", "Deosar", "Singrauli Town"],
"Tikamgarh": ["Tikamgarh Town", "Jatara", "Niwari", "Palera"],

// ========== RAJASTHAN (Additional Districts) ==========
"Alwar": ["Alwar City", "Behror", "Tijara", "Rajgarh"],
"Banswara": ["Banswara Town", "Kushalgarh", "Ghatol", "Bagidora"],
"Baran": ["Baran Town", "Atru", "Chhabra", "Kishanganj"],
"Barmer": ["Barmer Town", "Balotra", "Pachpadra", "Siwana"],
"Bharatpur": ["Bharatpur City", "Bayana", "Kaman", "Deeg"],
"Bhilwara": ["Bhilwara Town", "Shahpura", "Mandal", "Asind"],
"Bundi": ["Bundi Town", "Keshoraipatan", "Nainwa", "Hindoli"],
"Chittorgarh": ["Chittorgarh Town", "Nimbahera", "Begun", "Kapasan"],
"Churu": ["Churu Town", "Ratangarh", "Sardarshahar", "Taranagar"],
"Dausa": ["Dausa Town", "Lalsot", "Bandikui", "Baswa"],
"Dholpur": ["Dholpur Town", "Bari", "Baseri", "Rajakhera"],
"Dungarpur": ["Dungarpur Town", "Sagwara", "Aspur", "Simalwara"],
"Hanumangarh": ["Hanumangarh Town", "Nohar", "Pilibanga", "Sangaria"],
"Jaisalmer": ["Jaisalmer City", "Pokaran", "Sam Sand Dunes", "Ramgarh"],
"Jalore": ["Jalore Town", "Bhinmal", "Sanchore", "Ahore"],
"Jhalawar": ["Jhalawar Town", "Khanpur", "Jhalrapatan", "Aklera"],
"Jhunjhunu": ["Jhunjhunu Town", "Nawalgarh", "Chirawa", "Pilani"],
"Karauli": ["Karauli Town", "Hindaun", "Todabhim", "Sapotra"],
"Kota": ["Kota City", "Ramganj Mandi", "Sangod", "Ladpura"],
"Nagaur": ["Nagaur Town", "Merta City", "Didwana", "Makrana"],
"Pali": ["Pali Town", "Sojat", "Jaitaran", "Sumerpur"],
"Pratapgarh": ["Pratapgarh Town", "Arnod", "Chhoti Sadri", "Dhariawad"],
"Rajsamand": ["Kankroli", "Nathdwara", "Rajsamand Town", "Amet"],
"Sawai Madhopur": ["Sawai Madhopur Town", "Gangapur City", "Bonli", "Malarna Dungar"],
"Sikar": ["Sikar Town", "Fatehpur", "Ramgarh", "Sri Madhopur"],
"Sirohi": ["Sirohi Town", "Mount Abu", "Pindwara", "Sheoganj"],
"Sri Ganganagar": ["Sri Ganganagar Town", "Suratgarh", "Anupgarh", "Raisinghnagar"],
"Tonk": ["Tonk Town", "Newai", "Uniara", "Deoli"],

// ========== MAHARASHTRA (Additional Districts) ==========
"Ahmednagar": ["Ahmednagar City", "Sangamner", "Shrirampur", "Nevasa"],
"Akola": ["Akola City", "Balapur", "Akot", "Barshitakli"],
"Amravati": ["Amravati City", "Chandur Railway", "Morshi", "Dhamangaon"],
"Beed": ["Beed Town", "Ambejogai", "Georai", "Majalgaon"],
"Bhandara": ["Bhandara Town", "Tumsar", "Pauni", "Mohadi"],
"Buldhana": ["Buldhana Town", "Malkapur", "Chikhli", "Khamgaon"],
"Chandrapur": ["Chandrapur Town", "Ballarpur", "Warora", "Rajura"],
"Dhule": ["Dhule City", "Sakri", "Sindkheda", "Shirpur"],
"Gadchiroli": ["Gadchiroli Town", "Aheri", "Dhanora", "Kurkheda"],
"Gondia": ["Gondia Town", "Tirora", "Goregaon", "Sadak Arjuni"],
"Hingoli": ["Hingoli Town", "Kalamnuri", "Aundha Nagnath", "Basmath"],
"Jalgaon": ["Jalgaon City", "Bhusawal", "Jamner", "Amalner"],
"Jalna": ["Jalna Town", "Bhokardan", "Partur", "Ambad"],
"Latur": ["Latur City", "Ausa", "Nilanga", "Ahmadpur"],
"Nanded": ["Nanded City", "Kinwat", "Mukhed", "Deglur"],
"Nandurbar": ["Nandurbar Town", "Shahada", "Taloda", "Akkalkuwa"],
"Osmanabad": ["Osmanabad Town", "Tuljapur", "Kalamb", "Bhum"],
"Palghar": ["Palghar Town", "Vasai", "Virar", "Dahanu"],
"Parbhani": ["Parbhani Town", "Gangakhed", "Jintur", "Pathri"],
"Raigad": ["Alibag", "Panvel", "Pen", "Karjat"],
"Ratnagiri": ["Ratnagiri City", "Chiplun", "Dapoli", "Mandangad"],
"Sangli": ["Sangli City", "Miraj", "Tasgaon", "Islampur"],
"Satara": ["Satara City", "Karad", "Wai", "Phaltan"],
"Sindhudurg": ["Oras", "Malvan", "Kudal", "Sawantwadi"],
"Thane": ["Thane City", "Kalyan", "Dombivli", "Bhiwandi"],
"Wardha": ["Wardha Town", "Hinganghat", "Arvi", "Deoli"],
"Washim": ["Washim Town", "Karanja", "Malegaon", "Risod"],
"Yavatmal": ["Yavatmal Town", "Pusad", "Darwha", "Wani"]


};

  function loadDistricts() {
    const state = document.getElementById('stateInput').value;
    const districtSelect = document.getElementById('districtInput');
    const areaSelect = document.getElementById('areaInput');
    
    districtSelect.innerHTML = '<option value="">Select District</option>';
    areaSelect.innerHTML = '<option value="">Select Area</option>';
    areaSelect.disabled = true;
    
    if (state && districtData[state]) {
      districtSelect.disabled = false;
      districtData[state].forEach(district => {
        const option = document.createElement('option');
        option.value = district;
        option.textContent = district;
        districtSelect.appendChild(option);
      });
    } else {
      districtSelect.disabled = true;
    }
  }

  function loadAreas() {
    const district = document.getElementById('districtInput').value;
    const areaSelect = document.getElementById('areaInput');
    
    areaSelect.innerHTML = '<option value="">Select Area</option>';
    
    if (district && areaData[district]) {
      areaSelect.disabled = false;
      areaData[district].forEach(area => {
        const option = document.createElement('option');
        option.value = area;
        option.textContent = area;
        areaSelect.appendChild(option);
      });
    } else {
      areaSelect.disabled = true;
    }
  }

  async function saveUserLocation() {
    const state = document.getElementById('stateInput').value;
    const district = document.getElementById('districtInput').value;
    const area = document.getElementById('areaInput').value;
    
    if (!state || !district || !area) {
      alert("‚ö†Ô∏è Please fill all location fields!");
      return;
    }
    
    const locationData = {
      state: state,
      district: district,
      area: area,
      timestamp: new Date().toISOString()
    };
    
    try {
      const response = await fetch(`${BACKEND_URL}/api/save-user-location`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(locationData)
      });
      
      const result = await response.json();
      
      if (result.success) {
        localStorage.setItem('userLocation', JSON.stringify(locationData));
        localStorage.setItem('nearestHospital', JSON.stringify(result.hospital));
        
        displaySavedLocation(locationData, result.hospital);
        
        alert("‚úÖ Location saved successfully!\n\nEmergency button is now ready to use.");
      } else {
        alert("‚ùå Failed to save location: " + result.message);
      }
      
    } catch (error) {
      console.error('Error:', error);
      alert("‚ùå Server error. Please check if backend is running.");
    }
  }

  function displaySavedLocation(location, hospitalData) {
    console.log("Displaying saved location:", location);
    console.log("Hospital data received:", hospitalData);
    
    const title = document.getElementById('hospitalSectionTitle');
    if (title) title.style.display = 'none';
    document.getElementById('locationForm').style.display = 'none';
    
    const savedDisplay = document.getElementById('savedLocationDisplay');
    savedDisplay.style.display = 'block';
    
    let hospitals = Array.isArray(hospitalData) ? hospitalData : [hospitalData];
    
    let html = `
      <div style="background: white; padding: 15px; border-radius: 10px; border: 2px solid #e5e7eb; margin-bottom: 15px;">
        <p style="font-weight: bold; margin-bottom: 15px; color: #2563eb; font-size: 1rem;">
          üìã Your Nearest Hospitals (${hospitals.length})
        </p>
    `;
    
    hospitals.forEach((hospital, index) => {
      const isPrimary = index === 0;
      const bgColor = isPrimary ? '#d1fae5' : '#f9fafb';
      const borderColor = isPrimary ? '#10b981' : '#e5e7eb';
      
      let mapsLink = '#';
      if (hospital.coordinates) {
        mapsLink = `https://www.google.com/maps/search/?api=1&query=${hospital.coordinates.lat},${hospital.coordinates.lng}`;
      }
      
      html += `
        <div style="
          background: ${bgColor}; 
          padding: 12px; 
          border-radius: 8px; 
          border: 2px solid ${borderColor};
          margin-bottom: 10px;
        ">
          <div style="display: flex; justify-content: space-between; align-items: start;">
            <div style="flex: 1;">
              <p style="font-weight: bold; color: #333; font-size: 0.95rem; margin-bottom: 5px;">
                ${index + 1}. ${hospital.hospital}
              </p>
              <p style="font-size: 0.85rem; color: #666; margin: 3px 0;">
                üìû ${hospital.phone}
              </p>
              <p style="font-size: 0.85rem; color: #10b981; margin: 3px 0;">
                üìç ${hospital.distance}
              </p>
              ${hospital.coordinates ? `
                <a href="${mapsLink}" target="_blank" style="
                  display: inline-block;
                  margin-top: 8px;
                  padding: 6px 12px;
                  background: #2563eb;
                  color: white;
                  text-decoration: none;
                  border-radius: 5px;
                  font-size: 0.8rem;
                  font-weight: bold;
                  transition: 0.2s;
                " onmouseover="this.style.background='#1d4ed8'" onmouseout="this.style.background='#2563eb'">
                  üó∫Ô∏è View on Map
                </a>
              ` : ''}
            </div>
            ${isPrimary ? `
              <div style="
                background: #10b981; 
                color: white; 
                padding: 4px 10px; 
                border-radius: 5px; 
                font-size: 0.75rem;
                font-weight: bold;
                white-space: nowrap;
              ">
                PRIMARY
              </div>
            ` : ''}
          </div>
          ${isPrimary ? `
            <p style="
              font-size: 0.8rem; 
              color: #065f46; 
              margin-top: 8px; 
              font-style: italic;
            ">
              ‚ö° Emergency alerts will be sent here
            </p>
          ` : ''}
        </div>
      `;
    });
    
    html += `
      </div>
      
      <button onclick="editLocation()" style="
        width: 100%;
        background: #2563eb; 
        color: white; 
        border: none;
        padding: 12px 15px; 
        border-radius: 8px; 
        cursor: pointer;
        font-size: 0.95rem;
        font-weight: bold;
        transition: 0.2s;
      " onmouseover="this.style.background='#1d4ed8'" onmouseout="this.style.background='#2563eb'">
        ‚úèÔ∏è Edit Location
      </button>
    `;
    
    savedDisplay.innerHTML = html;
  }

  function editLocation() {
    const title = document.getElementById('hospitalSectionTitle');
    if (title) title.style.display = 'block';
    
    document.getElementById('locationForm').style.display = 'block';
    document.getElementById('savedLocationDisplay').style.display = 'none';
    
    localStorage.removeItem('userLocation');
    localStorage.removeItem('nearestHospital');
  }

  // ========== EMERGENCY BUTTON ==========

  function triggerEmergency() {
    const savedLocation = localStorage.getItem('userLocation');
    
    if (!savedLocation) {
      alert(
        "‚ö†Ô∏è Location Not Set!\n\n" +
        "Please set your nearest hospital location first.\n\n" +
        "Scroll down to 'Setup Nearest Hospital' section."
      );
      return;
    }
    
    const confirmed = confirm(
      "üö® EMERGENCY ALERT\n\n" +
      "This will notify your nearest neuro-hospital about your emergency.\n\n" +
      "Click OK to proceed."
    );
    
    if (!confirmed) return;
    
    sendEmergencyAlert();
  }

  async function sendEmergencyAlert() {
    const location = JSON.parse(localStorage.getItem('userLocation'));
    
    const loadingDiv = document.createElement('div');
    loadingDiv.id = 'emergencyLoading';
    loadingDiv.style.cssText = `
      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
      background: white; padding: 30px; border-radius: 15px;
      box-shadow: 0 10px 50px rgba(0,0,0,0.3); z-index: 10000; text-align: center;
    `;
    loadingDiv.innerHTML = `
      <h2 style="color: #dc2626;">üö® Sending Emergency Alert...</h2>
      <p>Please wait...</p>
    `;
    document.body.appendChild(loadingDiv);
    
    try {
      const response = await fetch(`${BACKEND_URL}/api/emergency-alert`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          location: location,
          timestamp: new Date().toISOString()
        })
      });
      
      const result = await response.json();
      
      document.body.removeChild(loadingDiv);
      
      if (result.success) {
        showEmergencySuccess(result);
      } else {
        alert("‚ùå Failed to send alert.\n\nPlease call emergency services: 108");
      }
      
    } catch (error) {
      document.body.removeChild(loadingDiv);
      console.error("Emergency alert error:", error);
      alert("‚ùå Server error.\n\nPlease call emergency services: 108");
    }
  }

  function showEmergencySuccess(result) {
    const popup = document.createElement('div');
    popup.style.cssText = `
      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
      background: white; padding: 40px; border-radius: 15px;
      box-shadow: 0 10px 50px rgba(0,0,0,0.3); z-index: 10000;
      max-width: 500px; text-align: center;
    `;
    
    popup.innerHTML = `
      <h2 style="color: #10b981;">‚úÖ Emergency Alert Sent!</h2>
      <p style="font-size: 1.1rem; margin: 20px 0;">
        ${result.hospital_name} has been notified.
      </p>
      <div style="background: #f0f4f8; padding: 15px; border-radius: 10px; margin: 20px 0;">
        <p><strong>Reference ID:</strong> ${result.reference_id}</p>
        <p><strong>Hospital Phone:</strong> ${result.hospital_phone}</p>
        <p><strong>Hospital Email:</strong> ${result.hospital_email}</p>
        <p style="font-size: 0.9rem; color: #10b981; margin-top: 10px;">
          ‚úÖ Email Alert: ${result.email_status === 'success' ? 'Sent' : 'Failed'}<br>
          üì± SMS Alert: ${result.sms_status === 'success' ? 'Sent' : result.sms_status === 'skipped' ? 'Skipped (Not Configured)' : 'Failed'}
        </p>
      </div>
      <p style="color: #666; font-size: 0.9rem;">
        Help is on the way. Stay calm and wait for assistance.
      </p>
      <button onclick="this.parentElement.remove()" style="
        background: #2563eb; color: white; border: none;
        padding: 12px 30px; border-radius: 8px; font-size: 1rem;
        cursor: pointer; margin-top: 20px;
      ">OK</button>
    `;
    
    document.body.appendChild(popup);
  }

  // ========== CHAT HISTORY FEATURE ==========

  let chatHistory = [];

  function loadChatHistory() {
    const saved = localStorage.getItem('chatHistory');
    if (saved) {
      chatHistory = JSON.parse(saved);
    }
  }

  function saveChatHistory() {
    localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
  }

  function addToHistory(firstQuestion) {
    const greetingWords = ['hi', 'hello', 'hey', 'good morning', 'good evening', 'good afternoon'];
    const isGreeting = greetingWords.some(word => firstQuestion.toLowerCase().includes(word));
    
    if (!firstQuestion || isGreeting) {
      return;
    }
    
    const historyItem = {
      id: Date.now(),
      title: firstQuestion,
      timestamp: new Date().toISOString(),
      date: new Date()
    };
    
    chatHistory.unshift(historyItem);
    
    if (chatHistory.length > 20) {
      chatHistory = chatHistory.slice(0, 20);
    }
    
    saveChatHistory();
  }

  function toggleChatHistory() {
    const panel = document.getElementById('chatHistoryPanel');
    const sidebar = document.getElementById('sidebar');
    
    if (panel.classList.contains('open')) {
      panel.classList.remove('open');
    } else {
      panel.classList.add('open');
      sidebar.classList.remove('open');
      displayChatHistory();
    }
  }

  function displayChatHistory() {
    const historyList = document.getElementById('historyList');
    
    if (chatHistory.length === 0) {
      historyList.innerHTML = '<div class="no-history">No chat history yet.<br>Start a conversation!</div>';
      return;
    }
    
    let html = '';
    chatHistory.forEach(item => {
      const timeAgo = getTimeAgo(new Date(item.timestamp));
      
      html += `
        <div class="history-item" onclick="loadConversation('${item.id}')">
          <div class="history-title">${item.title}</div>
          <div class="history-time">${timeAgo}</div>
        </div>
      `;
    });
    
    historyList.innerHTML = html;
  }

  function getTimeAgo(date) {
    const now = new Date();
    const diffMs = now - date;
    const diffMins = Math.floor(diffMs / 60000);
    const diffHours = Math.floor(diffMs / 3600000);
    const diffDays = Math.floor(diffMs / 86400000);
    
    if (diffMins < 1) return 'Just now';
    if (diffMins < 60) return `${diffMins} minute${diffMins > 1 ? 's' : ''} ago`;
    if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
    if (diffDays === 1) return 'Yesterday';
    if (diffDays < 7) return `${diffDays} days ago`;
    return date.toLocaleDateString();
  }

  function loadConversation(id) {
    alert('Conversation loading feature coming soon!\n\nConversation ID: ' + id);
  }

  function clearChatHistory() {
    const confirmed = confirm('Are you sure you want to clear all chat history?');
    if (confirmed) {
      chatHistory = [];
      saveChatHistory();
      displayChatHistory();
    }
  }

  // ========== CHATBOT FUNCTIONS ==========

  const userInputField = document.getElementById('userInput');
  const topTypingBox = document.getElementById('topTypingBox');
  const topTypingContent = document.getElementById('topTypingContent');
  const suggestionsBox = document.getElementById('suggestionsBox');
  const suggestionsList = document.getElementById('suggestionsList');
  const chatWindow = document.getElementById('chatWindow');

  function toggleMenu() {
    document.getElementById("sidebar").classList.toggle("open");
  }

  userInputField.addEventListener('input', function() {
    const text = userInputField.value.trim();
    
    if (text.length > 0) {
      topTypingBox.classList.add('active');
      topTypingContent.textContent = text;
    } else {
      topTypingBox.classList.remove('active');
      suggestionsBox.classList.remove('active');
      return;
    }
    
    if (text.length >= 1) {
      getSuggestions(text);
    } else {
      suggestionsBox.classList.remove('active');
    }
  });

  async function getSuggestions(text) {
    try {
      const response = await fetch(`${BACKEND_URL}/api/get-suggestions`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text: text })
      });
      
      const data = await response.json();
      showSuggestions(data.suggestions);
    } catch (error) {
      console.error('Error:', error);
      suggestionsList.innerHTML = '<div class="no-suggestions">‚ö†Ô∏è  Connection error....</div>';
      suggestionsBox.classList.add('active');
    }
  }

  function showSuggestions(suggestions) {
    suggestionsList.innerHTML = '';
    
    if (suggestions.length > 0) {
      suggestions.forEach(question => {
        const div = document.createElement('div');
        div.className = 'suggestion-item';
        div.textContent = question;
        
        div.addEventListener('click', function() {
          userInputField.value = question;
          topTypingBox.classList.remove('active');
          suggestionsBox.classList.remove('active');
          userInputField.focus();
        });
        
        suggestionsList.appendChild(div);
      });
      
      suggestionsBox.classList.add('active');
    } else {
      suggestionsList.innerHTML = '<div class="no-suggestions">No matching questions found.</div>';
      suggestionsBox.classList.add('active');
    }
  }

  async function sendMessage() {
    const userText = userInputField.value.trim();
    if (!userText) return;

    topTypingBox.classList.remove('active');
    suggestionsBox.classList.remove('active');

    const userMsg = document.createElement("div");
    userMsg.className = "user-msg";
    userMsg.textContent = userText;
    chatWindow.appendChild(userMsg);
    chatWindow.scrollTop = chatWindow.scrollHeight;

    userInputField.value = '';

    // ‚úÖ TRACK FIRST REAL QUESTION (FIXED VERSION)
    if (!window.currentSessionFirstQuestion) {
      const greetingWords = ['hi', 'hello', 'hey', 'good morning', 'good evening', 'good afternoon', 'hii', 'hlo', 'namaste'];
      const isGreeting = greetingWords.some(word => userText.toLowerCase().trim() === word || userText.toLowerCase().includes(word));
      
      if (!isGreeting && userText.length > 5) {
        window.currentSessionFirstQuestion = userText;
        addToHistory(userText);
      }
    }

    const loadingMsg = document.createElement("div");
    loadingMsg.className = "bot-msg";
    loadingMsg.textContent = "üôÑ Finding answer...";
    loadingMsg.id = "loading-msg";
    chatWindow.appendChild(loadingMsg);
    chatWindow.scrollTop = chatWindow.scrollHeight;

    try {
      const response = await fetch(`${BACKEND_URL}/api/get-answer`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ question: userText })
      });
      
      const data = await response.json();
      
      const loading = document.getElementById("loading-msg");
      if (loading) loading.remove();

      const botMsg = document.createElement("div");
      botMsg.className = "bot-msg";
      chatWindow.appendChild(botMsg);
      
      let i = 0;
      function typeWriter() {
        if (i < data.answer.length) {
          botMsg.textContent += data.answer.charAt(i);
          i++;
          setTimeout(typeWriter, 20);
          chatWindow.scrollTop = chatWindow.scrollHeight;
        }
      }
      typeWriter();
      
    } catch (error) {
      const loading = document.getElementById("loading-msg");
      if (loading) loading.remove();
      
      const botMsg = document.createElement("div");
      botMsg.className = "bot-msg";
      botMsg.textContent = "‚ö†Ô∏è Server down!";
      chatWindow.appendChild(botMsg);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }
  }

  userInputField.addEventListener("keydown", function(e) {
    if (e.key === "Enter") {
      sendMessage();
    }
  });

  function toggleSettings() {
    const submenu = document.getElementById('settingsSubmenu');
    if (submenu.style.display === 'none') {
      submenu.style.display = 'block';
    } else {
      submenu.style.display = 'none';
    }
  }

  function openAbout() {
    document.getElementById('aboutModal').style.display = 'block';
  }

  function closeAbout() {
    document.getElementById('aboutModal').style.display = 'none';
  }

  window.onclick = function(event) {
    const aboutModal = document.getElementById('aboutModal');
    if (event.target == aboutModal) {
      aboutModal.style.display = 'none';
    }
  }

  // ========== DOCTOR CONNECT ==========
  
  let doctorListVisible = false;

  function toggleDoctorList() {
    const container = document.getElementById('doctorListContainer');
    const btn = document.getElementById('connectDoctorBtn');
    
    if (!doctorListVisible) {
      container.classList.add('expanded');
      btn.textContent = ' Close Doctor List';
      loadDoctors();
      doctorListVisible = true;
    } else {
      container.classList.remove('expanded');
      btn.textContent = 'üë®‚Äç‚öïÔ∏è Connect to Doctors';
      doctorListVisible = false;
    }
  }

  function loadDoctors() {
    const demoDoctors = [
      { id: 1, name: "Dr. Rajesh Kumar", specialty: "Neurologist", status: "available" },
      { id: 2, name: "Dr. Priya Sharma", specialty: "Psychiatrist", status: "engaged" },
      { id: 3, name: "Dr. Amit Verma", specialty: "Neurosurgeon", status: "offline" },
      { id: 4, name: "Dr. Sneha Patel", specialty: "Neurologist", status: "available" }
    ];
    
    displayDoctors(demoDoctors);
  }

  function displayDoctors(doctors) {
    const doctorList = document.getElementById('doctorList');
    
    if (!doctors || doctors.length === 0) {
      doctorList.innerHTML = '<p style="text-align: center; color: #666;">No doctors available.</p>';
      return;
    }
    
    let html = '';
    doctors.forEach(doctor => {
      let statusClass = '';
      let statusText = '';
      
      if (doctor.status === 'available') {
        statusClass = 'status-available';
        statusText = 'Available';
      } else if (doctor.status === 'engaged') {
        statusClass = 'status-engaged';
        statusText = 'Engaged';
      } else {
        statusClass = 'status-offline';
        statusText = 'Offline';
      }
      
      html += `
        <div class="doctor-card" onclick="selectDoctor(${doctor.id}, '${doctor.name}')">
          <div class="doctor-info">
            <div class="doctor-name">${doctor.name}</div>
            <div class="doctor-specialty">${doctor.specialty}</div>
          </div>
          <div class="status-indicator ${statusClass}" title="${statusText}"></div>
        </div>
      `;
    });
    
    doctorList.innerHTML = html;
  }

  function selectDoctor(doctorId, doctorName) {
    alert(`You selected ${doctorName}!\n\nConsultation feature coming soon...`);
    console.log('Selected doctor ID:', doctorId);
  }

  setInterval(function() {
    if (doctorListVisible) {
      loadDoctors();
    }
  }, 10000);

   // ========== PAGE LOAD ==========

  window.addEventListener('DOMContentLoaded', function() {
    loadChatHistory();
    
    const savedLocation = localStorage.getItem('userLocation');
    const savedHospital = localStorage.getItem('nearestHospital');
    
    if (savedLocation && savedHospital) {
      const location = JSON.parse(savedLocation);
      const hospital = JSON.parse(savedHospital);
      displaySavedLocation(location, hospital);
    }
  });  // ‚úÖ FIXED - was ")" before
</script>



<script>
// Toggle rightbar on mobile
function toggleSuggestions() {
  const rightbar = document.querySelector('.rightbar');
  rightbar.classList.toggle('mobile-active');
}

// Close rightbar when clicking outside (optional)
document.addEventListener('click', function(e) {
  if (window.innerWidth <= 768) {
    const rightbar = document.querySelector('.rightbar');
    const toggleBtn = document.querySelector('.suggestions-toggle-btn');
    if (!rightbar.contains(e.target) && e.target !== toggleBtn) {
      rightbar.classList.remove('mobile-active');
    }
  }
});
</script>
</body>
</html>
